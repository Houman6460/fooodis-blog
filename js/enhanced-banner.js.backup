/**
 * Enhanced Banner with Shining Effects and Customizable Elements
 * This script extends the existing advertising banner functionality
 * with premium visual effects, customizable buttons, and optional countdown timer.
 */

// Initialize when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    initEnhancedBanner();
});

// Banner configuration object with default values
// Using window.bannerConfig to avoid duplicate declaration
window.bannerConfig = window.bannerConfig || {
    // Banner frame
    borderRadius: 8, // px
    shineColor1: '#e8f24c',
    shineColor2: '#ffd700',
    shineAnimation: true,
    
    // Button
    buttonBackground: 'linear-gradient(45deg, #e8f24c, #ffd700)',
    buttonTextColor: '#1e2127',
    buttonBorderRadius: 30, // px
    buttonPadding: '12px 25px',
    buttonBorder: 'none',
    buttonShine: true,
    
    // Countdown
    showCountdown: true,
    countdownBorderRadius: 5, // px
    
    // Colors
    accentColor: '#e8f24c'
};

// Initialize enhanced banner functionality
function initEnhancedBanner() {
    console.log('Initializing enhanced banner with customizable elements...');
    
    try {
        // Check if we're on the blog page
        if (document.querySelector('.blog-content-section')) {
            // We're on the blog page, inject the enhanced banner
            injectEnhancedBanner();
            
            // Set up the countdown timer if enabled
            if (window.bannerConfig && window.bannerConfig.showCountdown) {
                initCountdownTimer();
            }
        }
        
        // Check if we're on the dashboard page
        const dashboardBody = document.querySelector('.dashboard-body');
        if (dashboardBody) {
            // Only try to add dashboard elements if we're on the dashboard page
            try {
                // Add enhanced banner preview option to the dashboard
                addEnhancedBannerOption();
            } catch (error) {
                console.warn('Could not add enhanced banner option:', error);
            }
            
            try {
                // Add banner customization controls
                addBannerCustomizationControls();
            } catch (error) {
                console.warn('Could not add banner customization controls:', error);
            }
        }
    } catch (error) {
        console.error('Error initializing enhanced banner:', error);
    }
}

// Inject the enhanced banner into the blog page
function injectEnhancedBanner() {
    console.log('Attempting to inject enhanced banner...');
    
    // Try to get banner data from storage
    let bannerData = null;
    
    // Use StorageManager if available
    if (window.StorageManager) {
        bannerData = window.StorageManager.load('ad-banner', {
            defaultValue: null,
            onSuccess: function(data) {
                console.log('Banner data loaded successfully via StorageManager');
            },
            onError: function(error) {
                console.error('Error loading banner data via StorageManager:', error);
            }
        });
        
        if (bannerData) {
            console.log('Banner data loaded from StorageManager');
        }
    }
    
    // Fallback to direct localStorage if StorageManager failed or is not available
    if (!bannerData) {
        const savedData = localStorage.getItem('fooodis-ad-banner');
        if (savedData) {
            try {
                bannerData = JSON.parse(savedData);
                console.log('Banner data loaded from localStorage');
            } catch (e) {
                console.error('Error parsing banner data:', e);
            }
        }
    }
    
    // If no data found or banner is disabled
    if (!bannerData || !bannerData.enabled) {
        console.log('Enhanced banner is disabled or no data found');
        return;
    }
    
    // Find the container
    const adContainer = document.getElementById('advertisingBannerContainer');
    if (!adContainer) {
        console.error('Could not find advertising banner container');
        return;
    }
    
    // Safely get properties with fallbacks
    const title = bannerData.title || 'Special Offer';
    const subtitle = bannerData.subtitle || 'Limited Time Promotion';
    const text = bannerData.text || 'Take advantage of this exclusive offer before time runs out!';
    const imageUrl = bannerData.imageUrl || '';
    
    // Apply banner configuration as CSS variables
    const cssVars = {
        '--banner-border-radius': bannerConfig.borderRadius + 'px',
        '--banner-shine-color-1': bannerConfig.shineColor1,
        '--banner-shine-color-2': bannerConfig.shineColor2,
        '--banner-shine-animation': bannerConfig.shineAnimation ? 'running' : 'paused',
        '--button-background': bannerConfig.buttonBackground,
        '--button-text-color': bannerConfig.buttonTextColor,
        '--button-border-radius': bannerConfig.buttonBorderRadius + 'px',
        '--button-padding': bannerConfig.buttonPadding,
        '--button-border': bannerConfig.buttonBorder,
        '--button-shine-animation': bannerConfig.buttonShine ? 'running' : 'paused',
        '--countdown-display': bannerConfig.showCountdown ? 'block' : 'none',
        '--countdown-border-radius': bannerConfig.countdownBorderRadius + 'px',
        '--banner-accent-color': bannerConfig.accentColor
    };
    
    // Create enhanced banner HTML
    const bannerHTML = 
        '<div class="premium-banner" style="' + Object.entries(cssVars).map(function([key, value]) { return key + ':' + value; }).join(';') + '">' +
            '<div class="premium-banner-inner">' +
                '<div class="premium-layout">' +
                    '<div class="premium-text">' +
                        '<div class="price-info-container">' +
                            '<div class="promo-text">' +
                                '<span id="promo-typewriter" class="promo-typewriter">' + title + '</span>' +
                            '</div>' +
                            '<div class="animated-discount">' + subtitle + '</div>' +
                            '<div class="countdown-container">' +
                                '<div class="countdown-animation">' +
                                    '<!-- Optional video background for countdown -->' +
                                '</div>' +
                                '<div class="countdown-timer">' +
                                    '<div class="countdown-box">' +
                                        '<div id="countdown-days" class="countdown-value">2</div>' +
                                        '<div class="countdown-label">days</div>' +
                                    '</div>' +
                                    '<div class="countdown-box">' +
                                        '<div id="countdown-hours" class="countdown-value">12</div>' +
                                        '<div class="countdown-label">hours</div>' +
                                    '</div>' +
                                    '<div class="countdown-box">' +
                                        '<div id="countdown-minutes" class="countdown-value">45</div>' +
                                        '<div class="countdown-label">mins</div>' +
                                    '</div>' +
                                    '<div class="countdown-box">' +
                                        '<div id="countdown-seconds" class="countdown-value">30</div>' +
                                        '<div class="countdown-label">secs</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                            '<p class="ad-content">' + text + '</p>' +
                            '<button class="premium-cta ' + (bannerConfig.buttonShine ? 'with-shine' : '') + '">Learn More</button>' +
                        '</div>' +
                    '</div>' +
                    '<div class="premium-image">' +
                        (imageUrl ? '<img src="' + imageUrl + '" alt="' + title + '">' : '') +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</div>';
    
    // Insert banner into the container
    adContainer.innerHTML = bannerHTML;
    console.log('Enhanced banner injected successfully');
}

// Initialize countdown timer
function initCountdownTimer() {
    // Set the countdown date to 3 days from now
    const countdownDate = new Date();
    countdownDate.setDate(countdownDate.getDate() + 3);
    
    // Update the countdown every second
    const countdownTimer = setInterval(function() {
        // Get current date and time
        const now = new Date().getTime();
        
        // Find the distance between now and the countdown date
        const distance = countdownDate - now;
        
        // Time calculations for days, hours, minutes and seconds
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        // Update the countdown elements if they exist
        const daysElement = document.getElementById('countdown-days');
        const hoursElement = document.getElementById('countdown-hours');
        const minutesElement = document.getElementById('countdown-minutes');
        const secondsElement = document.getElementById('countdown-seconds');
        
        if (daysElement) daysElement.textContent = days;
        if (hoursElement) hoursElement.textContent = hours < 10 ? '0' + hours : hours;
        if (minutesElement) minutesElement.textContent = minutes < 10 ? '0' + minutes : minutes;
        if (secondsElement) secondsElement.textContent = seconds < 10 ? '0' + seconds : seconds;
        
        // If the countdown is finished, clear the interval and display a message
        if (distance < 0) {
            clearInterval(countdownTimer);
            if (daysElement) daysElement.textContent = '0';
            if (hoursElement) hoursElement.textContent = '00';
            if (minutesElement) minutesElement.textContent = '00';
            if (secondsElement) secondsElement.textContent = '00';
        }
    }, 1000);
}

// Initialize typewriter effect
function initTypewriterEffect() {
    const typewriterElement = document.getElementById('promo-typewriter');
    if (!typewriterElement) return;
    
    const phrases = [
        'Limited Time Offer',
        'Exclusive Promotion',
        'Special Discount',
        'Act Now'
    ];
    
    let currentPhraseIndex = 0;
    let currentCharIndex = 0;
    let isDeleting = false;
    let typingSpeed = 100;
    
    function typeWriter() {
        const currentPhrase = phrases[currentPhraseIndex];
        
        if (isDeleting) {
            // Deleting characters
            typewriterElement.textContent = currentPhrase.substring(0, currentCharIndex - 1);
            currentCharIndex--;
            typingSpeed = 50; // Faster when deleting
        } else {
            // Typing characters
            typewriterElement.textContent = currentPhrase.substring(0, currentCharIndex + 1);
            currentCharIndex++;
            typingSpeed = 150; // Slower when typing
        }
        
        // If we've completed typing the current phrase
        if (!isDeleting && currentCharIndex === currentPhrase.length) {
            // Pause at the end of typing
            isDeleting = true;
            typingSpeed = 2000; // Wait before starting to delete
        } 
        // If we've deleted the entire phrase
        else if (isDeleting && currentCharIndex === 0) {
            isDeleting = false;
            currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
            typingSpeed = 500; // Wait before typing the next phrase
        }
        
        setTimeout(typeWriter, typingSpeed);
    }
    
    // Start the typewriter effect
    setTimeout(typeWriter, 1000);
}

// Add enhanced banner option to the dashboard
function addEnhancedBannerOption() {
    console.log('Adding enhanced banner option to dashboard...');
    
    // Find the ad layout selection container
    const layoutContainer = document.querySelector('.ad-layouts');
    if (!layoutContainer) {
        console.error('Could not find layout selection container');
        return;
    }
    
    // Create the enhanced banner option
    const enhancedOption = document.createElement('div');
    enhancedOption.className = 'layout-option';
    enhancedOption.innerHTML = `
        <input type="radio" id="layout-premium" name="adLayout" value="layout-premium">
        <label for="layout-premium" class="layout-label">
            <div class="layout-preview layout-premium">
                <div class="preview-shine"></div>
                <div class="preview-text">Premium</div>
                <div class="preview-image"></div>
            </div>
            <span>Premium Banner</span>
        </label>
    `;
    
    // Add the option to the layout container
    layoutContainer.appendChild(enhancedOption);
    
    // Add event listener for the new option
    const radioInput = enhancedOption.querySelector('input[type="radio"]');
    if (radioInput) {
        radioInput.addEventListener('change', function() {
            if (this.checked) {
                // Update the layout selection in the adData object
                if (window.adData) {
                    window.adData.layout = 'layout-premium';
                    
                    // Save the updated data
                    if (typeof window.saveAdData === 'function') {
                        window.saveAdData();
                    }
                    
                    // Update the preview
                    if (typeof window.updatePreviewContent === 'function') {
                        window.updatePreviewContent();
                    }
                }
            }
        });
    }
    
    // Add CSS for the premium layout preview
    const style = document.createElement('style');
    style.textContent = `
        .layout-preview.layout-premium {
            background-color: #1e2127;
            border: 2px solid #e8f24c;
            position: relative;
            overflow: hidden;
        }
        
        .layout-preview.layout-premium .preview-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                to right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 200%; }
        }
        
        .layout-preview.layout-premium .preview-text {
            color: #e8f24c;
            font-weight: bold;
        }
        
        .layout-preview.layout-premium .preview-image {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            height: 20px;
            margin-top: 5px;
        }
    `;
    
    document.head.appendChild(style);
    
    // Extend the updatePreviewContent function to handle the premium layout
    if (window.updatePreviewContent) {
        const originalUpdatePreviewContent = window.updatePreviewContent;
        window.updatePreviewContent = function() {
            // Call the original function first
            originalUpdatePreviewContent.apply(this, arguments);
            
            // Check if the premium layout is selected
            if (window.adData && window.adData.layout === 'layout-premium') {
                const previewContainer = document.getElementById('adPreviewContent');
                if (previewContainer) {
                    // Create the premium preview HTML
                    const title = window.adData.title || 'Special Offer';
                    const subtitle = window.adData.subtitle || 'Limited Time Promotion';
                    const text = window.adData.text || 'Take advantage of this exclusive offer!';
                    const imageUrl = window.adData.imageUrl || '';
                    
                    const previewHTML = `
                        <div class="premium-banner" style="transform: scale(0.8); transform-origin: top center;">
                            <div class="premium-banner-inner">
                                <div class="premium-layout">
                                    <div class="premium-text">
                                        <div>
                                            <span class="highlight">Base Price</span> ${title}
                                        </div>
                                        <div class="price-info-container">
                                            <div class="promo-text">
                                                <span class="promo-typewriter">Limited Time Offer</span>
                                            </div>
                                            <div class="animated-discount">${subtitle}</div>
                                            <div class="countdown-container">
                                                <div class="countdown-timer">
                                                    <div class="countdown-box">
                                                        <div class="countdown-value">2</div>
                                                        <div class="countdown-label">days</div>
                                                    </div>
                                                    <div class="countdown-box">
                                                        <div class="countdown-value">12</div>
                                                        <div class="countdown-label">hours</div>
                                                    </div>
                                                    <div class="countdown-box">
                                                        <div class="countdown-value">45</div>
                                                        <div class="countdown-label">mins</div>
                                                    </div>
                                                    <div class="countdown-box">
                                                        <div class="countdown-value">30</div>
                                                        <div class="countdown-label">secs</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="ad-content">${text}</p>
                                            <button class="premium-cta">Learn More</button>
                                        </div>
                                    </div>
                                    <div class="premium-image">
                                        ${imageUrl ? `<img src="${imageUrl}" alt="${title}" style="max-height: 150px;">` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Update the preview container
                    previewContainer.innerHTML = previewHTML;
                }
            }
        };
    }
}

// Function to add banner customization controls to the dashboard
function addBannerCustomizationControls() {
    console.log('Adding banner customization controls...');
    
    // Find the ad management section
    const adManagementSection = document.querySelector('#ad-management-section');
    if (!adManagementSection) {
        console.error('Could not find ad management section');
        return;
    }
    
    // Create the customization panel
    const customizationPanel = document.createElement('div');
    customizationPanel.className = 'banner-customization-panel';
    customizationPanel.innerHTML = 
        '<div class="panel-header">' +
            '<h3>Banner Customization</h3>' +
            '<button class="close-panel" title="Close Panel">' +
                '<i class="fas fa-times"></i>' +
            '</button>' +
        '</div>' +
        
        '<div class="customization-tabs">' +
            '<button class="tab-btn active" data-tab="layout">Layout</button>' +
            '<button class="tab-btn" data-tab="colors">Colors</button>' +
            '<button class="tab-btn" data-tab="effects">Effects</button>' +
            '<button class="tab-btn" data-tab="presets">Presets</button>' +
            '<button class="tab-btn" data-tab="import-export">Import/Export</button>' +
        '</div>' +
        
        '<div class="panel-content">' +
            '<div class="tab-content active" id="tab-layout">' +
                '<div class="form-group">' +
                    '<label for="banner-border-radius">Corner Radius</label>' +
                    '<div class="slider-container">' +
                        '<input type="range" id="banner-border-radius" min="0" max="30" value="' + bannerConfig.borderRadius + '">' +
                        '<span class="value-display">' + bannerConfig.borderRadius + 'px</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group">' +
                    '<label for="banner-padding">Banner Padding</label>' +
                    '<div class="slider-container">' +
                        '<input type="range" id="banner-padding" min="10" max="40" value="' + (bannerConfig.padding || 20) + '">' +
                        '<span class="value-display">' + (bannerConfig.padding || 20) + 'px</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group">' +
                    '<label for="banner-layout">Layout Style</label>' +
                    '<div class="select-container">' +
                        '<select id="banner-layout" class="custom-select">' +
                            '<option value="standard" ' + ((bannerConfig.layout || 'standard') === 'standard' ? 'selected' : '') + '>Standard (Text Left, Image Right)</option>' +
                            '<option value="reversed" ' + ((bannerConfig.layout || '') === 'reversed' ? 'selected' : '') + '>Reversed (Image Left, Text Right)</option>' +
                            '<option value="centered" ' + ((bannerConfig.layout || '') === 'centered' ? 'selected' : '') + '>Centered (Text Above Image)</option>' +
                            '<option value="overlay" ' + ((bannerConfig.layout || '') === 'overlay' ? 'selected' : '') + '>Overlay (Text Over Image)</option>' +
                        '</select>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="show-countdown">Show Countdown</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="show-countdown" ' + (bannerConfig.showCountdown ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
            '</div>' +
            
            '<div class="tab-content" id="tab-colors">' +
                '<div class="form-group color-group">' +
                    '<label for="accent-color">Accent Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="accent-color" value="' + bannerConfig.accentColor + '">' +
                        '<span class="color-value">' + bannerConfig.accentColor + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="background-color">Background Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="background-color" value="' + (bannerConfig.backgroundColor || '#ffffff') + '">' +
                        '<span class="color-value">' + (bannerConfig.backgroundColor || '#ffffff') + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="text-color">Text Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="text-color" value="' + (bannerConfig.textColor || '#333333') + '">' +
                        '<span class="color-value">' + (bannerConfig.textColor || '#333333') + '</span>' +
                    '</div>'
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="button-text-color">Button Text Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="button-text-color" value="' + bannerConfig.buttonTextColor + '">' +
                        '<span class="color-value">' + bannerConfig.buttonTextColor + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="button-background-color">Button Background Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="button-background-color" value="' + (bannerConfig.buttonBackgroundColor || '#4A90E2') + '">' +
                        '<span class="color-value">' + (bannerConfig.buttonBackgroundColor || '#4A90E2') + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="button-border-color">Button Border Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="button-border-color" value="' + (bannerConfig.buttonBorderColor || '#3A80D2') + '">' +
                        '<span class="color-value">' + (bannerConfig.buttonBorderColor || '#3A80D2') + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="use-gradient">Use Gradient Background</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="use-gradient" ' + (bannerConfig.useGradient ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group color-group" id="gradient-color-group" style="' + (bannerConfig.useGradient ? '' : 'opacity: 0.5; pointer-events: none;') + '">' +
                    '<label for="gradient-color">Gradient End Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="gradient-color" value="' + (bannerConfig.gradientColor || '#f8f8f8') + '">' +
                        '<span class="color-value">' + (bannerConfig.gradientColor || '#f8f8f8') + '</span>' +
                    '</div>' +
                '</div>' +
            '</div>' +
            
            '<div class="tab-content" id="tab-effects">' +
                '<div class="form-group">' +
                    '<label for="button-border-radius">Button Radius</label>' +
                    '<div class="slider-container">' +
                        '<input type="range" id="button-border-radius" min="0" max="30" value="' + (bannerConfig.buttonBorderRadius || 8) + '">' +
                        '<span class="value-display">' + (bannerConfig.buttonBorderRadius || 8) + 'px</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="button-shine">Button Shine Effect</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="button-shine" ' + (bannerConfig.buttonShine ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="banner-shadow">Banner Shadow</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="banner-shadow" ' + (bannerConfig.showShadow ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="banner-frame">Show Banner Frame</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="banner-frame" ' + (bannerConfig.showFrame ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="frame-shine">Frame Shine Animation</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="frame-shine" ' + (bannerConfig.frameShine ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group color-group">' +
                    '<label for="frame-color">Frame Color</label>' +
                    '<div class="color-preview-container">' +
                        '<input type="color" id="frame-color" value="' + (bannerConfig.frameColor || '#4A90E2') + '">' +
                        '<span class="color-value">' + (bannerConfig.frameColor || '#4A90E2') + '</span>' +
                    '</div>'
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="show-typewriter">Typewriter Effect</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="show-typewriter" ' + (bannerConfig.showTypewriter ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group toggle-group">' +
                    '<label for="disable-text-animation">Disable Text Animation</label>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" id="disable-text-animation" ' + (bannerConfig.disableTextAnimation ? 'checked' : '') + '>' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</div>' +
                
                '<div class="form-group">' +
                    '<label for="animation-speed">Animation Speed</label>' +
                    '<div class="slider-container">' +
                        '<input type="range" id="animation-speed" min="0.5" max="3" step="0.1" value="' + (bannerConfig.animationSpeed || 1.5) + '">' +
                        '<span class="value-display">' + (bannerConfig.animationSpeed || 1.5) + 's</span>' +
                    '</div>' +
                '</div>' +
            '</div>'
            +
            '<div class="tab-content" id="tab-presets">' +
                '<div class="form-group">' +
                    '<label>Choose a preset style to quickly customize your banner:</label>' +
                    '<div class="presets-grid">' +
                        '<div class="preset-item" data-preset="modern">' +
                            '<div class="preset-preview" style="background: linear-gradient(to right, #4A90E2, #5CB3FF); border-radius: 10px;">' +
                                '<div class="preset-label">Modern</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="preset-item" data-preset="elegant">' +
                            '<div class="preset-preview" style="background: linear-gradient(to right, #333333, #666666); border-radius: 0px;">' +
                                '<div class="preset-label">Elegant</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="preset-item" data-preset="vibrant">' +
                            '<div class="preset-preview" style="background: linear-gradient(to right, #FF416C, #FF4B2B); border-radius: 15px;">' +
                                '<div class="preset-label">Vibrant</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="preset-item" data-preset="nature">' +
                            '<div class="preset-preview" style="background: linear-gradient(to right, #56ab2f, #a8e063); border-radius: 8px;">' +
                                '<div class="preset-label">Nature</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="preset-item" data-preset="luxury">' +
                            '<div class="preset-preview" style="background: linear-gradient(to right, #BF953F, #FCF6BA); border-radius: 5px;">' +
                                '<div class="preset-label">Luxury</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="preset-item" data-preset="minimal">' +
                            '<div class="preset-preview" style="background: #ffffff; border-radius: 0px; border: 1px solid #e0e0e0;">' +
                                '<div class="preset-label">Minimal</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>' +
            
            '<div class="tab-content" id="tab-import-export">' +
                '<div class="form-group">' +
                    '<label for="export-banner-config">Export Configuration</label>' +
                    '<p class="form-description">Save your current banner configuration to a file for backup or sharing.</p>' +
                    '<button id="export-banner-config" class="btn primary-btn">' +
                        '<i class="fas fa-download"></i> Export Configuration' +
                    '</button>' +
                '</div>' +
                
                '<div class="form-group">' +
                    '<label for="import-banner-config">Import Configuration</label>' +
                    '<p class="form-description">Load a previously exported banner configuration file.</p>' +
                    '<input type="file" id="import-banner-config" accept=".json" style="display: none;">' +
                    '<button id="import-banner-trigger" class="btn secondary-btn">' +
                        '<i class="fas fa-upload"></i> Select Configuration File' +
                    '</button>' +
                '</div>' +
            '</div>' +
        '</div>' +
        
        '<div class="panel-footer">' +
            '<button id="apply-banner-customization" class="primary-btn">Apply Changes</button>' +
            '<button id="reset-banner-customization" class="secondary-btn">Reset to Default</button>' +
        '</div>';

}

// Initialize the banner customization panel after adding it
function initBannerCustomizationPanel() {
    console.log('Initializing banner customization panel...');
    
    // Find the customization panel
    const customizationPanel = document.querySelector('.banner-customization-panel');
    if (!customizationPanel) {
        console.error('Could not find banner customization panel');
        return;
    }
    
    // Add the 'open' class to show the panel
    customizationPanel.classList.add('open');
    
    // Set up tab navigation
    const tabButtons = customizationPanel.querySelectorAll('.tab-btn');
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons and content
            tabButtons.forEach(btn => btn.classList.remove('active'));
            const tabContents = customizationPanel.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            const tabName = this.getAttribute('data-tab');
            const activeContent = customizationPanel.querySelector('.tab-content[data-tab="' + tabName + '"]');
            if (activeContent) {
                activeContent.classList.add('active');
            }
        });
    });
    
    // Set up close button
    const closeButton = customizationPanel.querySelector('.close-panel');
    if (closeButton) {
        closeButton.addEventListener('click', function() {
            customizationPanel.classList.remove('open');
        });
    }
    
    // Set up preset items
    const presetItems = customizationPanel.querySelectorAll('.preset-item');
    presetItems.forEach(item => {
        item.addEventListener('click', function() {
            const presetName = this.getAttribute('data-preset');
            applyPreset(presetName, customizationPanel);
        });
    });
    
    // Set up import/export functionality
    const exportButton = customizationPanel.querySelector('#export-banner-config');
    if (exportButton) {
        exportButton.addEventListener('click', function() {
            exportBannerConfiguration();
        });
    }
    
    const importInput = customizationPanel.querySelector('#import-banner-config');
    if (importInput) {
        importInput.addEventListener('change', function(event) {
            importBannerConfiguration(event);
        });
    }
    
    const importTrigger = customizationPanel.querySelector('#import-banner-trigger');
    if (importTrigger && importInput) {
        importTrigger.addEventListener('click', function() {
            importInput.click();
        });
    }
    
    // Initialize all other event listeners
    initBannerCustomizationEventListeners(customizationPanel);
    
    // Set up apply button
    const applyButton = customizationPanel.querySelector('#apply-banner-customization');
    if (applyButton) {
        applyButton.addEventListener('click', function() {
            // Update banner configuration from form values
            bannerConfig.borderRadius = parseInt(customizationPanel.querySelector('#banner-border-radius').value);
            bannerConfig.buttonTextColor = customizationPanel.querySelector('#button-text-color').value;
            bannerConfig.showCountdown = customizationPanel.querySelector('#show-countdown').checked;
            
            // Save the configuration
            saveBannerConfiguration();
            
            // Show success notification
            showNotification('Banner settings applied successfully!', 'success');
        });
    }
    
    // Set up reset button
    const resetButton = customizationPanel.querySelector('#reset-banner-customization');
    if (resetButton) {
        resetButton.addEventListener('click', function() {
            // Confirm reset
            if (confirm('Are you sure you want to reset all banner settings to default values?')) {
                // Reset to default values
                resetBannerConfiguration();
                updateUIFromConfig(customizationPanel);
                showNotification('Banner settings reset to defaults', 'info');
            }
        });
    }
    
    // Add event listeners for range inputs to update value display
    const rangeInputs = customizationPanel.querySelectorAll('input[type="range"]');
    rangeInputs.forEach(input => {
        input.addEventListener('input', function() {
            const valueDisplay = this.nextElementSibling;
            if (valueDisplay && valueDisplay.classList.contains('value-display')) {
                const unit = this.getAttribute('data-unit') || 'px';
                valueDisplay.textContent = this.value + unit;
            }
        });
    });
    
    // Initialize UI from current configuration
    updateUIFromConfig(customizationPanel);
}

// Function to export banner configuration
function exportBannerConfiguration() {
    // Create a JSON file with the current configuration
    const configData = JSON.stringify(bannerConfig, null, 2);
    const blob = new Blob([configData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    // Create a download link and trigger it
    const a = document.createElement('a');
    a.href = url;
    a.download = 'banner-config.json';
    document.body.appendChild(a);
    a.click();
    
    // Clean up
    setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }, 0);
    
    // Show notification
    showNotification('Banner configuration exported successfully', 'success');
}

// Function to import banner configuration from a JSON file
function importBannerConfiguration(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedConfig = JSON.parse(e.target.result);
            
            // Validate the imported configuration
            if (!importedConfig || typeof importedConfig !== 'object') {
                throw new Error('Invalid configuration format');
            }
            
            // Apply the imported configuration
            Object.assign(bannerConfig, importedConfig);
            
            // Update UI with the imported configuration
            const panel = document.querySelector('.banner-customization-panel');
            updateUIFromConfig(panel);
            
            // Save the imported configuration
            saveBannerConfiguration();
            
            // Show success notification
            showNotification('Banner configuration imported successfully', 'success');
            
            // Reset the file input for future imports
            event.target.value = '';
        } catch (error) {
            console.error('Error importing banner configuration:', error);
            showNotification('Error importing configuration: ' + error.message, 'error');
        }
    };
    
    reader.onerror = function() {
        showNotification('Error reading the file', 'error');
    };
    
    reader.readAsText(file);
}

// Function to initialize event listeners for the banner customization panel
function initBannerCustomizationEventListeners(customizationPanel) {
    // Add event listeners for preset items
    const presetItems = customizationPanel.querySelectorAll('.preset-item');
    presetItems.forEach(item => {
        item.addEventListener('click', function() {
            const presetName = this.getAttribute('data-preset');
            applyPreset(presetName, customizationPanel);
        });
    });
}

// Function to apply preset configurations
function applyPreset(presetName, panel) {
    let presetConfig = {};
    
    switch(presetName) {
            case 'modern':
                presetConfig = {
                    borderRadius: 10,
                    accentColor: '#4A90E2',
                    backgroundColor: '#ffffff',
                    textColor: '#333333',
                    buttonTextColor: '#ffffff',
                    buttonBorderRadius: 8,
                    showCountdown: true,
                    buttonShine: true,
                    showShadow: true,
                    useGradient: true,
                    gradientColor: '#5CB3FF',
                    layout: 'standard',
                    padding: 20,
                    animationSpeed: 1.5
                };
                break;
            case 'elegant':
                presetConfig = {
                    borderRadius: 0,
                    accentColor: '#333333',
                    backgroundColor: '#ffffff',
                    textColor: '#333333',
                    buttonTextColor: '#ffffff',
                    buttonBorderRadius: 0,
                    showCountdown: true,
                    buttonShine: false,
                    showShadow: true,
                    useGradient: true,
                    gradientColor: '#666666',
                    layout: 'standard',
                    padding: 30,
                    animationSpeed: 1.0
                };
                break;
            case 'vibrant':
                presetConfig = {
                    borderRadius: 15,
                    accentColor: '#FF416C',
                    backgroundColor: '#ffffff',
                    textColor: '#333333',
                    buttonTextColor: '#ffffff',
                    buttonBorderRadius: 25,
                    showCountdown: true,
                    buttonShine: true,
                    showShadow: true,
                    useGradient: true,
                    gradientColor: '#FF4B2B',
                    layout: 'reversed',
                    padding: 25,
                    animationSpeed: 2.0
                };
                break;
            case 'nature':
                presetConfig = {
                    borderRadius: 8,
                    accentColor: '#56ab2f',
                    backgroundColor: '#f8f8f8',
                    textColor: '#333333',
                    buttonTextColor: '#ffffff',
                    buttonBorderRadius: 8,
                    showCountdown: true,
                    buttonShine: false,
                    showShadow: true,
                    useGradient: true,
                    gradientColor: '#a8e063',
                    layout: 'standard',
                    padding: 20,
                    animationSpeed: 1.5
                };
                break;
            case 'luxury':
                presetConfig = {
                    borderRadius: 5,
                    accentColor: '#BF953F',
                    backgroundColor: '#ffffff',
                    textColor: '#333333',
                    buttonTextColor: '#333333',
                    buttonBorderRadius: 5,
                    showCountdown: true,
                    buttonShine: true,
                    showShadow: true,
                    useGradient: true,
                    gradientColor: '#FCF6BA',
                    layout: 'standard',
                    padding: 25,
                    animationSpeed: 1.2
                };
                break;
            case 'minimal':
                presetConfig = {
                    borderRadius: 12,
                    accentColor: '#333333',
                    backgroundColor: '#ffffff',
                    textColor: '#333333',
                    buttonTextColor: '#ffffff',
                    buttonBorderRadius: 8,
                    showCountdown: false,
                    buttonShine: false,
                    showShadow: false,
                    useGradient: false,
                    gradientColor: '#f8f8f8',
                    layout: 'centered',
                    padding: 30,
                    animationSpeed: 1.0
                };
                break;
            default:
                return;
        }
        
        // Update banner configuration
        Object.assign(bannerConfig, presetConfig);
        
        // Update form values
        updateUIFromPreset(panel, presetConfig);
        
        // Save configuration to localStorage
        localStorage.setItem('fooodis-banner-config', JSON.stringify(bannerConfig));
        
        // Show notification
        showNotification('Applied "' + presetName.charAt(0).toUpperCase() + presetName.slice(1) + '" preset', 'success');
    }
    
    // Function to update UI from preset

// Function to update UI elements from preset configuration
function updateUIFromPreset(panel, config) {
    // Update basic tab inputs
    if (panel.querySelector('#banner-border-radius')) {
        panel.querySelector('#banner-border-radius').value = config.borderRadius;
        panel.querySelector('#banner-border-radius').nextElementSibling.textContent = config.borderRadius + 'px';
        }
        
        if (panel.querySelector('#banner-padding')) {
            panel.querySelector('#banner-padding').value = config.padding;
            panel.querySelector('#banner-padding').nextElementSibling.textContent = config.padding + 'px';
        }
        
        if (panel.querySelector('#banner-layout')) {
            panel.querySelector('#banner-layout').value = config.layout;
        }
        
        if (panel.querySelector('#show-countdown')) {
            panel.querySelector('#show-countdown').checked = config.showCountdown;
        }
        
        // Update colors tab inputs
        if (panel.querySelector('#accent-color')) {
            panel.querySelector('#accent-color').value = config.accentColor;
            const colorValue = panel.querySelector('#accent-color').parentElement.querySelector('.color-value');
            if (colorValue) colorValue.textContent = config.accentColor;
        }
        
        if (panel.querySelector('#background-color')) {
            panel.querySelector('#background-color').value = config.backgroundColor;
            const colorValue = panel.querySelector('#background-color').parentElement.querySelector('.color-value');
            if (colorValue) colorValue.textContent = config.backgroundColor;
        }
        
        if (panel.querySelector('#text-color')) {
            panel.querySelector('#text-color').value = config.textColor;
            const colorValue = panel.querySelector('#text-color').parentElement.querySelector('.color-value');
            if (colorValue) colorValue.textContent = config.textColor;
        }
        
        if (panel.querySelector('#button-text-color')) {
            panel.querySelector('#button-text-color').value = config.buttonTextColor;
            const colorValue = panel.querySelector('#button-text-color').parentElement.querySelector('.color-value');
            if (colorValue) colorValue.textContent = config.buttonTextColor;
        }
        
        if (panel.querySelector('#use-gradient')) {
            panel.querySelector('#use-gradient').checked = config.useGradient;
            const gradientGroup = panel.querySelector('#gradient-color-group');
            if (gradientGroup) {
                gradientGroup.style.opacity = config.useGradient ? '1' : '0.5';
                gradientGroup.style.pointerEvents = config.useGradient ? 'auto' : 'none';
            }
        }
        
        if (panel.querySelector('#gradient-color')) {
            panel.querySelector('#gradient-color').value = config.gradientColor;
            const colorValue = panel.querySelector('#gradient-color').parentElement.querySelector('.color-value');
            if (colorValue) colorValue.textContent = config.gradientColor;
        }
        
        // Update effects tab inputs
        if (panel.querySelector('#button-border-radius')) {
            panel.querySelector('#button-border-radius').value = config.buttonBorderRadius;
            panel.querySelector('#button-border-radius').nextElementSibling.textContent = config.buttonBorderRadius + 'px';
        }
        
        if (panel.querySelector('#button-shine')) {
            panel.querySelector('#button-shine').checked = config.buttonShine;
        }
        
        if (panel.querySelector('#banner-shadow')) {
            panel.querySelector('#banner-shadow').checked = config.showShadow;
        }
        
        if (panel.querySelector('#animation-speed')) {
            panel.querySelector('#animation-speed').value = config.animationSpeed;
            panel.querySelector('#animation-speed').nextElementSibling.textContent = config.animationSpeed + 's';
        }
        
        // Update panel header color to match accent color
        const panelHeader = panel.querySelector('.panel-header');
        if (panelHeader) {
            panelHeader.style.backgroundColor = config.accentColor;
            panelHeader.style.color = config.accentColor;
        }
    }
    
    // Function to show notification

// Function to show notification messages
function showNotification(message, type = 'success') {
    // Create a notification element
    const notification = document.createElement('div');
    notification.className = 'banner-notification ' + type;
    notification.innerHTML = 
            '<div class="notification-icon">' +
                '<i class="fas fa-' + (type === 'success' ? 'check-circle' : type === 'info' ? 'info-circle' : 'exclamation-circle') + '"></i>' +
            '</div>' +
            '<div class="notification-content">' +
                '<div class="notification-title">' + type.charAt(0).toUpperCase() + type.slice(1) + '</div>' +
                '<div class="notification-message">' + message + '</div>' +
            '</div>' +
            '<button class="notification-close">&times;</button>';
        
        // Add notification styles if not already added
        let notificationStyle = document.querySelector('#banner-notification-style');
        if (!notificationStyle) {
            notificationStyle = document.createElement('style');
            notificationStyle.id = 'banner-notification-style';
            notificationStyle.textContent = 
                '.banner-notification {' +
                '    position: fixed;' +
                '    bottom: 20px;' +
                '    right: 20px;' +
                '    display: flex;' +
                '    align-items: center;' +
                '    background-color: white;' +
                '    border-radius: 8px;' +
                '    padding: 15px;' +
                '    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);' +
                '    z-index: 1000;' +
                '    min-width: 300px;' +
                '    max-width: 400px;' +
                '    opacity: 0;' +
                '    transform: translateX(100%);' +
                '    transition: opacity 0.3s ease, transform 0.3s ease;' +
                '}' +
                '' +
                '.banner-notification.success {' +
                '    border-left: 4px solid #4CAF50;' +
                '}' +
                '' +
                '.banner-notification.info {' +
                '    border-left: 4px solid #2196F3;' +
                '}' +
                '' +
                '.banner-notification.warning {' +
                '    border-left: 4px solid #FF9800;' +
                '}' +
                '' +
                '.banner-notification.error {' +
                '    border-left: 4px solid #F44336;' +
                '}' +
                
                '.notification-icon {' +
                '    margin-right: 15px;' +
                '    font-size: 24px;' +
                '}' +
                
                '.banner-notification.success .notification-icon {' +
                '    color: #4CAF50;' +
                '}' +
                
                '.banner-notification.info .notification-icon {' +
                '    color: #2196F3;' +
                '}' +
                
                '.banner-notification.warning .notification-icon {' +
                '    color: #FF9800;' +
                '}' +
                '' +
                '.banner-notification.error .notification-icon {' +
                '    color: #F44336;' +
                '}' +
                '' +
                '.notification-content {' +
                '    flex: 1;' +
                '}' +
                '' +
                '.notification-title {' +
                '    font-weight: 600;' +
                '    margin-bottom: 5px;' +
                '}' +
                '' +
                '.notification-message {' +
                '    color: var(--text-muted);' +
                '    font-size: 14px;' +
                '}' +
                '' +
                '.notification-close {' +
                '    background: none;' +
                '    border: none;' +
                '    font-size: 20px;' +
                '    cursor: pointer;' +
                '    color: #999;' +
                '    padding: 0;' +
                '    margin-left: 10px;' +
                '}';
            
            document.head.appendChild(notificationStyle);
        }
        
        document.body.appendChild(notification);
        
        // Set opacity to 1 after a small delay (for animation)
        setTimeout(() => {
            notification.style.opacity = '1';
            notification.style.transform = 'translateX(0)';
        }, 10);
        
        // Add close button functionality
        const closeBtn = notification.querySelector('.notification-close');
        closeBtn.addEventListener('click', function() {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        });
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (document.body.contains(notification)) {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }
        }, 5000);
    }
    
    // Add event listener for preview button
    function setupPreviewButton(panel) {
        if (!panel) return;
        
        const previewButton = panel.querySelector('#preview-banner');
        if (previewButton) {
            previewButton.addEventListener('click', function() {
            // Create a preview modal
            const previewModal = document.createElement('div');
            previewModal.className = 'banner-preview-modal';
            previewModal.innerHTML = 
                '<div class="preview-modal-content">' +
                '    <div class="preview-modal-header">' +
                '        <h3>Banner Preview</h3>' +
                '        <button class="preview-close-btn">&times;</button>' +
                '    </div>' +
                '    <div class="preview-modal-body">' +
                '        <div class="preview-container">' +
                '            <!-- Preview content will be injected here -->' +
                '        </div>' +
                '    </div>' +
                '</div>';
            
            // Add modal styles
            const modalStyle = document.createElement('style');
            modalStyle.textContent = 
                '.banner-preview-modal {' +
                '    position: fixed;' +
                '    top: 0;' +
                '    left: 0;' +
                '    width: 100%;' +
                '    height: 100%;' +
                '    background-color: rgba(0, 0, 0, 0.5);' +
                '    display: flex;' +
                '    align-items: center;' +
                '    justify-content: center;' +
                '    z-index: 1000;' +
                '    animation: fadeIn 0.3s ease;' +
                '}' +
                '' +
                '.preview-modal-content {' +
                '    background-color: var(--card-bg);' +
                '    border-radius: 12px;' +
                '    width: 90%;' +
                '    max-width: 800px;' +
                '    max-height: 90vh;' +
                '    overflow: hidden;' +
                '    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);' +
                '}' +
                '' +
                '.preview-modal-header {' +
                '    display: flex;' +
                '    justify-content: space-between;' +
                '    align-items: center;' +
                '    padding: 15px 20px;' +
                '    background-color: var(--primary-color);' +
                '    color: white;' +
                '}' +
                '' +
                '.preview-modal-header h3 {' +
                '    margin: 0;' +
                '    font-size: 18px;' +
                '    font-weight: 600;' +
                '}' +
                '' +
                '.preview-close-btn {' +
                '    background: none;' +
                '    border: none;' +
                '    color: white;' +
                '    font-size: 24px;' +
                '    cursor: pointer;' +
                '    padding: 0;' +
                '    line-height: 1;' +
                '}' +
                '' +
                '.preview-modal-body {' +
                '    padding: 20px;' +
                '    overflow-y: auto;' +
                '    max-height: calc(90vh - 60px);' +
                '}' +
                '' +
                '.preview-container {' +
                '    border: 1px dashed var(--border-color);' +
                '    padding: 20px;' +
                '    border-radius: 8px;' +
                '    background-color: var(--body-bg, #f5f5f5);' +
                '}';
            
            document.head.appendChild(modalStyle);
            
            // Add modal to the body
            document.body.appendChild(previewModal);
            
            // Get the preview container
            const previewContainer = previewModal.querySelector('.preview-container');
            
            // Create a sample banner based on current settings
            const bannerHTML = 
                '<div class="premium-banner-preview" style="' +
                '    border-radius: ' + bannerConfig.borderRadius + 'px;' +
                '    background-color: #ffffff;' +
                '    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);' +
                '    overflow: hidden;' +
                '    padding: 20px;' +
                '    position: relative;' +
                '">' +
                '    <div style="display: flex; flex-wrap: wrap;">' +
                '        <div style="flex: 1; min-width: 250px; padding-right: 20px;">' +
                '            <h3 style="color: ' + bannerConfig.accentColor + '; margin-top: 0;">Special Offer</h3>' +
                '            <p style="margin-bottom: 20px;">Take advantage of this exclusive offer before time runs out!</p>' +
                '            <button style="' +
                '                background: linear-gradient(45deg, ' + bannerConfig.accentColor + ', ' + bannerConfig.accentColor + 'cc);' +
                '                color: ' + bannerConfig.buttonTextColor + ';' +
                '                border: none;' +
                '                border-radius: ' + (bannerConfig.buttonBorderRadius || 8) + 'px;' +
                '                padding: 10px 20px;' +
                '                cursor: pointer;' +
                '                font-weight: bold;' +
                '                ' + (bannerConfig.buttonShine ? 'position: relative; overflow: hidden;' : '') +
                '            ">' +
                '                Learn More' +
                '                ' + (bannerConfig.buttonShine ? '<span style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent); transform: rotate(45deg); animation: shineEffect 2s infinite;"></span>' : '') +
                '            </button>' +
                '        </div>' +
                '        <div style="flex: 1; min-width: 250px; display: flex; justify-content: center; align-items: center;">' +
                '            ' + (bannerConfig.showCountdown ? 
                '                <div style="display: flex; gap: 10px; margin-top: 10px;">' +
                '                    <div style="text-align: center; background: ' + bannerConfig.accentColor + '; color: white; padding: 10px; border-radius: 5px; min-width: 50px;">' +
                '                        <div style="font-size: 20px; font-weight: bold;">2</div>' +
                '                        <div style="font-size: 12px;">days</div>' +
                '                    </div>' +
                '                    <div style="text-align: center; background: ' + bannerConfig.accentColor + '; color: white; padding: 10px; border-radius: 5px; min-width: 50px;">' +
                '                        <div style="font-size: 20px; font-weight: bold;">12</div>' +
                '                        <div style="font-size: 12px;">hours</div>' +
                '                    </div>' +
                '                    <div style="text-align: center; background: ' + bannerConfig.accentColor + '; color: white; padding: 10px; border-radius: 5px; min-width: 50px;">' +
                '                        <div style="font-size: 20px; font-weight: bold;">45</div>' +
                '                        <div style="font-size: 12px;">mins</div>' +
                '                    </div>' +
                '                </div>' : '') +
                '        </div>' +
                '    </div>' +
                '</div>';
                
                bannerHTML += '<style>' +
                '    @keyframes shineEffect {' +
                '        0% { transform: translateX(-100%) rotate(45deg); }' +
                '        100% { transform: translateX(100%) rotate(45deg); }' +
                '    }' +
                '</style>';
            
            // Add the banner to the preview container
            previewContainer.innerHTML = bannerHTML;
            
            // Add close button functionality
            const closeBtn = previewModal.querySelector('.preview-close-btn');
            closeBtn.addEventListener('click', function() {
                document.body.removeChild(previewModal);
                document.head.removeChild(modalStyle);
            });
            
            // Close modal when clicking outside
            previewModal.addEventListener('click', function(event) {
                if (event.target === previewModal) {
                    document.body.removeChild(previewModal);
                    document.head.removeChild(modalStyle);
                }
            });
        });
    }
    
    // Add event listeners for range inputs to update value display
    const rangeInputs = customizationPanel.querySelectorAll('input[type="range"]');
    rangeInputs.forEach(input => {
        input.addEventListener('input', function() {
            const valueDisplay = this.nextElementSibling;
            if (valueDisplay && valueDisplay.classList.contains('value-display')) {
                valueDisplay.textContent = this.value + 'px';
            }
        });
    });
    
    // Add event listeners for color inputs to update color value display
    const colorInputs = customizationPanel.querySelectorAll('input[type="color"]');
    colorInputs.forEach(input => {
        input.addEventListener('input', function() {
            const colorValue = input.parentElement.querySelector('.color-value');
            if (colorValue) {
                colorValue.textContent = this.value;
            }
        });
    });
    
    // Add event listener for apply button
    const applyButton = customizationPanel.querySelector('#apply-banner-customization');
    if (applyButton) {
        applyButton.addEventListener('click', function() {
            // Update banner configuration from form values
            bannerConfig.borderRadius = parseInt(customizationPanel.querySelector('#banner-border-radius').value);
            bannerConfig.buttonTextColor = customizationPanel.querySelector('#button-text-color').value;
            bannerConfig.showCountdown = customizationPanel.querySelector('#show-countdown').checked;
            bannerConfig.accentColor = customizationPanel.querySelector('#accent-color').value;
            
            // Get values from advanced tab
            const buttonBorderRadiusInput = customizationPanel.querySelector('#button-border-radius');
            if (buttonBorderRadiusInput) {
                bannerConfig.buttonBorderRadius = parseInt(buttonBorderRadiusInput.value);
            }
            
            const buttonShineInput = customizationPanel.querySelector('#button-shine');
            if (buttonShineInput) {
                bannerConfig.buttonShine = buttonShineInput.checked;
            }
            
            // Save configuration to localStorage
            localStorage.setItem('fooodis-banner-config', JSON.stringify(bannerConfig));
            
            // Create a success notification
            const notification = document.createElement('div');
            notification.className = 'banner-notification success';
            notification.innerHTML = 
                '<div class="notification-icon">' +
                '    <i class="fas fa-check-circle"></i>' +
                '</div>' +
                '<div class="notification-content">' +
                '    <div class="notification-title">Success</div>' +
                '    <div class="notification-message">Banner customization applied successfully!</div>' +
                '</div>' +
                '<button class="notification-close">&times;</button>';
            
            // Add notification styles
            const notificationStyle = document.createElement('style');
            notificationStyle.textContent = 
                '.banner-notification {' +
                '    position: fixed;' +
                '    bottom: 20px;' +
                '    right: 20px;' +
                '    display: flex;' +
                '    align-items: center;' +
                '    background-color: white;' +
                '    border-radius: 8px;' +
                '    padding: 15px;' +
                '    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);' +
                '    z-index: 1000;' +
                '    min-width: 300px;' +
                '    max-width: 400px;' +
                '    animation: slideIn 0.3s ease, fadeOut 0.3s ease 4.7s;' +
                '    opacity: 0;' +
                '    transform: translateX(100%);' +
                '}' +
                '' +
                '.banner-notification.success {' +
                '    border-left: 4px solid #4CAF50;' +
                '}' +
                '' +
                '.notification-icon {' +
                '    margin-right: 15px;' +
                '    font-size: 24px;' +
                '    color: #4CAF50;' +
                '}' +
                '' +
                '.notification-content {' +
                '    flex: 1;' +
                '}' +
                '' +
                '.notification-title {' +
                '    font-weight: 600;' +
                '    margin-bottom: 5px;' +
                '}' +
                '' +
                '.notification-message {' +
                '    color: var(--text-muted);' +
                '    font-size: 14px;' +
                '}' +
                '' +
                '.notification-close {' +
                '    background: none;' +
                '    border: none;' +
                '    font-size: 20px;' +
                '    cursor: pointer;' +
                '    color: #999;' +
                '    padding: 0;' +
                '    margin-left: 10px;' +
                '}' +
                '' +
                '@keyframes slideIn {' +
                '    from { transform: translateX(100%); opacity: 0; }' +
                '    to { transform: translateX(0); opacity: 1; }' +
                '}' +
                '' +
                '@keyframes fadeOut {' +
                '    from { opacity: 1; }' +
                '    to { opacity: 0; }' +
                '}';
            
            document.head.appendChild(notificationStyle);
            document.body.appendChild(notification);
            
            // Set opacity to 1 after a small delay (for animation)
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Add close button functionality
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', function() {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                    document.head.removeChild(notificationStyle);
                }, 300);
            });
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                            document.head.removeChild(notificationStyle);
                        }
                    }, 300);
                }
            }, 5000);
        });
    }
    
    // Add event listener for reset button
    const resetButton = customizationPanel.querySelector('#reset-banner-customization');
    if (resetButton) {
        resetButton.addEventListener('click', function() {
            // Confirm reset
            if (confirm('Are you sure you want to reset all banner settings to default values?')) {
                // Reset to default values
                const defaultConfig = {
                    borderRadius: 8,
                    shineColor1: '#e8f24c',
                    shineColor2: '#ffd700',
                    shineAnimation: true,
                    buttonBackground: 'linear-gradient(45deg, #e8f24c, #ffd700)',
                    buttonTextColor: '#1e2127',
                    buttonBorderRadius: 30,
                    buttonPadding: '12px 25px',
                    buttonBorder: 'none',
                    buttonShine: true,
                    showCountdown: true,
                    countdownBorderRadius: 5,
                    accentColor: '#e8f24c'
                };
                
                // Update form values - Basic tab
                customizationPanel.querySelector('#banner-border-radius').value = defaultConfig.borderRadius;
                customizationPanel.querySelector('#banner-border-radius').nextElementSibling.textContent = defaultConfig.borderRadius + 'px';
                customizationPanel.querySelector('#accent-color').value = defaultConfig.accentColor;
                customizationPanel.querySelector('#accent-color').parentElement.querySelector('.color-value').textContent = defaultConfig.accentColor;
                customizationPanel.querySelector('#show-countdown').checked = defaultConfig.showCountdown;
                
                // Update form values - Advanced tab
                const buttonBorderRadiusInput = customizationPanel.querySelector('#button-border-radius');
                if (buttonBorderRadiusInput) {
                    buttonBorderRadiusInput.value = defaultConfig.buttonBorderRadius;
                    buttonBorderRadiusInput.nextElementSibling.textContent = defaultConfig.buttonBorderRadius + 'px';
                }
                
                const buttonTextColorInput = customizationPanel.querySelector('#button-text-color');
                if (buttonTextColorInput) {
                    buttonTextColorInput.value = defaultConfig.buttonTextColor;
                    buttonTextColorInput.parentElement.querySelector('.color-value').textContent = defaultConfig.buttonTextColor;
                }
                
                const buttonShineInput = customizationPanel.querySelector('#button-shine');
                if (buttonShineInput) {
                    buttonShineInput.checked = defaultConfig.buttonShine;
                }
                
                // Update banner configuration
                Object.assign(bannerConfig, defaultConfig);
                
                // Remove saved configuration
                localStorage.removeItem('fooodis-banner-config');
                
                // Create a success notification
                const notification = document.createElement('div');
                notification.className = 'banner-notification info';
                notification.innerHTML = 
                    '<div class="notification-icon">' +
                    '    <i class="fas fa-info-circle"></i>' +
                    '</div>' +
                    '<div class="notification-content">' +
                    '    <div class="notification-title">Reset Complete</div>' +
                    '    <div class="notification-message">Banner settings have been reset to default values.</div>' +
                    '</div>' +
                    '<button class="notification-close">&times;</button>';
                
                // Add notification styles if not already added
                let notificationStyle = document.querySelector('#banner-notification-style');
                if (!notificationStyle) {
                    notificationStyle = document.createElement('style');
                    notificationStyle.id = 'banner-notification-style';
                    notificationStyle.textContent = 
                        '.banner-notification {' +
                        '    position: fixed;' +
                        '    bottom: 20px;' +
                        '    right: 20px;' +
                        '    display: flex;' +
                        '    align-items: center;' +
                        '    background-color: white;' +
                        '    border-radius: 8px;' +
                        '    padding: 15px;' +
                        '    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);' +
                        '    z-index: 1000;' +
                        '    min-width: 300px;' +
                        '    max-width: 400px;' +
                        '    opacity: 0;' +
                        '    transform: translateX(100%);' +
                        '    transition: opacity 0.3s ease, transform 0.3s ease;' +
                        '}' +
                        '' +
                        '.banner-notification.success {' +
                        '    border-left: 4px solid #4CAF50;' +
                        '}' +
                        '' +
                        '.banner-notification.info {' +
                        '    border-left: 4px solid #2196F3;' +
                        '}' +
                        '' +
                        '.notification-icon {' +
                        '    margin-right: 15px;' +
                        '    font-size: 24px;' +
                        '}' +
                        '' +
                        '.banner-notification.success .notification-icon {' +
                        '    color: #4CAF50;' +
                        '}' +
                        '' +
                        '.banner-notification.info .notification-icon {' +
                        '    color: #2196F3;' +
                        '}' +
                        '' +
                        '.notification-content {' +
                        '    flex: 1;' +
                        '}' +
                        '' +
                        '.notification-title {' +
                        '    font-weight: 600;' +
                        '    margin-bottom: 5px;' +
                        '}' +
                        '' +
                        '.notification-message {' +
                        '    color: var(--text-muted);' +
                        '    font-size: 14px;' +
                        '}' +
                        '' +
                        '.notification-close {' +
                        '    background: none;' +
                        '    border: none;' +
                        '    font-size: 20px;' +
                        '    cursor: pointer;' +
                        '    color: #999;' +
                        '    padding: 0;' +
                        '    margin-left: 10px;' +
                        '}' +
                        '' +
                        '@keyframes slideIn {' +
                        '    from { transform: translateX(100%); opacity: 0; }' +
                        '    to { transform: translateX(0); opacity: 1; }' +
                        '}' +
                        '' +
                        '@keyframes fadeOut {' +
                        '    from { opacity: 1; }' +
                        '    to { opacity: 0; }' +
                        '}';
                    document.head.appendChild(notificationStyle);
                }
                
                document.body.appendChild(notification);
                
                // Set opacity to 1 after a small delay (for animation)
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateX(0)';
                }, 10);
                
                // Add close button functionality
                const closeBtn = notification.querySelector('.notification-close');
                closeBtn.addEventListener('click', function() {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                });
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            if (document.body.contains(notification)) {
                                document.body.removeChild(notification);
                            }
                        }, 300);
                    }
                }, 5000);
            }
        });
    }

// Helper function to set up range input with value display
function setupRangeInput(inputId, cssVariable, unit, callback) {
    const input = document.getElementById(inputId);
    if (!input) return;
    
    const valueDisplay = input.closest('.range-container').querySelector('.value-display');
    
    input.addEventListener('input', () => {
        const value = input.value;
        valueDisplay.textContent = value + unit;
        document.documentElement.style.setProperty(cssVariable, value + unit);
        if (callback) callback();
    });
}

// Helper function to set up color input with preview
function setupColorInput(inputId, cssVariable, callback) {
    const input = document.getElementById(inputId);
    if (!input) return;
    
    const valueDisplay = document.getElementById(inputId + '-value');
    
    input.addEventListener('input', () => {
        const value = input.value;
        if (valueDisplay) valueDisplay.textContent = value;
        document.documentElement.style.setProperty(cssVariable, value);
        if (callback) callback();
    });
}

// Helper function to set up text input
function setupTextInput(inputId, cssVariable, callback) {
    const input = document.getElementById(inputId);
    if (!input) return;
    
    input.addEventListener('input', () => {
        document.documentElement.style.setProperty(cssVariable, input.value);
        if (callback) callback();
    });
}

// Helper function to set up toggle switch
function setupToggleSwitch(inputId, configKey, cssVariable, valueTransform, callback) {
    const input = document.getElementById(inputId);
    if (!input) return;
    
    input.addEventListener('change', () => {
        const checked = input.checked;
        bannerConfig[configKey] = checked;
        document.documentElement.style.setProperty(
            cssVariable, 
            valueTransform ? valueTransform(checked) : (checked ? 'block' : 'none')
        );
        if (callback) callback();
    });
}

// Function to update the preview
function updatePreview() {
    // This function will be called whenever a setting is changed
    // It ensures the preview reflects the current settings
    const previewBanner = document.querySelector('#banner-live-preview .enhanced-banner');
    if (!previewBanner) return;
    
    // Apply any specific preview updates here if needed
    previewBanner.style.transform = 'scale(0.8)';
    previewBanner.style.transformOrigin = 'center';
    previewBanner.style.margin = '0 auto';
}

// Function to save current configuration from all inputs
function saveCurrentConfiguration() {
    // Range inputs
    const rangeInputs = [
        { id: 'banner-border-radius', key: 'borderRadius' },
        { id: 'button-border-radius', key: 'buttonBorderRadius' },
        { id: 'countdown-border-radius', key: 'countdownBorderRadius' }
    ];
    
    rangeInputs.forEach(item => {
        const input = document.getElementById(item.id);
        if (input) bannerConfig[item.key] = parseInt(input.value);
    });
    
    // Text inputs
    const textInputs = [
        { id: 'button-background', key: 'buttonBackground' },
        { id: 'button-padding', key: 'buttonPadding' }
    ];
    
    textInputs.forEach(item => {
        const input = document.getElementById(item.id);
        if (input) bannerConfig[item.key] = input.value;
    });
    
    // Color inputs
    const colorInputs = [
        { id: 'button-text-color', key: 'buttonTextColor' },
        { id: 'shine-color-1', key: 'shineColor1' },
        { id: 'shine-color-2', key: 'shineColor2' },
        { id: 'accent-color', key: 'accentColor' }
    ];
    
    colorInputs.forEach(item => {
        const input = document.getElementById(item.id);
        if (input) bannerConfig[item.key] = input.value;
    });
    
    // Toggle switches are already updated in real-time via the setupToggleSwitch function
}

// Function to update all UI elements from the config
function updateUIFromConfig(panel) {
    // Use the panel parameter to find elements within the panel
    if (!panel) {
        panel = document.querySelector('.banner-customization-panel');
        if (!panel) {
            console.error('Could not find banner customization panel for UI update');
            return;
        }
    }
    
    // Range inputs
    const bannerBorderRadius = panel.querySelector('#banner-border-radius');
    if (bannerBorderRadius) {
        bannerBorderRadius.value = bannerConfig.borderRadius;
        const valueDisplay = bannerBorderRadius.nextElementSibling;
        if (valueDisplay) valueDisplay.textContent = bannerConfig.borderRadius + 'px';
    }
    
    const buttonBorderRadius = panel.querySelector('#button-border-radius');
    if (buttonBorderRadius) {
        buttonBorderRadius.value = bannerConfig.buttonBorderRadius;
        const valueDisplay = buttonBorderRadius.nextElementSibling;
        if (valueDisplay) valueDisplay.textContent = bannerConfig.buttonBorderRadius + 'px';
    }
    
    const countdownBorderRadius = panel.querySelector('#countdown-border-radius');
    if (countdownBorderRadius) {
        countdownBorderRadius.value = bannerConfig.countdownBorderRadius;
        const valueDisplay = countdownBorderRadius.nextElementSibling;
        if (valueDisplay) valueDisplay.textContent = bannerConfig.countdownBorderRadius + 'px';
    }
    
    // Update range value displays
    document.querySelector('#banner-border-radius').closest('.range-container')
        .querySelector('.value-display').textContent = bannerConfig.borderRadius + 'px';
    document.querySelector('#button-border-radius').closest('.range-container')
        .querySelector('.value-display').textContent = bannerConfig.buttonBorderRadius + 'px';
    document.querySelector('#countdown-border-radius').closest('.range-container')
        .querySelector('.value-display').textContent = bannerConfig.countdownBorderRadius + 'px';
    
    // Text inputs
    document.getElementById('button-background').value = bannerConfig.buttonBackground;
    document.getElementById('button-padding').value = bannerConfig.buttonPadding;
    
    // Color inputs
    document.getElementById('button-text-color').value = bannerConfig.buttonTextColor;
    document.getElementById('shine-color-1').value = bannerConfig.shineColor1;
    document.getElementById('shine-color-2').value = bannerConfig.shineColor2;
    document.getElementById('accent-color').value = bannerConfig.accentColor;
    
    // Update color value displays
    document.getElementById('button-text-color-value').textContent = bannerConfig.buttonTextColor;
    document.getElementById('shine-color-1-value').textContent = bannerConfig.shineColor1;
    document.getElementById('shine-color-2-value').textContent = bannerConfig.shineColor2;
    document.getElementById('accent-color-value').textContent = bannerConfig.accentColor;
    
    // Toggle switches
    document.getElementById('banner-shine-animation').checked = bannerConfig.shineAnimation;
    document.getElementById('button-shine').checked = bannerConfig.buttonShine;
    document.getElementById('show-countdown').checked = bannerConfig.showCountdown;
}

// Function to show notification
function showNotification(message) {
    const notification = document.getElementById('customization-notification');
    if (!notification) return;
    
    const messageElement = notification.querySelector('.notification-message');
    if (messageElement) messageElement.textContent = message;
    
    notification.classList.add('show');
    
    // Auto-hide after 3 seconds
    setTimeout(() => {
        hideNotification();
    }, 3000);
}

// Function to hide notification
function hideNotification() {
    const notification = document.getElementById('customization-notification');
    if (!notification) return;
    
    notification.classList.remove('show');
}

// Function to apply preset configurations
function applyPreset(presetName, panel) {
    if (!panel) {
        panel = document.querySelector('.banner-customization-panel');
        if (!panel) {
            console.error('Could not find banner customization panel for preset application');
            return;
        }
    }
    
    let presetConfig = {};
    
    switch(presetName) {
        case 'default':
            presetConfig = JSON.parse(JSON.stringify(defaultBannerConfig));
            break;
            
        case 'elegant':
            presetConfig = {
                borderRadius: 8,
                buttonBorderRadius: 30,
                countdownBorderRadius: 6,
                buttonBackground: 'linear-gradient(45deg, #3a7ab3, #63a4e1)',
                buttonTextColor: '#ffffff',
                buttonPadding: '12px 30px',
                buttonShine: true,
                shineAnimation: true,
                showCountdown: true,
                shineColor1: '#3a7ab3',
                shineColor2: '#63a4e1',
                accentColor: '#3a7ab3'
            };
            break;
            
        case 'vibrant':
            presetConfig = {
                borderRadius: 15,
                buttonBorderRadius: 25,
                countdownBorderRadius: 10,
                buttonBackground: 'linear-gradient(45deg, #ff4e50, #f9d423)',
                buttonTextColor: '#ffffff',
                buttonPadding: '15px 35px',
                buttonShine: true,
                shineAnimation: true,
                showCountdown: true,
                shineColor1: '#ff4e50',
                shineColor2: '#f9d423',
                accentColor: '#ff4e50'
            };
            break;
            
        case 'dark':
            presetConfig = {
                borderRadius: 0,
                buttonBorderRadius: 0,
                countdownBorderRadius: 0,
                buttonBackground: 'linear-gradient(45deg, #232526, #414345)',
                buttonTextColor: '#ffffff',
                buttonPadding: '12px 25px',
                buttonShine: false,
                shineAnimation: true,
                showCountdown: true,
                shineColor1: '#232526',
                shineColor2: '#414345',
                accentColor: '#232526'
            };
            break;
            
        case 'nature':
            presetConfig = {
                borderRadius: 20,
                buttonBorderRadius: 40,
                countdownBorderRadius: 15,
                buttonBackground: 'linear-gradient(45deg, #56ab2f, #a8e063)',
                buttonTextColor: '#ffffff',
                buttonPadding: '14px 32px',
                buttonShine: true,
                shineAnimation: true,
                showCountdown: true,
                shineColor1: '#56ab2f',
                shineColor2: '#a8e063',
                accentColor: '#56ab2f'
            };
            break;
    // Apply the preset configuration
    bannerConfig = { ...bannerConfig, ...presetConfig };
    
    // Update UI elements
    updateUIFromConfig();
    
    // Update CSS variables
    updateCSSVariables();
    
    // Update preview
    updatePreview();
}

// Function to load saved banner configuration
function loadBannerConfiguration() {
    const savedConfig = localStorage.getItem('fooodis-banner-config');
    if (savedConfig) {
        try {
            const parsedConfig = JSON.parse(savedConfig);
            Object.assign(bannerConfig, parsedConfig);
            console.log('Loaded banner configuration from localStorage');
        } catch (e) {
            console.error('Error parsing banner configuration:', e);
        }
    }
}

// Load banner configuration on initialization
loadBannerConfiguration();

// Export functions for use in other scripts
window.injectEnhancedBanner = injectEnhancedBanner;
window.initCountdownTimer = initCountdownTimer;
window.bannerConfig = bannerConfig;

// End of enhanced banner script
