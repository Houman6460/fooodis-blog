# Avatar Path Issue - The Right Path Structure for Fooodis Chatbot

## Current Problem: Missing Avatar Paths in Configuration

Looking at your `chatbot-config.json`, the assistants don't have avatar paths defined:

```json
{
  "id": "support-assistant",
  "name": "Sarah Johnson - Customer Support",
  "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
  "model": "gpt-4",
  "systemPrompt": "...",
  "status": "active"
  // ❌ NO AVATAR PROPERTY!
}
```

## The Right Path Structure You Need

### 1. **Add Avatar Paths to Configuration**
Your `chatbot-config.json` should look like this:

```json
{
  "id": "support-assistant",
  "name": "Sarah Johnson - Customer Support",
  "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
  "model": "gpt-4",
  "systemPrompt": "...",
  "status": "active",
  "avatar": "https://yourdomain.com/images/avatars/support-avatar.png"
}
```

### 2. **Correct Directory Structure on Your Server**
Create this folder structure on your online host:

```
your-website-root/
├── images/
│   └── avatars/
│       ├── support-avatar.png
│       ├── sales-avatar.png
│       ├── billing-avatar.png
│       ├── technical-avatar.png
│       ├── delivery-avatar.png
│       └── general-avatar.png
├── js/
│   └── chatbot-widget.js
├── api/
└── chatbot-config.json
```

### 3. **The Exact Paths to Use**

Replace `yourdomain.com` with your actual domain:

- **Support Agent**: `https://yourdomain.com/images/avatars/support-avatar.png`
- **Sales Agent**: `https://yourdomain.com/images/avatars/sales-avatar.png`
- **Billing Agent**: `https://yourdomain.com/images/avatars/billing-avatar.png`
- **Technical Agent**: `https://yourdomain.com/images/avatars/technical-avatar.png`
- **Delivery Agent**: `https://yourdomain.com/images/avatars/delivery-avatar.png`
- **General Agent**: `https://yourdomain.com/images/avatars/general-avatar.png`

## Quick Fix Steps

### Step 1: Update Your Configuration
Edit your `chatbot-config.json` and add the `avatar` property to each assistant:

```json
{
  "assistants": [
    {
      "id": "support-assistant",
      "name": "Sarah Johnson - Customer Support",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/support-avatar.png"
    },
    {
      "id": "sales-assistant", 
      "name": "Marcus Chen - Sales",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/sales-avatar.png"
    },
    {
      "id": "billing-assistant",
      "name": "Elena Rodriguez - Billing",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/billing-avatar.png"
    },
    {
      "id": "technical-assistant",
      "name": "David Kim - Technical Support",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/technical-avatar.png"
    },
    {
      "id": "delivery-assistant",
      "name": "Lisa Anderson - Delivery",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/delivery-avatar.png"
    },
    {
      "id": "general-assistant",
      "name": "Alex Thompson - General Inquiries",
      "assistantId": "asst_To6VWuiz6x72KsYDMxaWUsb6",
      "model": "gpt-4",
      "systemPrompt": "...",
      "status": "active",
      "avatar": "https://yourdomain.com/images/avatars/general-avatar.png"
    }
  ]
}
```

### Step 2: Upload Avatar Images
Upload your avatar image files to: `/images/avatars/` directory on your server

### Step 3: Test the Paths
Visit each URL directly in your browser:
- `https://yourdomain.com/images/avatars/support-avatar.png`
- If you see the image, the path is correct
- If you get 404 error, the file is missing or in wrong location

## Alternative: Use Default Avatar System

If you don't have custom avatars, the system has a **default avatar function**. In your `chatbot-widget.js`, there's a `getDefaultAvatar()` function that provides a fallback.

You can set all agents to use the same default:

```json
"avatar": "https://yourdomain.com/images/avatars/default-avatar.png"
```

## The Most Common Mistake

Many people use **relative paths** like:
- ❌ `./images/avatars/support-avatar.png`
- ❌ `/images/avatars/support-avatar.png` 
- ❌ `images/avatars/support-avatar.png`

But you need **full absolute URLs**:
- ✅ `https://yourdomain.com/images/avatars/support-avatar.png`

## Test Your Fix

1. **Update the configuration** with full URLs
2. **Upload avatar images** to `/images/avatars/` folder
3. **Clear browser cache** completely
4. **Test each avatar URL** directly in browser
5. **Open your chatbot** and verify avatars appear

## How Avatar Loading Works in the Code

The chatbot system loads avatars through several mechanisms:

### Configuration Loading
- The `loadSavedSettings()` function reads `chatbot-config.json`
- Each assistant's avatar property is used for display
- If no avatar is specified, `getDefaultAvatar()` provides fallback

### Avatar Display Updates
- `updateWidgetAgent()` function updates the displayed avatar
- `updateAvatar(avatarUrl)` function can dynamically change avatars
- `setupAvatarUpdateListener()` listens for avatar changes

### Fallback System
- `getDefaultAvatar()` provides a base64 encoded default image
- System gracefully handles missing or broken avatar URLs
- Error handling prevents broken images from crashing the widget

## Server Configuration Requirements

### For Express.js Servers
Ensure static file serving is configured:
```javascript
app.use(express.static('public'));
app.use('/images', express.static('images'));
```

### For Apache Servers
Ensure `.htaccess` allows image serving:
```apache
<Files "*.png">
    Header set Content-Type "image/png"
</Files>
<Files "*.jpg">
    Header set Content-Type "image/jpeg"
</Files>
```

### For Nginx Servers
Ensure image serving is configured:
```nginx
location /images/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

## Security Considerations

- **Validate avatar URLs** to prevent XSS attacks
- **Use HTTPS** for all avatar sources on HTTPS sites
- **Sanitize user-uploaded avatars** if allowing custom uploads
- **Implement proper CORS headers** for external image sources

## Performance Optimization

- **Compress avatar images** (use WebP format when possible)
- **Optimize image sizes** (recommend 64x64 or 128x128 pixels)
- **Implement caching** for frequently loaded avatars
- **Use CDN** for faster image delivery if needed

## Troubleshooting Checklist

### Before Making Changes
- [ ] Backup current `chatbot-config.json`
- [ ] Document current avatar setup
- [ ] Check browser console for errors
- [ ] Note your domain name exactly

### During Implementation
- [ ] Add avatar property to all assistants in config
- [ ] Upload all avatar image files to correct directory
- [ ] Use full absolute URLs (https://yourdomain.com/...)
- [ ] Test each avatar URL individually in browser

### After Implementation
- [ ] Clear browser cache completely
- [ ] Test chatbot on your live site
- [ ] Verify all agents show correct avatars
- [ ] Check browser console for any errors
- [ ] Test agent switching to ensure avatars change properly

## Key Success Factors

1. **Complete URLs**: Always use full https://yourdomain.com/path format
2. **Correct Directory**: Upload images to `/images/avatars/` exactly
3. **Valid Configuration**: Every assistant needs an `avatar` property
4. **File Accessibility**: Each avatar URL must work when visited directly
5. **Cache Clearing**: Always clear browser cache after changes

The key is that **every avatar path must be a complete, working URL** that you can visit directly in your browser.

---

**Guide Created**: July 9, 2025
**Time**: 23:40 CET
**Purpose**: Fixing avatar display paths for online hosted Fooodis Chatbot
**Scope**: Complete configuration and path structure solution
