{
  "version": 3,
  "sources": ["../bundle-jfwYHF/checked-fetch.js", "../bundle-6wWAM9/checked-fetch.js", "../../../functions/api/automation/paths/%5Bid%5D/run.js", "../../../functions/api/automation/assistants/%5Bid%5D.js", "../../../functions/api/automation/paths/%5Bid%5D.js", "../../../functions/api/blog/posts/%5Bid%5D.js", "../../../functions/api/stats/posts/%5Bid%5D.js", "../../../functions/api/media/serve/%5B%5Bpath%5D%5D.js", "../../../functions/api/scheduled-posts/%5Bid%5D/publish.js", "../../../functions/api/tickets/%5Bid%5D/attachments.js", "../../../functions/api/tickets/%5Bid%5D/messages.js", "../../../functions/api/automation/assistants/index.js", "../../../functions/api/automation/config/index.js", "../../../functions/api/automation/logs/index.js", "../../../functions/api/automation/paths/index.js", "../../../functions/api/automation/prompts/index.js", "../../../functions/api/automation/stats/index.js", "../../../functions/api/blog/posts/index.js", "../../../functions/api/chatbot/analytics.js", "../../../functions/api/chatbot/conversations.js", "../../../functions/api/chatbot/messages.js", "../../../functions/api/chatbot/rate.js", "../../../functions/api/chatbot/scenarios.js", "../../../functions/api/chatbot/settings.js", "../../../functions/api/chatbot/users.js", "../../../functions/api/chatbot/widget.js", "../../../functions/api/customers/auth.js", "../../../functions/api/media/bulk.js", "../../../functions/api/media/folders/index.js", "../../../functions/api/profile/avatar.js", "../../../functions/api/profile/password.js", "../../../functions/api/scheduled-posts/check.js", "../../../functions/api/stats/dashboard.js", "../../../functions/api/subscribers/import.js", "../../../functions/api/subscribers/popup-config.js", "../../../functions/api/tickets/categories.js", "../../../functions/api/categories/%5Bid%5D.js", "../../../functions/api/media/%5Bid%5D.js", "../../../functions/api/scheduled-posts/%5Bid%5D.js", "../../../functions/api/subcategories/%5Bid%5D.js", "../../../functions/api/subscribers/%5Bid%5D.js", "../../../functions/api/tags/%5Bid%5D.js", "../../../functions/api/tickets/%5Bid%5D.js", "../../../functions/api/categories/index.js", "../../../functions/api/chatbot/index.js", "../../../functions/api/customers/index.js", "../../../functions/api/media/index.js", "../../../functions/api/profile/index.js", "../../../functions/api/scheduled-posts/index.js", "../../../functions/api/settings/index.js", "../../../functions/api/stats/index.js", "../../../functions/api/subcategories/index.js", "../../../functions/api/subscribers/index.js", "../../../functions/api/tags/index.js", "../../../functions/api/tickets/index.js", "../pages-CGgU9v/functionsRoutes-0.8962130186621535.mjs", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/node_modules/path-to-regexp/src/index.ts", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/pages-template-worker.ts", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-6wWAM9/middleware-insertion-facade.js", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts", "../bundle-6wWAM9/middleware-loader.entry.ts", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-jfwYHF/middleware-insertion-facade.js", "../../../../../../../../usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts", "../bundle-jfwYHF/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/dev-vPyXwY",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\n * Manually Run Automation Path API\n * POST /api/automation/paths/:id/run - Trigger an automation path execution\n */\n\nexport async function onRequestPost(context) {\n  const { request, env, params } = context;\n  const pathId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get the automation path\n    const path = await env.DB.prepare(\n      \"SELECT * FROM automation_paths WHERE id = ?\"\n    ).bind(pathId).first();\n\n    if (!path) {\n      return new Response(JSON.stringify({ error: \"Automation path not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Parse JSON fields\n    const pathData = {\n      ...path,\n      topics: path.topics ? JSON.parse(path.topics) : [],\n      languages: path.languages ? JSON.parse(path.languages) : ['en']\n    };\n\n    // Create a generation log entry\n    const logId = crypto.randomUUID();\n    const now = Date.now();\n\n    await env.DB.prepare(`\n      INSERT INTO ai_generation_logs (\n        id, automation_path_id, path_name, status, content_type, category,\n        topic, language, started_at, created_at\n      ) VALUES (?, ?, ?, 'pending', ?, ?, ?, ?, ?, ?)\n    `).bind(\n      logId,\n      pathId,\n      path.name,\n      path.content_type,\n      path.category,\n      pathData.topics[0] || '',\n      pathData.languages[0] || 'en',\n      now,\n      now\n    ).run();\n\n    // Update last_run timestamp on the path\n    await env.DB.prepare(\n      \"UPDATE automation_paths SET last_run = ? WHERE id = ?\"\n    ).bind(now, pathId).run();\n\n    // Return the path data and log ID for the frontend to handle generation\n    // The actual OpenAI API call will be made from the frontend since we don't\n    // store the API key in the backend for security reasons\n    return new Response(JSON.stringify({\n      success: true,\n      message: \"Automation run initiated\",\n      path: pathData,\n      log_id: logId,\n      started_at: now\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PATCH /api/automation/paths/:id/run - Update generation status\n * Used to update the log entry after frontend completes generation\n */\nexport async function onRequestPatch(context) {\n  const { request, env, params } = context;\n  const pathId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    if (!data.log_id) {\n      return new Response(JSON.stringify({ error: \"log_id is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Update the log entry\n    const updates = ['completed_at = ?', 'status = ?'];\n    const values = [now, data.status || 'completed'];\n\n    if (data.generated_title) {\n      updates.push('generated_title = ?');\n      values.push(data.generated_title);\n    }\n    if (data.generated_content) {\n      updates.push('generated_content = ?');\n      values.push(data.generated_content);\n    }\n    if (data.generated_excerpt) {\n      updates.push('generated_excerpt = ?');\n      values.push(data.generated_excerpt);\n    }\n    if (data.tokens_used !== undefined) {\n      updates.push('tokens_used = ?');\n      values.push(data.tokens_used);\n    }\n    if (data.generation_time_ms !== undefined) {\n      updates.push('generation_time_ms = ?');\n      values.push(data.generation_time_ms);\n    }\n    if (data.published_post_id) {\n      updates.push('published_post_id = ?');\n      values.push(data.published_post_id);\n      updates.push('published_at = ?');\n      values.push(now);\n    }\n    if (data.error_message) {\n      updates.push('error_message = ?');\n      values.push(data.error_message);\n    }\n    if (data.model_used) {\n      updates.push('model_used = ?');\n      values.push(data.model_used);\n    }\n    if (data.prompt_used) {\n      updates.push('prompt_used = ?');\n      values.push(data.prompt_used);\n    }\n\n    values.push(data.log_id);\n\n    await env.DB.prepare(`\n      UPDATE ai_generation_logs SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Update API usage stats\n    if (data.tokens_used) {\n      const today = new Date().toISOString().split('T')[0];\n      const isSuccess = data.status === 'completed';\n\n      await env.DB.prepare(`\n        INSERT INTO ai_api_usage (id, date, total_tokens, requests_count, successful_requests, failed_requests, updated_at)\n        VALUES (?, ?, ?, 1, ?, ?, ?)\n        ON CONFLICT(date) DO UPDATE SET\n          total_tokens = total_tokens + excluded.total_tokens,\n          requests_count = requests_count + 1,\n          successful_requests = successful_requests + excluded.successful_requests,\n          failed_requests = failed_requests + excluded.failed_requests,\n          updated_at = excluded.updated_at\n      `).bind(\n        crypto.randomUUID(),\n        today,\n        data.tokens_used,\n        isSuccess ? 1 : 0,\n        isSuccess ? 0 : 1,\n        now\n      ).run();\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      log_id: data.log_id,\n      status: data.status\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single AI Assistant API\n * GET /api/automation/assistants/:id - Get assistant details\n * PUT /api/automation/assistants/:id - Update an assistant\n * DELETE /api/automation/assistants/:id - Delete an assistant\n */\n\n/**\n * GET /api/automation/assistants/:id\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const assistant = await env.DB.prepare(\n      \"SELECT * FROM ai_assistants WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!assistant) {\n      return new Response(JSON.stringify({ error: \"Assistant not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({\n      ...assistant,\n      is_active: assistant.is_active === 1,\n      is_default: assistant.is_default === 1\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/automation/assistants/:id - Update an assistant\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    const updates = [];\n    const values = [];\n\n    if (data.openai_assistant_id !== undefined) {\n      updates.push('openai_assistant_id = ?');\n      values.push(data.openai_assistant_id);\n    }\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n    }\n    if (data.description !== undefined) {\n      updates.push('description = ?');\n      values.push(data.description);\n    }\n    if (data.type !== undefined) {\n      updates.push('type = ?');\n      values.push(data.type);\n    }\n    if (data.model !== undefined) {\n      updates.push('model = ?');\n      values.push(data.model);\n    }\n    if (data.instructions !== undefined) {\n      updates.push('instructions = ?');\n      values.push(data.instructions);\n    }\n    if (data.temperature !== undefined) {\n      updates.push('temperature = ?');\n      values.push(data.temperature);\n    }\n    if (data.max_tokens !== undefined) {\n      updates.push('max_tokens = ?');\n      values.push(data.max_tokens);\n    }\n    if (data.is_active !== undefined) {\n      updates.push('is_active = ?');\n      values.push(data.is_active ? 1 : 0);\n    }\n    if (data.is_default !== undefined) {\n      updates.push('is_default = ?');\n      values.push(data.is_default ? 1 : 0);\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    if (updates.length === 1) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    await env.DB.prepare(`\n      UPDATE ai_assistants SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    const assistant = await env.DB.prepare(\n      \"SELECT * FROM ai_assistants WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      assistant: {\n        ...assistant,\n        is_active: assistant?.is_active === 1,\n        is_default: assistant?.is_default === 1\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/automation/assistants/:id\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Don't allow deleting default assistants\n    const assistant = await env.DB.prepare(\n      \"SELECT is_default FROM ai_assistants WHERE id = ?\"\n    ).bind(id).first();\n\n    if (assistant?.is_default === 1) {\n      return new Response(JSON.stringify({ error: \"Cannot delete default assistant\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const result = await env.DB.prepare(\n      \"DELETE FROM ai_assistants WHERE id = ?\"\n    ).bind(id).run();\n\n    if (result.meta.changes === 0) {\n      return new Response(JSON.stringify({ error: \"Assistant not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * PUT /api/automation/paths/:id - Update an automation path\n * DELETE /api/automation/paths/:id - Delete an automation path\n */\n\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    \n    // Check if exists\n    const exists = await env.DB.prepare(\"SELECT id FROM automation_paths WHERE id = ?\").bind(id).first();\n    if (!exists) {\n      return new Response(JSON.stringify({ error: \"Path not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // We only update fields that are provided (partial update) or full update\n    // For simplicity, we assume full object is sent or we merge carefully.\n    // But usually PUT is replacement. Let's assume the UI sends the full updated object.\n    \n    // To be safe, we construct the update query based on what's valid.\n    // But since the UI is likely sending mostly the same structure as POST:\n    \n    const includeImages = data.includeImages !== undefined ? (data.includeImages ? 1 : 0) : \n                          (data.include_images !== undefined ? (data.include_images ? 1 : 0) : 0);\n\n    await env.DB.prepare(`\n      UPDATE automation_paths SET\n        name = ?,\n        content_type = ?,\n        assistant_id = ?,\n        category = ?,\n        subcategory = ?,\n        topics = ?,\n        mode = ?,\n        schedule_type = ?,\n        schedule_time = ?,\n        prompt_template = ?,\n        include_images = ?,\n        media_folder = ?,\n        languages = ?,\n        status = ?,\n        last_run = ?\n      WHERE id = ?\n    `).bind(\n      data.name,\n      data.contentType || data.content_type,\n      data.assistantId || data.assistant_id,\n      data.category,\n      data.subcategory,\n      JSON.stringify(data.topics || []),\n      data.mode,\n      data.scheduleType || data.schedule_type,\n      data.scheduleTime || data.schedule_time,\n      data.promptTemplate || data.prompt_template,\n      includeImages,\n      data.mediaFolder || data.media_folder,\n      JSON.stringify(data.languages || []),\n      data.status || 'active',\n      data.lastRun || data.last_run,\n      id\n    ).run();\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const result = await env.DB.prepare(\"DELETE FROM automation_paths WHERE id = ?\").bind(id).run();\n    \n    if (result.meta.changes === 0) {\n        // D1 run() returns meta with changes count\n         return new Response(JSON.stringify({ error: \"Path not found or already deleted\" }), {\n            status: 404,\n            headers: { \"Content-Type\": \"application/json\" }\n         });\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * GET /api/blog/posts/:id - Get a single blog post\n * PUT /api/blog/posts/:id - Update a blog post\n * DELETE /api/blog/posts/:id - Delete a blog post\n */\n\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const post = await env.DB.prepare(\"SELECT * FROM blog_posts WHERE id = ?\").bind(id).first();\n    \n    if (!post) {\n      return new Response(JSON.stringify({ error: \"Post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Parse JSON fields\n    post.tags = post.tags ? JSON.parse(post.tags) : [];\n\n    return new Response(JSON.stringify(post), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/blog/posts/:id - Update a blog post (supports partial updates)\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Get current post to support partial updates\n    const currentPost = await env.DB.prepare(\n      \"SELECT * FROM blog_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!currentPost) {\n      return new Response(JSON.stringify({ error: \"Post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Build dynamic update - only update provided fields\n    const updates = [];\n    const values = [];\n\n    if (data.title !== undefined) {\n      updates.push('title = ?');\n      values.push(data.title);\n    }\n    if (data.content !== undefined) {\n      updates.push('content = ?');\n      values.push(data.content);\n    }\n    if (data.excerpt !== undefined) {\n      updates.push('excerpt = ?');\n      values.push(data.excerpt);\n    }\n    if (data.image_url !== undefined || data.imageUrl !== undefined) {\n      updates.push('image_url = ?');\n      values.push(data.image_url || data.imageUrl);\n    }\n    if (data.author !== undefined) {\n      updates.push('author = ?');\n      values.push(data.author);\n    }\n    if (data.category !== undefined) {\n      updates.push('category = ?');\n      values.push(data.category);\n    }\n    if (data.subcategory !== undefined) {\n      updates.push('subcategory = ?');\n      values.push(data.subcategory);\n    }\n    if (data.tags !== undefined) {\n      updates.push('tags = ?');\n      values.push(JSON.stringify(data.tags || []));\n    }\n    if (data.published_date !== undefined || data.publishedDate !== undefined) {\n      updates.push('published_date = ?');\n      values.push(data.published_date || data.publishedDate);\n    }\n    if (data.scheduled_date !== undefined || data.scheduledDate !== undefined) {\n      updates.push('scheduled_date = ?');\n      values.push(data.scheduled_date || data.scheduledDate);\n    }\n    if (data.status !== undefined) {\n      updates.push('status = ?');\n      values.push(data.status);\n    }\n    if (data.featured !== undefined) {\n      updates.push('featured = ?');\n      values.push(data.featured ? 1 : 0);\n    }\n    if (data.likes !== undefined) {\n      updates.push('likes = ?');\n      values.push(data.likes);\n    }\n    if (data.views !== undefined) {\n      updates.push('views = ?');\n      values.push(data.views);\n    }\n    if (data.slug !== undefined) {\n      updates.push('slug = ?');\n      values.push(data.slug);\n    } else if (data.title !== undefined) {\n      // Auto-generate slug if title changed\n      updates.push('slug = ?');\n      values.push(data.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, ''));\n    }\n\n    // Always update updated_at\n    updates.push('updated_at = ?');\n    values.push(now);\n\n    if (updates.length === 1) { // Only updated_at\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Add ID for WHERE clause\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE blog_posts SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Fetch updated post\n    const updatedPost = await env.DB.prepare(\n      \"SELECT * FROM blog_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    // Parse JSON fields for response\n    if (updatedPost) {\n      updatedPost.tags = updatedPost.tags ? JSON.parse(updatedPost.tags) : [];\n      updatedPost.featured = updatedPost.featured === 1;\n    }\n\n    return new Response(JSON.stringify({ success: true, post: updatedPost }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PATCH /api/blog/posts/:id - Toggle featured status (convenience endpoint)\n */\nexport async function onRequestPatch(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    // If toggling featured status\n    if (data.toggle === 'featured') {\n      const post = await env.DB.prepare(\n        \"SELECT featured FROM blog_posts WHERE id = ?\"\n      ).bind(id).first();\n\n      if (!post) {\n        return new Response(JSON.stringify({ error: \"Post not found\" }), {\n          status: 404,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n\n      const newFeatured = post.featured === 1 ? 0 : 1;\n      \n      await env.DB.prepare(\n        \"UPDATE blog_posts SET featured = ?, updated_at = ? WHERE id = ?\"\n      ).bind(newFeatured, Date.now(), id).run();\n\n      return new Response(JSON.stringify({ \n        success: true, \n        id,\n        featured: newFeatured === 1\n      }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // If incrementing views\n    if (data.increment === 'views') {\n      await env.DB.prepare(\n        \"UPDATE blog_posts SET views = views + 1 WHERE id = ?\"\n      ).bind(id).run();\n\n      return new Response(JSON.stringify({ success: true, id }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // If incrementing likes\n    if (data.increment === 'likes') {\n      await env.DB.prepare(\n        \"UPDATE blog_posts SET likes = likes + 1 WHERE id = ?\"\n      ).bind(id).run();\n\n      return new Response(JSON.stringify({ success: true, id }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ error: \"Invalid patch operation\" }), {\n      status: 400,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const result = await env.DB.prepare(\"DELETE FROM blog_posts WHERE id = ?\").bind(id).run();\n    \n    if (result.meta.changes === 0) {\n         return new Response(JSON.stringify({ error: \"Post not found or already deleted\" }), {\n            status: 404,\n            headers: { \"Content-Type\": \"application/json\" }\n         });\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Post Statistics API\n * GET /api/stats/posts/:id - Get statistics for a specific post\n * PUT /api/stats/posts/:id - Update statistics for a post\n */\n\n/**\n * GET - Get stats for a specific post\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const postId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get post info with stats\n    const post = await env.DB.prepare(`\n      SELECT p.id, p.title, p.category, p.published_date, p.created_at,\n             ps.views, ps.unique_views, \n             ps.shares_facebook, ps.shares_twitter, ps.shares_linkedin, ps.shares_email, ps.shares_total,\n             ps.avg_read_time, ps.bounce_rate\n      FROM blog_posts p\n      LEFT JOIN post_stats ps ON p.id = ps.post_id\n      WHERE p.id = ?\n    `).bind(postId).first();\n\n    if (!post) {\n      return new Response(JSON.stringify({ error: \"Post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get comments count\n    const commentsCount = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM comments WHERE post_id = ? AND status = 'approved'\"\n    ).bind(postId).first();\n\n    // Get daily views for last 30 days\n    let dailyViews = [];\n    try {\n      const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);\n      const { results } = await env.DB.prepare(`\n        SELECT DATE(created_at / 1000, 'unixepoch') as date, COUNT(*) as views\n        FROM page_views\n        WHERE post_id = ? AND created_at >= ?\n        GROUP BY date\n        ORDER BY date ASC\n      `).bind(postId, thirtyDaysAgo).all();\n      dailyViews = results || [];\n    } catch (e) {\n      // Table might not exist\n    }\n\n    // Get referrer breakdown\n    let referrers = [];\n    try {\n      const { results } = await env.DB.prepare(`\n        SELECT referrer, COUNT(*) as count\n        FROM page_views\n        WHERE post_id = ?\n        GROUP BY referrer\n        ORDER BY count DESC\n        LIMIT 10\n      `).bind(postId).all();\n      referrers = results || [];\n    } catch (e) {\n      // Table might not exist\n    }\n\n    return new Response(JSON.stringify({\n      post: {\n        id: post.id,\n        title: post.title,\n        category: post.category,\n        published_date: post.published_date\n      },\n      stats: {\n        views: post.views || 0,\n        uniqueViews: post.unique_views || 0,\n        shares: {\n          facebook: post.shares_facebook || 0,\n          twitter: post.shares_twitter || 0,\n          linkedin: post.shares_linkedin || 0,\n          email: post.shares_email || 0,\n          total: post.shares_total || 0\n        },\n        comments: commentsCount?.total || 0,\n        avgReadTime: Math.round((post.avg_read_time || 0) / 60), // In minutes\n        bounceRate: post.bounce_rate || 0\n      },\n      dailyViews,\n      referrers\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT - Manually update stats for a post\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const postId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Check if stats record exists\n    const existing = await env.DB.prepare(\n      \"SELECT id FROM post_stats WHERE post_id = ?\"\n    ).bind(postId).first();\n\n    if (!existing) {\n      // Create new stats record\n      await env.DB.prepare(`\n        INSERT INTO post_stats (id, post_id, views, unique_views, shares_total, avg_read_time, updated_at)\n        VALUES (?, ?, ?, ?, ?, ?, ?)\n      `).bind(\n        `stats_${postId}`,\n        postId,\n        data.views || 0,\n        data.unique_views || 0,\n        data.shares_total || 0,\n        data.avg_read_time || 0,\n        now\n      ).run();\n    } else {\n      // Build update query\n      const updates = [];\n      const values = [];\n\n      if (data.views !== undefined) {\n        updates.push('views = ?');\n        values.push(data.views);\n      }\n      if (data.unique_views !== undefined) {\n        updates.push('unique_views = ?');\n        values.push(data.unique_views);\n      }\n      if (data.shares_facebook !== undefined) {\n        updates.push('shares_facebook = ?');\n        values.push(data.shares_facebook);\n      }\n      if (data.shares_twitter !== undefined) {\n        updates.push('shares_twitter = ?');\n        values.push(data.shares_twitter);\n      }\n      if (data.shares_linkedin !== undefined) {\n        updates.push('shares_linkedin = ?');\n        values.push(data.shares_linkedin);\n      }\n      if (data.shares_email !== undefined) {\n        updates.push('shares_email = ?');\n        values.push(data.shares_email);\n      }\n      if (data.shares_total !== undefined) {\n        updates.push('shares_total = ?');\n        values.push(data.shares_total);\n      }\n      if (data.avg_read_time !== undefined) {\n        updates.push('avg_read_time = ?');\n        values.push(data.avg_read_time);\n      }\n\n      if (updates.length > 0) {\n        updates.push('updated_at = ?');\n        values.push(now);\n        values.push(postId);\n\n        await env.DB.prepare(`\n          UPDATE post_stats SET ${updates.join(', ')} WHERE post_id = ?\n        `).bind(...values).run();\n      }\n    }\n\n    // Also update the blog_posts table\n    if (data.views !== undefined) {\n      await env.DB.prepare(\n        \"UPDATE blog_posts SET views = ?, updated_at = ? WHERE id = ?\"\n      ).bind(data.views, now, postId).run();\n    }\n\n    return new Response(JSON.stringify({ success: true, post_id: postId }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Media Serve API - Serves files from R2\n * GET /api/media/serve/:path - Serve a file from R2 bucket\n */\n\nexport async function onRequestGet(context) {\n  const { env, params, request } = context;\n\n  if (!env.MEDIA_BUCKET) {\n    return new Response(\"R2 bucket not configured\", { status: 500 });\n  }\n\n  try {\n    // Get the path from the URL\n    const path = params.path ? params.path.join('/') : '';\n    \n    if (!path) {\n      return new Response(\"File path required\", { status: 400 });\n    }\n\n    // Decode the path in case it was URL encoded\n    const r2Key = decodeURIComponent(path);\n\n    // Get object from R2\n    const object = await env.MEDIA_BUCKET.get(r2Key);\n\n    if (!object) {\n      return new Response(\"File not found\", { status: 404 });\n    }\n\n    // Get the content type from object metadata or infer from extension\n    const contentType = object.httpMetadata?.contentType || inferContentType(r2Key);\n\n    // Create response headers\n    const headers = new Headers();\n    headers.set(\"Content-Type\", contentType);\n    headers.set(\"Cache-Control\", \"public, max-age=31536000\"); // Cache for 1 year\n    headers.set(\"ETag\", object.httpEtag);\n    \n    // Handle conditional requests\n    const ifNoneMatch = request.headers.get(\"If-None-Match\");\n    if (ifNoneMatch === object.httpEtag) {\n      return new Response(null, { status: 304, headers });\n    }\n\n    // Add CORS headers\n    headers.set(\"Access-Control-Allow-Origin\", \"*\");\n    headers.set(\"Access-Control-Allow-Methods\", \"GET, HEAD, OPTIONS\");\n\n    return new Response(object.body, { headers });\n\n  } catch (error) {\n    console.error('Media serve error:', error);\n    return new Response(error.message, { status: 500 });\n  }\n}\n\n/**\n * Handle OPTIONS for CORS\n */\nexport async function onRequestOptions() {\n  return new Response(null, {\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, HEAD, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type\",\n      \"Access-Control-Max-Age\": \"86400\"\n    }\n  });\n}\n\n/**\n * Infer content type from file extension\n */\nfunction inferContentType(filename) {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  const mimeTypes = {\n    'jpg': 'image/jpeg',\n    'jpeg': 'image/jpeg',\n    'png': 'image/png',\n    'gif': 'image/gif',\n    'webp': 'image/webp',\n    'svg': 'image/svg+xml',\n    'mp4': 'video/mp4',\n    'webm': 'video/webm',\n    'pdf': 'application/pdf',\n    'json': 'application/json',\n    'txt': 'text/plain',\n    'html': 'text/html',\n    'css': 'text/css',\n    'js': 'application/javascript'\n  };\n  return mimeTypes[ext] || 'application/octet-stream';\n}\n", "/**\n * Publish Scheduled Post API\n * POST /api/scheduled-posts/:id/publish - Manually publish a scheduled post\n * \n * This endpoint:\n * 1. Creates a new blog_post from the scheduled post data\n * 2. Updates the scheduled post status to 'published'\n * 3. Links the published post back to scheduled_posts\n */\n\nexport async function onRequestPost(context) {\n  const { env, params } = context;\n  const scheduledPostId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n\n    // Get the scheduled post\n    const scheduledPost = await env.DB.prepare(\n      \"SELECT * FROM scheduled_posts WHERE id = ?\"\n    ).bind(scheduledPostId).first();\n\n    if (!scheduledPost) {\n      return new Response(JSON.stringify({ error: \"Scheduled post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (scheduledPost.status === 'published') {\n      return new Response(JSON.stringify({ \n        error: \"Post already published\",\n        published_post_id: scheduledPost.published_post_id\n      }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Update status to publishing\n    await env.DB.prepare(\n      \"UPDATE scheduled_posts SET status = 'publishing', last_attempt = ?, updated_at = ? WHERE id = ?\"\n    ).bind(now, now, scheduledPostId).run();\n\n    // Create the blog post\n    const blogPostId = crypto.randomUUID();\n    \n    try {\n      await env.DB.prepare(`\n        INSERT INTO blog_posts (\n          id, title, content, excerpt, image_url, author, category, subcategory, tags,\n          published_date, status, featured, views, likes, comments_count, created_at, updated_at, slug\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'published', ?, 0, 0, 0, ?, ?, ?)\n      `).bind(\n        blogPostId,\n        scheduledPost.title,\n        scheduledPost.content,\n        scheduledPost.excerpt,\n        scheduledPost.image_url,\n        scheduledPost.author,\n        scheduledPost.category,\n        scheduledPost.subcategory,\n        scheduledPost.tags, // Already JSON string\n        new Date().toISOString(),\n        scheduledPost.is_featured,\n        now,\n        now,\n        scheduledPost.slug\n      ).run();\n\n      // Update scheduled post as published\n      await env.DB.prepare(`\n        UPDATE scheduled_posts SET \n          status = 'published', \n          published_post_id = ?, \n          updated_at = ? \n        WHERE id = ?\n      `).bind(blogPostId, now, scheduledPostId).run();\n\n      // Log the publish event\n      await env.DB.prepare(`\n        INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n        VALUES (?, ?, 'published', ?, ?)\n      `).bind(\n        crypto.randomUUID(),\n        scheduledPostId,\n        JSON.stringify({ \n          blog_post_id: blogPostId,\n          published_at: new Date(now).toISOString(),\n          source: scheduledPost.source\n        }),\n        now\n      ).run();\n\n      // Update category post count\n      if (scheduledPost.category && scheduledPost.category !== 'Uncategorized') {\n        await env.DB.prepare(\n          \"UPDATE categories SET post_count = post_count + 1 WHERE name = ?\"\n        ).bind(scheduledPost.category).run();\n      }\n\n      return new Response(JSON.stringify({ \n        success: true,\n        message: \"Post published successfully\",\n        scheduled_post_id: scheduledPostId,\n        blog_post_id: blogPostId,\n        title: scheduledPost.title\n      }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n\n    } catch (publishError) {\n      // Update scheduled post with error\n      const retryCount = (scheduledPost.retry_count || 0) + 1;\n      const newStatus = retryCount >= (scheduledPost.max_retries || 3) ? 'failed' : 'pending';\n\n      await env.DB.prepare(`\n        UPDATE scheduled_posts SET \n          status = ?, \n          retry_count = ?, \n          error_message = ?, \n          last_attempt = ?,\n          updated_at = ? \n        WHERE id = ?\n      `).bind(newStatus, retryCount, publishError.message, now, now, scheduledPostId).run();\n\n      // Log the failure\n      await env.DB.prepare(`\n        INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n        VALUES (?, ?, 'failed', ?, ?)\n      `).bind(\n        crypto.randomUUID(),\n        scheduledPostId,\n        JSON.stringify({ \n          error: publishError.message,\n          retry_count: retryCount\n        }),\n        now\n      ).run();\n\n      throw publishError;\n    }\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Ticket Attachments API\n * POST /api/tickets/:id/attachments - Upload attachment to ticket\n * GET /api/tickets/:id/attachments - List attachments\n */\n\nconst ALLOWED_TYPES = [\n  'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n  'application/pdf', 'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'application/vnd.ms-excel',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  'text/plain', 'text/csv'\n];\nconst MAX_SIZE = 10 * 1024 * 1024; // 10MB\n\n/**\n * GET - List ticket attachments\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const ticketId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT id FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(ticketId, ticketId).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const { results: attachments } = await env.DB.prepare(`\n      SELECT * FROM ticket_attachments WHERE ticket_id = ? ORDER BY created_at DESC\n    `).bind(ticket.id).all();\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { attachments }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST - Upload attachment\n */\nexport async function onRequestPost(context) {\n  const { request, env, params } = context;\n  const ticketId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  if (!env.MEDIA_BUCKET) {\n    return new Response(JSON.stringify({ success: false, error: \"R2 bucket not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT * FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(ticketId, ticketId).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const contentType = request.headers.get('content-type') || '';\n    \n    if (!contentType.includes('multipart/form-data')) {\n      return new Response(JSON.stringify({ success: false, error: \"Content-Type must be multipart/form-data\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const formData = await request.formData();\n    const file = formData.get('file') || formData.get('attachment');\n    const messageId = formData.get('message_id');\n    const uploadedBy = formData.get('uploaded_by') || 'customer';\n    const uploadedById = formData.get('uploaded_by_id');\n\n    if (!file || !(file instanceof File)) {\n      return new Response(JSON.stringify({ success: false, error: \"No file provided\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return new Response(JSON.stringify({ \n        success: false, \n        error: \"File type not allowed\",\n        allowed: ALLOWED_TYPES\n      }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Validate file size\n    if (file.size > MAX_SIZE) {\n      return new Response(JSON.stringify({ \n        success: false, \n        error: \"File too large. Maximum size is 10MB\"\n      }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const attachmentId = `att_${crypto.randomUUID().split('-')[0]}`;\n    const ext = file.name.split('.').pop() || 'bin';\n    const r2Key = `tickets/${ticket.ticket_number}/${attachmentId}.${ext}`;\n\n    // Upload to R2\n    const fileBuffer = await file.arrayBuffer();\n    await env.MEDIA_BUCKET.put(r2Key, fileBuffer, {\n      httpMetadata: {\n        contentType: file.type,\n      },\n      customMetadata: {\n        originalFilename: file.name,\n        ticketId: ticket.id,\n        ticketNumber: ticket.ticket_number,\n        uploadedAt: new Date().toISOString()\n      }\n    });\n\n    const r2Url = `/api/media/serve/${encodeURIComponent(r2Key)}`;\n\n    // Save to database\n    const attachment = {\n      id: attachmentId,\n      ticket_id: ticket.id,\n      message_id: messageId || null,\n      filename: `${attachmentId}.${ext}`,\n      original_filename: file.name,\n      mime_type: file.type,\n      file_size: file.size,\n      r2_key: r2Key,\n      r2_url: r2Url,\n      uploaded_by: uploadedById,\n      uploaded_by_type: uploadedBy,\n      created_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO ticket_attachments (\n        id, ticket_id, message_id, filename, original_filename, mime_type,\n        file_size, r2_key, r2_url, uploaded_by, uploaded_by_type, created_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      attachment.id, attachment.ticket_id, attachment.message_id,\n      attachment.filename, attachment.original_filename, attachment.mime_type,\n      attachment.file_size, attachment.r2_key, attachment.r2_url,\n      attachment.uploaded_by, attachment.uploaded_by_type, attachment.created_at\n    ).run();\n\n    // Update ticket\n    await env.DB.prepare(\n      \"UPDATE support_tickets SET updated_at = ? WHERE id = ?\"\n    ).bind(now, ticket.id).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { attachment }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Ticket Messages API\n * GET /api/tickets/:id/messages - Get messages for a ticket\n * POST /api/tickets/:id/messages - Add a reply/message to a ticket\n */\n\n/**\n * GET - Get ticket messages\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const ticketId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT id FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(ticketId, ticketId).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get messages\n    const { results: messages } = await env.DB.prepare(`\n      SELECT m.*, \n        (SELECT GROUP_CONCAT(a.id || '|' || a.filename || '|' || a.r2_url)\n         FROM ticket_attachments a WHERE a.message_id = m.id) as attachment_list\n      FROM support_messages m\n      WHERE m.ticket_id = ?\n      ORDER BY m.created_at ASC\n    `).bind(ticket.id).all();\n\n    // Parse attachments\n    const formattedMessages = messages.map(msg => {\n      const attachments = [];\n      if (msg.attachment_list) {\n        msg.attachment_list.split(',').forEach(att => {\n          const [id, filename, url] = att.split('|');\n          if (id && filename) {\n            attachments.push({ id, filename, url });\n          }\n        });\n      }\n      delete msg.attachment_list;\n      return { ...msg, attachments };\n    });\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { messages: formattedMessages }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST - Add message/reply to ticket\n */\nexport async function onRequestPost(context) {\n  const { request, env, params } = context;\n  const ticketId = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.content) {\n      return new Response(JSON.stringify({ success: false, error: \"Message content is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT * FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(ticketId, ticketId).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const messageId = `msg_${crypto.randomUUID().split('-')[0]}`;\n\n    // Determine author type (admin or customer)\n    const authorType = data.author_type || \n      (data.author_email === ticket.customer_email ? 'customer' : 'admin');\n\n    // Create message\n    const message = {\n      id: messageId,\n      ticket_id: ticket.id,\n      author_type: authorType,\n      author_id: data.author_id || null,\n      author_name: data.author_name || data.author || 'Support Team',\n      author_email: data.author_email || null,\n      content: data.content,\n      is_internal: data.is_internal ? 1 : 0,\n      created_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO support_messages (\n        id, ticket_id, author_type, author_id, author_name, author_email,\n        content, is_internal, created_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      message.id, message.ticket_id, message.author_type, message.author_id,\n      message.author_name, message.author_email, message.content,\n      message.is_internal, message.created_at\n    ).run();\n\n    // Update ticket\n    const updates = ['message_count = message_count + 1', 'updated_at = ?'];\n    const values = [now];\n\n    // Track first response time for admin replies\n    if (authorType === 'admin' && !ticket.first_response_at) {\n      updates.push('first_response_at = ?');\n      values.push(now);\n    }\n\n    // Update status based on reply\n    if (data.update_status) {\n      updates.push('status = ?');\n      values.push(data.update_status);\n\n      if (data.update_status === 'resolved') {\n        updates.push('resolved_at = ?');\n        values.push(now);\n      }\n      if (data.update_status === 'closed') {\n        updates.push('closed_at = ?');\n        values.push(now);\n      }\n    } else if (authorType === 'admin' && ticket.status === 'open') {\n      // Auto-update to in-progress on first admin reply\n      updates.push('status = ?');\n      values.push('in-progress');\n    }\n\n    values.push(ticket.id);\n\n    await env.DB.prepare(`\n      UPDATE support_tickets SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Invalidate KV cache\n    if (env.KV) {\n      try {\n        await env.KV.delete(`ticket_${ticket.ticket_number}`);\n      } catch (e) {}\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { message }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * AI Assistants API\n * GET /api/automation/assistants - List all assistants\n * POST /api/automation/assistants - Create/register a new assistant\n */\n\n/**\n * GET /api/automation/assistants - List all assistants\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const activeOnly = url.searchParams.get('active_only') !== 'false';\n  const type = url.searchParams.get('type');\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM ai_assistants\";\n    const conditions = [];\n    const params = [];\n\n    if (activeOnly) {\n      conditions.push(\"is_active = 1\");\n    }\n    if (type) {\n      conditions.push(\"type = ?\");\n      params.push(type);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n    query += \" ORDER BY is_default DESC, name ASC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    // Convert integer booleans to actual booleans\n    const assistants = results.map(a => ({\n      ...a,\n      is_active: a.is_active === 1,\n      is_default: a.is_default === 1,\n      code_interpreter: a.code_interpreter === 1,\n      retrieval: a.retrieval === 1,\n      function_calling: a.function_calling === 1\n    }));\n\n    return new Response(JSON.stringify(assistants), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/automation/assistants - Create/register a new assistant\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Assistant name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = `asst_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n\n    const assistant = {\n      id,\n      openai_assistant_id: data.openai_assistant_id || data.openaiAssistantId || '',\n      name: data.name,\n      description: data.description || '',\n      type: data.type || 'custom',\n      model: data.model || 'gpt-4',\n      instructions: data.instructions || '',\n      temperature: data.temperature ?? 0.7,\n      max_tokens: data.max_tokens || data.maxTokens || 2000,\n      top_p: data.top_p || data.topP || 1.0,\n      code_interpreter: data.code_interpreter ? 1 : 0,\n      retrieval: data.retrieval ? 1 : 0,\n      function_calling: data.function_calling ? 1 : 0,\n      is_active: data.is_active !== false ? 1 : 0,\n      is_default: data.is_default ? 1 : 0,\n      usage_count: 0,\n      last_used: null,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO ai_assistants (\n        id, openai_assistant_id, name, description, type, model, instructions,\n        temperature, max_tokens, top_p, code_interpreter, retrieval, function_calling,\n        is_active, is_default, usage_count, last_used, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      assistant.id, assistant.openai_assistant_id, assistant.name, assistant.description,\n      assistant.type, assistant.model, assistant.instructions, assistant.temperature,\n      assistant.max_tokens, assistant.top_p, assistant.code_interpreter, assistant.retrieval,\n      assistant.function_calling, assistant.is_active, assistant.is_default,\n      assistant.usage_count, assistant.last_used, assistant.created_at, assistant.updated_at\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      assistant: {\n        ...assistant,\n        is_active: assistant.is_active === 1,\n        is_default: assistant.is_default === 1\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * AI Configuration API\n * GET /api/automation/config - Get AI configuration\n * PUT /api/automation/config - Update AI configuration\n * \n * Uses KV for fast access with D1 backup\n */\n\nconst KV_CONFIG_KEY = 'ai_config';\nconst KV_CACHE_TTL = 3600;\n\n/**\n * GET /api/automation/config\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const key = url.searchParams.get('key');\n\n  // Try KV first\n  if (env.KV) {\n    try {\n      const cached = await env.KV.get(KV_CONFIG_KEY, 'json');\n      if (cached) {\n        if (key) {\n          const setting = cached.find(c => c.key === key);\n          return new Response(JSON.stringify(setting || null), {\n            headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"HIT\" }\n          });\n        }\n        return new Response(JSON.stringify(cached), {\n          headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"HIT\" }\n        });\n      }\n    } catch (e) {\n      console.error('KV read error:', e);\n    }\n  }\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM ai_config\";\n    if (key) {\n      query += \" WHERE key = ?\";\n    }\n    query += \" ORDER BY key ASC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = key ? await stmt.bind(key).all() : await stmt.all();\n\n    // Parse values\n    const config = results.map(c => ({\n      ...c,\n      value: parseConfigValue(c.value, c.type),\n      is_secret: c.is_secret === 1\n    }));\n\n    // Cache in KV\n    if (env.KV && !key) {\n      try {\n        await env.KV.put(KV_CONFIG_KEY, JSON.stringify(config), {\n          expirationTtl: KV_CACHE_TTL\n        });\n      } catch (e) {\n        console.error('KV write error:', e);\n      }\n    }\n\n    if (key) {\n      return new Response(JSON.stringify(config[0] || null), {\n        headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"MISS\" }\n      });\n    }\n\n    return new Response(JSON.stringify(config), {\n      headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"MISS\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/automation/config - Update configuration\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n    const updates = [];\n\n    // Handle single key update\n    if (data.key && data.value !== undefined) {\n      updates.push({ key: data.key, value: data.value, type: data.type, is_secret: data.is_secret });\n    }\n    // Handle bulk update\n    else if (data.config && Array.isArray(data.config)) {\n      updates.push(...data.config);\n    } else {\n      return new Response(JSON.stringify({ error: \"Invalid request format\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    for (const setting of updates) {\n      if (!setting.key) continue;\n\n      let type = setting.type;\n      if (!type) {\n        if (typeof setting.value === 'boolean') type = 'boolean';\n        else if (typeof setting.value === 'number') type = 'number';\n        else if (typeof setting.value === 'object') type = 'json';\n        else type = 'string';\n      }\n\n      const valueStr = type === 'json' \n        ? JSON.stringify(setting.value)\n        : String(setting.value);\n\n      await env.DB.prepare(`\n        INSERT INTO ai_config (key, value, type, is_secret, updated_at)\n        VALUES (?, ?, ?, ?, ?)\n        ON CONFLICT(key) DO UPDATE SET\n          value = excluded.value,\n          type = excluded.type,\n          is_secret = excluded.is_secret,\n          updated_at = excluded.updated_at\n      `).bind(\n        setting.key, \n        valueStr, \n        type, \n        setting.is_secret ? 1 : 0,\n        now\n      ).run();\n    }\n\n    // Clear KV cache\n    if (env.KV) {\n      try {\n        await env.KV.delete(KV_CONFIG_KEY);\n      } catch (e) {\n        console.error('KV delete error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestPost(context) {\n  return onRequestPut(context);\n}\n\nfunction parseConfigValue(value, type) {\n  switch (type) {\n    case 'boolean':\n      return value === 'true' || value === '1' || value === true;\n    case 'number':\n      return Number(value);\n    case 'json':\n      try {\n        return JSON.parse(value);\n      } catch {\n        return value;\n      }\n    default:\n      return value;\n  }\n}\n", "/**\n * AI Generation Logs API\n * GET /api/automation/logs - List generation logs with filtering\n * POST /api/automation/logs - Create a new log entry\n */\n\n/**\n * GET /api/automation/logs - List generation logs\n * Query params: path_id, status, limit, offset, from_date, to_date\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const pathId = url.searchParams.get('path_id');\n  const status = url.searchParams.get('status');\n  const fromDate = url.searchParams.get('from_date');\n  const toDate = url.searchParams.get('to_date');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM ai_generation_logs\";\n    let countQuery = \"SELECT COUNT(*) as total FROM ai_generation_logs\";\n    const conditions = [];\n    const params = [];\n\n    if (pathId) {\n      conditions.push(\"automation_path_id = ?\");\n      params.push(pathId);\n    }\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n    if (fromDate) {\n      conditions.push(\"created_at >= ?\");\n      params.push(new Date(fromDate).getTime());\n    }\n    if (toDate) {\n      conditions.push(\"created_at <= ?\");\n      params.push(new Date(toDate).getTime());\n    }\n\n    if (conditions.length > 0) {\n      const whereClause = \" WHERE \" + conditions.join(\" AND \");\n      query += whereClause;\n      countQuery += whereClause;\n    }\n\n    query += \" ORDER BY created_at DESC\";\n    query += ` LIMIT ${limit} OFFSET ${offset}`;\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = params.length > 0\n      ? await countStmt.bind(...params).first()\n      : await countStmt.first();\n\n    return new Response(JSON.stringify({\n      logs: results,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/automation/logs - Create a new log entry\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const id = crypto.randomUUID();\n    const now = Date.now();\n\n    const log = {\n      id,\n      automation_path_id: data.automation_path_id || data.pathId,\n      path_name: data.path_name || data.pathName,\n      status: data.status || 'pending',\n      prompt_used: data.prompt_used || data.prompt,\n      model_used: data.model_used || data.model || 'gpt-4',\n      assistant_id: data.assistant_id || data.assistantId,\n      content_type: data.content_type || data.contentType,\n      category: data.category,\n      topic: data.topic,\n      language: data.language || 'en',\n      generated_title: data.generated_title || data.title,\n      generated_content: data.generated_content || data.content,\n      generated_excerpt: data.generated_excerpt || data.excerpt,\n      tokens_used: data.tokens_used || data.tokensUsed || 0,\n      generation_time_ms: data.generation_time_ms || data.generationTime,\n      published_post_id: data.published_post_id || data.postId,\n      published_at: data.published_at,\n      error_message: data.error_message || data.error,\n      error_code: data.error_code,\n      retry_count: data.retry_count || 0,\n      started_at: data.started_at || now,\n      completed_at: data.completed_at,\n      created_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO ai_generation_logs (\n        id, automation_path_id, path_name, status, prompt_used, model_used,\n        assistant_id, content_type, category, topic, language,\n        generated_title, generated_content, generated_excerpt,\n        tokens_used, generation_time_ms, published_post_id, published_at,\n        error_message, error_code, retry_count, started_at, completed_at, created_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      log.id, log.automation_path_id, log.path_name, log.status, log.prompt_used, log.model_used,\n      log.assistant_id, log.content_type, log.category, log.topic, log.language,\n      log.generated_title, log.generated_content, log.generated_excerpt,\n      log.tokens_used, log.generation_time_ms, log.published_post_id, log.published_at,\n      log.error_message, log.error_code, log.retry_count, log.started_at, log.completed_at, log.created_at\n    ).run();\n\n    // Update daily API usage\n    const today = new Date().toISOString().split('T')[0];\n    await env.DB.prepare(`\n      INSERT INTO ai_api_usage (id, date, prompt_tokens, completion_tokens, total_tokens, requests_count, successful_requests, failed_requests, updated_at)\n      VALUES (?, ?, 0, 0, ?, 1, ?, ?, ?)\n      ON CONFLICT(date) DO UPDATE SET\n        total_tokens = total_tokens + excluded.total_tokens,\n        requests_count = requests_count + 1,\n        successful_requests = successful_requests + excluded.successful_requests,\n        failed_requests = failed_requests + excluded.failed_requests,\n        updated_at = excluded.updated_at\n    `).bind(\n      crypto.randomUUID(),\n      today,\n      log.tokens_used,\n      log.status === 'completed' ? 1 : 0,\n      log.status === 'failed' ? 1 : 0,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({ success: true, log }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * GET /api/automation/paths - List all automation paths with filtering\n * POST /api/automation/paths - Create a new automation path\n * \n * Query Parameters for GET:\n * - status: Filter by status (active, inactive, paused)\n * - category: Filter by category\n * - content_type: Filter by content type\n * - include_stats: Include generation statistics (true/false)\n */\n\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status');\n  const category = url.searchParams.get('category');\n  const contentType = url.searchParams.get('content_type');\n  const includeStats = url.searchParams.get('include_stats') === 'true';\n  \n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM automation_paths\";\n    const conditions = [];\n    const params = [];\n\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n    if (category) {\n      conditions.push(\"category = ?\");\n      params.push(category);\n    }\n    if (contentType) {\n      conditions.push(\"content_type = ?\");\n      params.push(contentType);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n    query += \" ORDER BY created_at DESC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    // Parse JSON fields\n    let paths = results.map(path => ({\n      ...path,\n      topics: path.topics ? JSON.parse(path.topics) : [],\n      languages: path.languages ? JSON.parse(path.languages) : [],\n      include_images: !!path.include_images\n    }));\n\n    // Include generation stats if requested\n    if (includeStats && paths.length > 0) {\n      const pathIds = paths.map(p => p.id);\n      \n      // Get stats for each path\n      for (const path of paths) {\n        const statsResult = await env.DB.prepare(`\n          SELECT \n            COUNT(*) as total_generations,\n            SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as successful,\n            SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed,\n            SUM(tokens_used) as total_tokens\n          FROM ai_generation_logs\n          WHERE automation_path_id = ?\n        `).bind(path.id).first();\n\n        path.stats = {\n          total_generations: statsResult?.total_generations || 0,\n          successful: statsResult?.successful || 0,\n          failed: statsResult?.failed || 0,\n          total_tokens: statsResult?.total_tokens || 0,\n          success_rate: statsResult?.total_generations > 0 \n            ? ((statsResult.successful / statsResult.total_generations) * 100).toFixed(1)\n            : 0\n        };\n      }\n    }\n\n    return new Response(JSON.stringify(paths), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    \n    // Validation (basic)\n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = crypto.randomUUID();\n    const now = Date.now();\n    \n    const path = {\n      id,\n      name: data.name,\n      content_type: data.contentType || data.content_type || 'General Blog Post',\n      assistant_id: data.assistantId || data.assistant_id,\n      category: data.category,\n      subcategory: data.subcategory,\n      topics: JSON.stringify(data.topics || []),\n      mode: data.mode || 'schedule',\n      schedule_type: data.scheduleType || data.schedule_type,\n      schedule_time: data.scheduleTime || data.schedule_time,\n      prompt_template: data.promptTemplate || data.prompt_template,\n      include_images: data.includeImages ? 1 : 0,\n      media_folder: data.mediaFolder || data.media_folder,\n      languages: JSON.stringify(data.languages || ['en']),\n      created_at: now,\n      last_run: null,\n      status: 'active'\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO automation_paths (\n        id, name, content_type, assistant_id, category, subcategory,\n        topics, mode, schedule_type, schedule_time, prompt_template,\n        include_images, media_folder, languages, created_at, last_run, status\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      path.id, path.name, path.content_type, path.assistant_id, path.category, path.subcategory,\n      path.topics, path.mode, path.schedule_type, path.schedule_time, path.prompt_template,\n      path.include_images, path.media_folder, path.languages, path.created_at, path.last_run, path.status\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      path: { ...path, include_images: !!path.include_images, topics: JSON.parse(path.topics), languages: JSON.parse(path.languages) } \n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Prompts Library API\n * GET /api/automation/prompts - List all prompt templates\n * POST /api/automation/prompts - Create a new prompt template\n */\n\n/**\n * GET /api/automation/prompts - List prompt templates\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const category = url.searchParams.get('category');\n  const defaultsOnly = url.searchParams.get('defaults_only') === 'true';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM prompts_library\";\n    const conditions = [];\n    const params = [];\n\n    if (category) {\n      conditions.push(\"category = ?\");\n      params.push(category);\n    }\n    if (defaultsOnly) {\n      conditions.push(\"is_default = 1\");\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n    query += \" ORDER BY is_default DESC, usage_count DESC, name ASC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    // Parse JSON fields\n    const prompts = results.map(p => ({\n      ...p,\n      variables: p.variables ? JSON.parse(p.variables) : [],\n      is_default: p.is_default === 1,\n      is_public: p.is_public === 1\n    }));\n\n    return new Response(JSON.stringify(prompts), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/automation/prompts - Create a new prompt template\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name || !data.prompt_template) {\n      return new Response(JSON.stringify({ error: \"Name and prompt_template are required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = `prompt_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n\n    const prompt = {\n      id,\n      name: data.name,\n      description: data.description || '',\n      category: data.category || 'general',\n      prompt_template: data.prompt_template,\n      system_message: data.system_message || '',\n      variables: JSON.stringify(data.variables || []),\n      example_output: data.example_output || '',\n      is_default: data.is_default ? 1 : 0,\n      is_public: data.is_public !== false ? 1 : 0,\n      usage_count: 0,\n      rating: 0,\n      created_by: data.created_by || 'Admin',\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO prompts_library (\n        id, name, description, category, prompt_template, system_message,\n        variables, example_output, is_default, is_public, usage_count,\n        rating, created_by, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      prompt.id, prompt.name, prompt.description, prompt.category,\n      prompt.prompt_template, prompt.system_message, prompt.variables,\n      prompt.example_output, prompt.is_default, prompt.is_public,\n      prompt.usage_count, prompt.rating, prompt.created_by,\n      prompt.created_at, prompt.updated_at\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      prompt: {\n        ...prompt,\n        variables: JSON.parse(prompt.variables),\n        is_default: prompt.is_default === 1,\n        is_public: prompt.is_public === 1\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * AI Automation Stats API\n * GET /api/automation/stats - Get automation statistics and API usage\n */\n\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const period = url.searchParams.get('period') || '30'; // days\n  const pathId = url.searchParams.get('path_id');\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n    const periodMs = parseInt(period) * 24 * 60 * 60 * 1000;\n    const fromDate = now - periodMs;\n\n    // Get overall stats\n    let logsQuery = `\n      SELECT \n        COUNT(*) as total_generations,\n        SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as successful,\n        SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed,\n        SUM(tokens_used) as total_tokens,\n        AVG(generation_time_ms) as avg_generation_time\n      FROM ai_generation_logs\n      WHERE created_at >= ?\n    `;\n    const logsParams = [fromDate];\n\n    if (pathId) {\n      logsQuery += \" AND automation_path_id = ?\";\n      logsParams.push(pathId);\n    }\n\n    const logsStmt = env.DB.prepare(logsQuery);\n    const logsStats = await logsStmt.bind(...logsParams).first();\n\n    // Get daily breakdown\n    const dailyQuery = `\n      SELECT \n        date,\n        requests_count,\n        successful_requests,\n        failed_requests,\n        total_tokens,\n        estimated_cost_cents\n      FROM ai_api_usage\n      WHERE date >= date(?, 'unixepoch', 'localtime')\n      ORDER BY date DESC\n      LIMIT ?\n    `;\n    const { results: dailyStats } = await env.DB.prepare(dailyQuery)\n      .bind(Math.floor(fromDate / 1000), parseInt(period))\n      .all();\n\n    // Get top performing paths\n    const pathsQuery = `\n      SELECT \n        automation_path_id,\n        path_name,\n        COUNT(*) as generation_count,\n        SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as success_count,\n        SUM(tokens_used) as tokens_used\n      FROM ai_generation_logs\n      WHERE created_at >= ?\n      GROUP BY automation_path_id\n      ORDER BY generation_count DESC\n      LIMIT 10\n    `;\n    const { results: topPaths } = await env.DB.prepare(pathsQuery)\n      .bind(fromDate)\n      .all();\n\n    // Get recent activity\n    const recentQuery = `\n      SELECT id, path_name, status, generated_title, created_at, generation_time_ms\n      FROM ai_generation_logs\n      ORDER BY created_at DESC\n      LIMIT 10\n    `;\n    const { results: recentActivity } = await env.DB.prepare(recentQuery).all();\n\n    // Get active automation paths count\n    const activePathsResult = await env.DB.prepare(\n      \"SELECT COUNT(*) as count FROM automation_paths WHERE status = 'active'\"\n    ).first();\n\n    // Calculate success rate\n    const successRate = logsStats?.total_generations > 0\n      ? ((logsStats.successful / logsStats.total_generations) * 100).toFixed(1)\n      : 0;\n\n    return new Response(JSON.stringify({\n      summary: {\n        total_generations: logsStats?.total_generations || 0,\n        successful: logsStats?.successful || 0,\n        failed: logsStats?.failed || 0,\n        success_rate: parseFloat(successRate),\n        total_tokens: logsStats?.total_tokens || 0,\n        avg_generation_time_ms: Math.round(logsStats?.avg_generation_time || 0),\n        active_paths: activePathsResult?.count || 0,\n        period_days: parseInt(period)\n      },\n      daily: dailyStats,\n      top_paths: topPaths,\n      recent_activity: recentActivity\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * GET /api/blog/posts - List all blog posts with filtering, search, pagination\n * POST /api/blog/posts - Create a new blog post\n * DELETE /api/blog/posts - Bulk delete posts (with ?ids=id1,id2,id3)\n * \n * Query Parameters for GET:\n * - search: Search in title and content\n * - category: Filter by category name\n * - status: Filter by status (published, draft, scheduled, archived)\n * - featured: Filter by featured (true/false)\n * - sort: Sort field (created_at, updated_at, title, published_date)\n * - order: Sort order (asc, desc)\n * - limit: Number of results (default 50)\n * - offset: Pagination offset (default 0)\n */\n\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  // Query parameters\n  const search = url.searchParams.get('search');\n  const category = url.searchParams.get('category');\n  const status = url.searchParams.get('status');\n  const featured = url.searchParams.get('featured');\n  const sortField = url.searchParams.get('sort') || 'created_at';\n  const sortOrder = url.searchParams.get('order') || 'desc';\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n  \n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Build query dynamically\n    let query = \"SELECT * FROM blog_posts\";\n    let countQuery = \"SELECT COUNT(*) as total FROM blog_posts\";\n    const conditions = [];\n    const params = [];\n\n    // Search filter\n    if (search) {\n      conditions.push(\"(title LIKE ? OR content LIKE ? OR excerpt LIKE ?)\");\n      const searchTerm = `%${search}%`;\n      params.push(searchTerm, searchTerm, searchTerm);\n    }\n\n    // Category filter\n    if (category) {\n      conditions.push(\"category = ?\");\n      params.push(category);\n    }\n\n    // Status filter\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n\n    // Featured filter\n    if (featured !== null && featured !== undefined) {\n      const featuredValue = featured === 'true' || featured === '1' ? 1 : 0;\n      conditions.push(\"featured = ?\");\n      params.push(featuredValue);\n    }\n\n    // Add WHERE clause if conditions exist\n    if (conditions.length > 0) {\n      const whereClause = \" WHERE \" + conditions.join(\" AND \");\n      query += whereClause;\n      countQuery += whereClause;\n    }\n\n    // Validate sort field to prevent SQL injection\n    const allowedSortFields = ['created_at', 'updated_at', 'title', 'published_date', 'category', 'status'];\n    const safeSortField = allowedSortFields.includes(sortField) ? sortField : 'created_at';\n    const safeSortOrder = sortOrder.toLowerCase() === 'asc' ? 'ASC' : 'DESC';\n\n    query += ` ORDER BY ${safeSortField} ${safeSortOrder}`;\n    query += ` LIMIT ${limit} OFFSET ${offset}`;\n\n    // Execute queries\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    // Get total count for pagination\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = params.length > 0\n      ? await countStmt.bind(...params).first()\n      : await countStmt.first();\n\n    // Parse JSON fields\n    const posts = results.map(post => ({\n      ...post,\n      tags: post.tags ? JSON.parse(post.tags) : [],\n      featured: post.featured === 1 || post.featured === true\n    }));\n\n    return new Response(JSON.stringify({\n      posts,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset,\n        hasMore: (offset + posts.length) < (countResult?.total || 0)\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    \n    if (!data.title) {\n      return new Response(JSON.stringify({ error: \"Title is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = crypto.randomUUID();\n    const now = Date.now();\n    \n    const post = {\n      id,\n      title: data.title,\n      content: data.content || '',\n      excerpt: data.excerpt || '',\n      image_url: data.image_url || data.imageUrl || '',\n      author: data.author || 'Admin',\n      category: data.category || 'Uncategorized',\n      subcategory: data.subcategory || null,\n      tags: JSON.stringify(data.tags || []),\n      published_date: data.published_date || data.publishedDate || new Date().toISOString(),\n      scheduled_date: data.scheduled_date || data.scheduledDate || null,\n      status: data.status || 'draft',\n      featured: data.featured ? 1 : 0,\n      views: 0,\n      likes: data.likes || 0,\n      comments_count: data.comments_count || data.commentsCount || 0,\n      created_at: now,\n      updated_at: now,\n      slug: data.slug || data.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '')\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO blog_posts (\n        id, title, content, excerpt, image_url, author, category, subcategory, tags,\n        published_date, scheduled_date, status, featured, views, likes, comments_count, \n        created_at, updated_at, slug\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      post.id, post.title, post.content, post.excerpt, post.image_url, post.author, \n      post.category, post.subcategory, post.tags, post.published_date, post.scheduled_date,\n      post.status, post.featured, post.views, post.likes, post.comments_count, \n      post.created_at, post.updated_at, post.slug\n    ).run();\n\n    // Update category post count\n    if (post.category && post.category !== 'Uncategorized') {\n      await env.DB.prepare(\n        \"UPDATE categories SET post_count = post_count + 1 WHERE name = ?\"\n      ).bind(post.category).run();\n    }\n\n    return new Response(JSON.stringify({ \n      success: true, \n      post: { ...post, tags: JSON.parse(post.tags), featured: post.featured === 1 } \n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/blog/posts - Bulk delete posts\n * Query: ?ids=id1,id2,id3\n */\nexport async function onRequestDelete(context) {\n  const { request, env } = context;\n  const url = new URL(request.url);\n  const idsParam = url.searchParams.get('ids');\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  if (!idsParam) {\n    return new Response(JSON.stringify({ error: \"No post IDs provided. Use ?ids=id1,id2,id3\" }), {\n      status: 400,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const ids = idsParam.split(',').map(id => id.trim()).filter(Boolean);\n    \n    if (ids.length === 0) {\n      return new Response(JSON.stringify({ error: \"No valid post IDs provided\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Delete posts one by one (D1 doesn't support IN with bindings well)\n    let deletedCount = 0;\n    const errors = [];\n\n    for (const id of ids) {\n      try {\n        const result = await env.DB.prepare(\n          \"DELETE FROM blog_posts WHERE id = ?\"\n        ).bind(id).run();\n        \n        if (result.meta.changes > 0) {\n          deletedCount++;\n        }\n      } catch (e) {\n        errors.push({ id, error: e.message });\n      }\n    }\n\n    return new Response(JSON.stringify({ \n      success: true, \n      deleted: deletedCount,\n      requested: ids.length,\n      errors: errors.length > 0 ? errors : undefined\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Analytics API\n * GET /api/chatbot/analytics - Get analytics data\n */\n\n/**\n * GET /api/chatbot/analytics - Get analytics\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const period = url.searchParams.get('period') || '30d';\n  const startDate = url.searchParams.get('start');\n  const endDate = url.searchParams.get('end');\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Calculate date range\n    let fromDate;\n    const toDate = new Date();\n\n    if (startDate && endDate) {\n      fromDate = new Date(startDate);\n    } else {\n      const days = parseInt(period) || 30;\n      fromDate = new Date();\n      fromDate.setDate(fromDate.getDate() - days);\n    }\n\n    const fromTimestamp = fromDate.getTime();\n    const toTimestamp = toDate.getTime();\n\n    // Get daily analytics from analytics table\n    const { results: dailyStats } = await env.DB.prepare(`\n      SELECT * FROM chatbot_analytics\n      WHERE date >= ? AND date <= ?\n      ORDER BY date ASC\n    `).bind(\n      fromDate.toISOString().split('T')[0],\n      toDate.toISOString().split('T')[0]\n    ).all();\n\n    // Get conversation stats\n    const convStats = await env.DB.prepare(`\n      SELECT \n        COUNT(*) as total_conversations,\n        SUM(CASE WHEN created_at >= ? THEN 1 ELSE 0 END) as new_conversations,\n        SUM(message_count) as total_messages,\n        AVG(message_count) as avg_messages_per_conversation,\n        SUM(CASE WHEN rating IS NOT NULL THEN 1 ELSE 0 END) as rated_conversations,\n        SUM(CASE WHEN rating IS NOT NULL THEN rating ELSE 0 END) as rating_sum,\n        AVG(rating) as avg_rating\n      FROM chatbot_conversations\n      WHERE created_at >= ?\n    `).bind(fromTimestamp, fromTimestamp).first();\n\n    // Get user/lead stats\n    const userStats = await env.DB.prepare(`\n      SELECT \n        COUNT(*) as total_users,\n        SUM(CASE WHEN created_at >= ? THEN 1 ELSE 0 END) as new_users,\n        SUM(CASE WHEN status = 'lead' THEN 1 ELSE 0 END) as leads,\n        SUM(CASE WHEN status = 'customer' THEN 1 ELSE 0 END) as customers\n      FROM chatbot_users\n    `).bind(fromTimestamp).first();\n\n    // Get language distribution\n    const { results: languages } = await env.DB.prepare(`\n      SELECT language, COUNT(*) as count\n      FROM chatbot_conversations\n      WHERE created_at >= ?\n      GROUP BY language\n      ORDER BY count DESC\n    `).bind(fromTimestamp).all();\n\n    // Get top assistants used\n    const { results: assistantUsage } = await env.DB.prepare(`\n      SELECT \n        assistant_id,\n        (SELECT name FROM ai_assistants WHERE id = assistant_id OR openai_assistant_id = assistant_id LIMIT 1) as assistant_name,\n        COUNT(*) as usage_count\n      FROM chatbot_conversations\n      WHERE assistant_id IS NOT NULL AND created_at >= ?\n      GROUP BY assistant_id\n      ORDER BY usage_count DESC\n      LIMIT 5\n    `).bind(fromTimestamp).all();\n\n    // Calculate summary metrics\n    const totalConversations = convStats?.total_conversations || 0;\n    const totalMessages = convStats?.total_messages || 0;\n    const avgMessagesPerConversation = convStats?.avg_messages_per_conversation || 0;\n    const avgRating = convStats?.avg_rating || 0;\n    const ratedConversations = convStats?.rated_conversations || 0;\n    const satisfactionRate = ratedConversations > 0 \n      ? ((convStats?.rating_sum / ratedConversations) / 5 * 100).toFixed(1) \n      : 0;\n\n    // Aggregate daily totals\n    const aggregatedDailyStats = dailyStats.map(day => ({\n      date: day.date,\n      conversations: day.total_conversations || 0,\n      messages: day.total_messages || 0,\n      tokens: day.total_tokens_used || 0,\n      leads: day.leads_captured || 0,\n      avgResponseTime: day.avg_response_time_ms || 0,\n      avgRating: day.avg_rating || 0\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      period,\n      dateRange: {\n        from: fromDate.toISOString().split('T')[0],\n        to: toDate.toISOString().split('T')[0]\n      },\n      summary: {\n        totalConversations,\n        newConversations: convStats?.new_conversations || 0,\n        totalMessages,\n        avgMessagesPerConversation: parseFloat(avgMessagesPerConversation.toFixed(2)),\n        avgRating: parseFloat(avgRating.toFixed(2)),\n        satisfactionRate: parseFloat(satisfactionRate),\n        totalUsers: userStats?.total_users || 0,\n        newUsers: userStats?.new_users || 0,\n        totalLeads: userStats?.leads || 0,\n        totalCustomers: userStats?.customers || 0\n      },\n      dailyStats: aggregatedDailyStats,\n      languages: languages.map(l => ({\n        language: l.language,\n        count: l.count,\n        percentage: totalConversations > 0 ? ((l.count / totalConversations) * 100).toFixed(1) : 0\n      })),\n      topAssistants: assistantUsage.map(a => ({\n        id: a.assistant_id,\n        name: a.assistant_name || 'Unknown',\n        usageCount: a.usage_count\n      }))\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/analytics - Record analytics event\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const today = new Date().toISOString().split('T')[0];\n    const now = Date.now();\n\n    // Build update based on event type\n    const updates = [];\n    const values = [];\n\n    if (data.type === 'conversation') {\n      updates.push('total_conversations = total_conversations + 1');\n      if (data.isNew) updates.push('new_conversations = new_conversations + 1');\n      if (data.isReturning) updates.push('returning_users = returning_users + 1');\n    }\n\n    if (data.type === 'message') {\n      updates.push('total_messages = total_messages + 1');\n      if (data.tokens) {\n        updates.push('total_tokens_used = total_tokens_used + ?');\n        values.push(data.tokens);\n      }\n      if (data.responseTime) {\n        // Calculate running average\n        updates.push('avg_response_time_ms = (avg_response_time_ms * total_messages + ?) / (total_messages + 1)');\n        values.push(data.responseTime);\n      }\n    }\n\n    if (data.type === 'lead') {\n      updates.push('leads_captured = leads_captured + 1');\n    }\n\n    if (data.type === 'rating' && data.rating) {\n      updates.push('ratings_count = ratings_count + 1');\n      updates.push('ratings_sum = ratings_sum + ?');\n      updates.push('avg_rating = CAST(ratings_sum + ? AS REAL) / (ratings_count + 1)');\n      values.push(data.rating, data.rating);\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ success: true, message: \"No updates needed\" }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Add date and timestamps\n    values.push(today, now, now);\n    updates.push('updated_at = ?');\n\n    const query = `\n      INSERT INTO chatbot_analytics (id, date, ${updates.map(() => '').join('')} created_at, updated_at)\n      VALUES (?, ?, ${values.slice(0, -2).map(() => '0').join(', ')}, ?, ?)\n      ON CONFLICT(date) DO UPDATE SET ${updates.join(', ')}\n    `;\n\n    // This is complex - let's simplify\n    await env.DB.prepare(`\n      INSERT INTO chatbot_analytics (id, date, created_at, updated_at)\n      VALUES (?, ?, ?, ?)\n      ON CONFLICT(date) DO UPDATE SET updated_at = ?\n    `).bind(`analytics_${today}`, today, now, now, now).run();\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Conversations API\n * GET /api/chatbot/conversations - List conversations (admin)\n * POST /api/chatbot/conversations - Create/update conversation\n * DELETE /api/chatbot/conversations - Delete conversation\n */\n\n/**\n * GET /api/chatbot/conversations - List all conversations\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status');\n  const userId = url.searchParams.get('user_id');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = `\n      SELECT c.*, \n        (SELECT COUNT(*) FROM chatbot_messages WHERE conversation_id = c.id) as actual_message_count,\n        (SELECT content FROM chatbot_messages WHERE conversation_id = c.id ORDER BY created_at DESC LIMIT 1) as last_message\n      FROM chatbot_conversations c\n    `;\n    const conditions = [];\n    const params = [];\n\n    if (status) {\n      conditions.push(\"c.status = ?\");\n      params.push(status);\n    }\n\n    if (userId) {\n      conditions.push(\"c.user_id = ?\");\n      params.push(userId);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n\n    query += \" ORDER BY c.last_message_at DESC, c.created_at DESC LIMIT ? OFFSET ?\";\n    params.push(limit, offset);\n\n    const { results: conversations } = await env.DB.prepare(query).bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM chatbot_conversations c\";\n    if (conditions.length > 0) {\n      countQuery += \" WHERE \" + conditions.join(\" AND \");\n    }\n    const countParams = params.slice(0, -2);\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = countParams.length > 0 \n      ? await countStmt.bind(...countParams).first()\n      : await countStmt.first();\n\n    // Format conversations\n    const formattedConversations = conversations.map(conv => ({\n      id: conv.id,\n      conversationId: conv.id,\n      visitorId: conv.visitor_id,\n      userId: conv.user_id,\n      threadId: conv.thread_id,\n      userName: conv.user_name || 'Anonymous User',\n      userEmail: conv.user_email,\n      userPhone: conv.user_phone,\n      restaurantName: conv.restaurant_name,\n      userType: conv.user_type,\n      language: conv.language,\n      languageFlag: conv.language_flag || (conv.language === 'sv' ? '\uD83C\uDDF8\uD83C\uDDEA' : '\uD83C\uDDFA\uD83C\uDDF8'),\n      displayFlag: conv.language_flag || (conv.language === 'sv' ? '\uD83C\uDDF8\uD83C\uDDEA' : '\uD83C\uDDFA\uD83C\uDDF8'),\n      status: conv.status,\n      userRegistered: conv.is_registered === 1,\n      rating: conv.rating,\n      ratingFeedback: conv.rating_feedback,\n      messageCount: conv.actual_message_count || conv.message_count || 0,\n      lastMessage: conv.last_message,\n      firstMessageAt: conv.first_message_at,\n      lastMessageAt: conv.last_message_at,\n      createdAt: conv.created_at,\n      updatedAt: conv.updated_at\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      conversations: formattedConversations,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/conversations - Create or update conversation\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Check if updating existing conversation\n    if (data.conversationId || data.id) {\n      const convId = data.conversationId || data.id;\n      \n      const updates = [];\n      const values = [];\n\n      if (data.userName !== undefined) {\n        updates.push('user_name = ?');\n        values.push(data.userName);\n      }\n      if (data.userEmail !== undefined) {\n        updates.push('user_email = ?');\n        values.push(data.userEmail);\n      }\n      if (data.userPhone !== undefined) {\n        updates.push('user_phone = ?');\n        values.push(data.userPhone);\n      }\n      if (data.restaurantName !== undefined) {\n        updates.push('restaurant_name = ?');\n        values.push(data.restaurantName);\n      }\n      if (data.userType !== undefined) {\n        updates.push('user_type = ?');\n        values.push(data.userType);\n      }\n      if (data.language !== undefined) {\n        updates.push('language = ?');\n        values.push(data.language);\n      }\n      if (data.languageFlag !== undefined) {\n        updates.push('language_flag = ?');\n        values.push(data.languageFlag);\n      }\n      if (data.status !== undefined) {\n        updates.push('status = ?');\n        values.push(data.status);\n      }\n      if (data.rating !== undefined) {\n        updates.push('rating = ?');\n        values.push(data.rating);\n      }\n      if (data.ratingFeedback !== undefined) {\n        updates.push('rating_feedback = ?');\n        values.push(data.ratingFeedback);\n      }\n      if (data.isRegistered !== undefined || data.userRegistered !== undefined) {\n        updates.push('is_registered = ?');\n        values.push((data.isRegistered || data.userRegistered) ? 1 : 0);\n      }\n      if (data.userId !== undefined) {\n        updates.push('user_id = ?');\n        values.push(data.userId);\n      }\n\n      if (updates.length > 0) {\n        updates.push('updated_at = ?');\n        values.push(now);\n        values.push(convId);\n\n        await env.DB.prepare(`\n          UPDATE chatbot_conversations SET ${updates.join(', ')} WHERE id = ?\n        `).bind(...values).run();\n      }\n\n      const updated = await env.DB.prepare(\n        \"SELECT * FROM chatbot_conversations WHERE id = ?\"\n      ).bind(convId).first();\n\n      return new Response(JSON.stringify({\n        success: true,\n        conversation: updated\n      }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Create new conversation\n    const convId = data.id || `conv_${crypto.randomUUID().split('-')[0]}`;\n\n    await env.DB.prepare(`\n      INSERT INTO chatbot_conversations (\n        id, visitor_id, user_id, thread_id, assistant_id, user_name, user_email,\n        user_phone, restaurant_name, user_type, language, language_flag, status,\n        is_registered, first_message_at, last_message_at, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      convId,\n      data.visitorId || null,\n      data.userId || null,\n      data.threadId || null,\n      data.assistantId || null,\n      data.userName || null,\n      data.userEmail || null,\n      data.userPhone || null,\n      data.restaurantName || null,\n      data.userType || null,\n      data.language || 'en',\n      data.languageFlag || '\uD83C\uDDFA\uD83C\uDDF8',\n      data.status || 'active',\n      (data.isRegistered || data.userRegistered) ? 1 : 0,\n      now,\n      now,\n      now,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      conversation: { id: convId }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/chatbot/conversations - Delete conversation\n */\nexport async function onRequestDelete(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const url = new URL(request.url);\n    const id = url.searchParams.get('id');\n\n    if (!id) {\n      return new Response(JSON.stringify({ success: false, error: \"Conversation ID required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    await env.DB.prepare(\n      \"DELETE FROM chatbot_conversations WHERE id = ?\"\n    ).bind(id).run();\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Messages API\n * GET /api/chatbot/messages - Get messages for a conversation\n * POST /api/chatbot/messages - Store a message (used by widget)\n */\n\n/**\n * GET /api/chatbot/messages - Get conversation messages\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const conversationId = url.searchParams.get('conversation_id');\n  const limit = parseInt(url.searchParams.get('limit')) || 100;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  if (!conversationId) {\n    return new Response(JSON.stringify({ success: false, error: \"conversation_id is required\" }), {\n      status: 400,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const { results: messages } = await env.DB.prepare(`\n      SELECT * FROM chatbot_messages \n      WHERE conversation_id = ?\n      ORDER BY created_at ASC\n      LIMIT ? OFFSET ?\n    `).bind(conversationId, limit, offset).all();\n\n    // Get total count\n    const countResult = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM chatbot_messages WHERE conversation_id = ?\"\n    ).bind(conversationId).first();\n\n    // Format messages\n    const formattedMessages = messages.map(m => ({\n      id: m.id,\n      conversationId: m.conversation_id,\n      role: m.role,\n      content: m.content,\n      assistantId: m.assistant_id,\n      assistantName: m.assistant_name,\n      tokensUsed: m.tokens_used,\n      responseTimeMs: m.response_time_ms,\n      metadata: m.metadata ? JSON.parse(m.metadata) : {},\n      createdAt: m.created_at,\n      timestamp: m.created_at\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      messages: formattedMessages,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/messages - Store a message\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.conversation_id && !data.conversationId) {\n      return new Response(JSON.stringify({ success: false, error: \"conversation_id is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (!data.content && !data.message) {\n      return new Response(JSON.stringify({ success: false, error: \"content is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const msgId = `msg_${crypto.randomUUID().split('-')[0]}`;\n    const conversationId = data.conversation_id || data.conversationId;\n\n    await env.DB.prepare(`\n      INSERT INTO chatbot_messages (\n        id, conversation_id, role, content, assistant_id, assistant_name,\n        tokens_used, response_time_ms, metadata, created_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      msgId,\n      conversationId,\n      data.role || 'user',\n      data.content || data.message,\n      data.assistant_id || data.assistantId || null,\n      data.assistant_name || data.assistantName || null,\n      data.tokens_used || data.tokensUsed || 0,\n      data.response_time_ms || data.responseTimeMs || null,\n      data.metadata ? JSON.stringify(data.metadata) : null,\n      now\n    ).run();\n\n    // Update conversation message count and timestamp\n    await env.DB.prepare(`\n      UPDATE chatbot_conversations \n      SET message_count = message_count + 1, last_message_at = ?, updated_at = ?\n      WHERE id = ?\n    `).bind(now, now, conversationId).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: { id: msgId, conversationId }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Rating API\n * POST /api/chatbot/rate - Rate a conversation\n */\n\n/**\n * POST /api/chatbot/rate - Submit conversation rating\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.conversationId && !data.conversation_id) {\n      return new Response(JSON.stringify({ success: false, error: \"conversation_id is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (data.rating === undefined) {\n      return new Response(JSON.stringify({ success: false, error: \"rating is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const conversationId = data.conversationId || data.conversation_id;\n    const rating = parseInt(data.rating);\n\n    // Validate rating (1-5)\n    if (isNaN(rating) || rating < 1 || rating > 5) {\n      return new Response(JSON.stringify({ success: false, error: \"rating must be between 1 and 5\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n\n    // Update conversation with rating\n    await env.DB.prepare(`\n      UPDATE chatbot_conversations \n      SET rating = ?, rating_feedback = ?, updated_at = ?\n      WHERE id = ?\n    `).bind(\n      rating,\n      data.feedback || data.ratingFeedback || null,\n      now,\n      conversationId\n    ).run();\n\n    // Update daily analytics\n    const today = new Date().toISOString().split('T')[0];\n    await env.DB.prepare(`\n      INSERT INTO chatbot_analytics (id, date, ratings_count, ratings_sum, created_at, updated_at)\n      VALUES (?, ?, 1, ?, ?, ?)\n      ON CONFLICT(date) DO UPDATE SET \n        ratings_count = ratings_count + 1,\n        ratings_sum = ratings_sum + ?,\n        avg_rating = CAST(ratings_sum + ? AS REAL) / (ratings_count + 1),\n        updated_at = ?\n    `).bind(\n      `analytics_${today}`, today, rating, now, now,\n      rating, rating, now\n    ).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: \"Thank you for your feedback!\"\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Scenarios API\n * GET /api/chatbot/scenarios - List all scenarios\n * POST /api/chatbot/scenarios - Create new scenario\n * PUT /api/chatbot/scenarios - Update scenario\n * DELETE /api/chatbot/scenarios - Delete scenario\n */\n\n/**\n * GET /api/chatbot/scenarios - List scenarios\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const activeOnly = url.searchParams.get('active_only') !== 'false';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM chatbot_scenarios\";\n    if (activeOnly) {\n      query += \" WHERE is_active = 1\";\n    }\n    query += \" ORDER BY priority DESC, name ASC\";\n\n    const { results: scenarios } = await env.DB.prepare(query).all();\n\n    // Parse flow_data JSON\n    const formattedScenarios = scenarios.map(s => ({\n      id: s.id,\n      name: s.name,\n      description: s.description,\n      triggerType: s.trigger_type,\n      triggerValue: s.trigger_value,\n      language: s.language,\n      flowData: s.flow_data ? JSON.parse(s.flow_data) : {},\n      isActive: s.is_active === 1,\n      active: s.is_active === 1,\n      priority: s.priority,\n      usageCount: s.usage_count,\n      createdAt: s.created_at,\n      updatedAt: s.updated_at\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      scenarios: formattedScenarios\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/scenarios - Create scenario\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ success: false, error: \"Scenario name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = data.id || `scenario_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n\n    // Convert flowData to proper format\n    let flowData = data.flowData || data.flow_data || {};\n    if (data.questions || data.responses) {\n      flowData = {\n        questions: data.questions,\n        responses: data.responses\n      };\n    }\n\n    await env.DB.prepare(`\n      INSERT INTO chatbot_scenarios (\n        id, name, description, trigger_type, trigger_value, language,\n        flow_data, is_active, priority, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      id,\n      data.name,\n      data.description || '',\n      data.triggerType || data.trigger_type || 'keyword',\n      data.triggerValue || data.trigger_value || '',\n      data.language || 'all',\n      JSON.stringify(flowData),\n      (data.isActive !== false && data.active !== false) ? 1 : 0,\n      data.priority || 0,\n      now,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      scenario: { id, name: data.name }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/chatbot/scenarios - Update scenario\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const id = data.id;\n\n    if (!id) {\n      return new Response(JSON.stringify({ success: false, error: \"Scenario ID required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const updates = ['updated_at = ?'];\n    const values = [now];\n\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n    }\n    if (data.description !== undefined) {\n      updates.push('description = ?');\n      values.push(data.description);\n    }\n    if (data.triggerType !== undefined || data.trigger_type !== undefined) {\n      updates.push('trigger_type = ?');\n      values.push(data.triggerType || data.trigger_type);\n    }\n    if (data.triggerValue !== undefined || data.trigger_value !== undefined) {\n      updates.push('trigger_value = ?');\n      values.push(data.triggerValue || data.trigger_value);\n    }\n    if (data.language !== undefined) {\n      updates.push('language = ?');\n      values.push(data.language);\n    }\n    if (data.flowData !== undefined || data.flow_data !== undefined || data.questions !== undefined) {\n      let flowData = data.flowData || data.flow_data || {};\n      if (data.questions || data.responses) {\n        flowData = { questions: data.questions, responses: data.responses };\n      }\n      updates.push('flow_data = ?');\n      values.push(JSON.stringify(flowData));\n    }\n    if (data.isActive !== undefined || data.active !== undefined) {\n      updates.push('is_active = ?');\n      values.push((data.isActive || data.active) ? 1 : 0);\n    }\n    if (data.priority !== undefined) {\n      updates.push('priority = ?');\n      values.push(data.priority);\n    }\n\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE chatbot_scenarios SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/chatbot/scenarios - Delete scenario\n */\nexport async function onRequestDelete(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const url = new URL(request.url);\n    const id = url.searchParams.get('id');\n\n    if (!id) {\n      return new Response(JSON.stringify({ success: false, error: \"Scenario ID required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    await env.DB.prepare(\n      \"DELETE FROM chatbot_scenarios WHERE id = ?\"\n    ).bind(id).run();\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Settings API\n * GET /api/chatbot/settings - Get all settings\n * PUT /api/chatbot/settings - Update settings\n */\n\n/**\n * GET /api/chatbot/settings - Get all settings\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const category = url.searchParams.get('category');\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM chatbot_settings\";\n    const params = [];\n\n    if (category) {\n      query += \" WHERE category = ?\";\n      params.push(category);\n    }\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 ? await stmt.bind(...params).all() : await stmt.all();\n\n    // Convert to settings object\n    const settings = {};\n    results.forEach(row => {\n      let value = row.value;\n      \n      // Parse based on type\n      if (row.type === 'boolean') {\n        value = row.value === 'true' || row.value === '1';\n      } else if (row.type === 'number') {\n        value = parseFloat(row.value);\n      } else if (row.type === 'json') {\n        try {\n          value = JSON.parse(row.value);\n        } catch (e) {\n          // Keep as string if parse fails\n        }\n      }\n      \n      settings[row.key] = value;\n    });\n\n    // Include raw settings for reference\n    const rawSettings = results.map(r => ({\n      key: r.key,\n      value: r.value,\n      type: r.type,\n      category: r.category,\n      description: r.description,\n      updatedAt: r.updated_at\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      settings,\n      rawSettings\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/chatbot/settings - Update settings\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Process each setting\n    for (const [key, rawValue] of Object.entries(data)) {\n      // Determine type and convert value to string\n      let type = 'string';\n      let value = String(rawValue);\n\n      if (typeof rawValue === 'boolean') {\n        type = 'boolean';\n        value = rawValue ? 'true' : 'false';\n      } else if (typeof rawValue === 'number') {\n        type = 'number';\n        value = String(rawValue);\n      } else if (typeof rawValue === 'object') {\n        type = 'json';\n        value = JSON.stringify(rawValue);\n      }\n\n      // Determine category based on key\n      let category = 'general';\n      if (key.startsWith('widget_')) category = 'widget';\n      else if (key.startsWith('enable_') || key.startsWith('allow_')) category = 'features';\n      else if (key.includes('model') || key.includes('openai') || key.includes('api')) category = 'ai';\n      else if (key.includes('delay') || key.includes('timeout')) category = 'behavior';\n\n      // Upsert setting\n      await env.DB.prepare(`\n        INSERT INTO chatbot_settings (key, value, type, category, updated_at)\n        VALUES (?, ?, ?, ?, ?)\n        ON CONFLICT(key) DO UPDATE SET \n          value = excluded.value,\n          type = excluded.type,\n          updated_at = excluded.updated_at\n      `).bind(key, value, type, category, now).run();\n    }\n\n    // Store OpenAI API key in KV for secure access\n    if (data.openai_api_key && env.KV) {\n      await env.KV.put('OPENAI_API_KEY', data.openai_api_key);\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: \"Settings updated successfully\"\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/settings - Batch update settings\n */\nexport async function onRequestPost(context) {\n  // Alias to PUT\n  return onRequestPut(context);\n}\n", "/**\n * Chatbot Users/Leads API\n * GET /api/chatbot/users - List all leads captured from chatbot\n * POST /api/chatbot/users - Register/update a user from chatbot\n */\n\n/**\n * GET /api/chatbot/users - List all leads\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status');\n  const search = url.searchParams.get('search');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM chatbot_users\";\n    const conditions = [];\n    const params = [];\n\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n\n    if (search) {\n      conditions.push(\"(email LIKE ? OR name LIKE ? OR restaurant_name LIKE ? OR phone LIKE ?)\");\n      const searchTerm = `%${search}%`;\n      params.push(searchTerm, searchTerm, searchTerm, searchTerm);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n\n    query += \" ORDER BY created_at DESC LIMIT ? OFFSET ?\";\n    params.push(limit, offset);\n\n    const { results: users } = await env.DB.prepare(query).bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM chatbot_users\";\n    if (conditions.length > 0) {\n      countQuery += \" WHERE \" + conditions.join(\" AND \");\n    }\n    const countParams = params.slice(0, -2);\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = countParams.length > 0 \n      ? await countStmt.bind(...countParams).first()\n      : await countStmt.first();\n\n    // Get stats\n    const stats = await env.DB.prepare(`\n      SELECT \n        COUNT(*) as total,\n        SUM(CASE WHEN status = 'lead' THEN 1 ELSE 0 END) as leads,\n        SUM(CASE WHEN status = 'customer' THEN 1 ELSE 0 END) as customers,\n        SUM(CASE WHEN status = 'qualified' THEN 1 ELSE 0 END) as qualified\n      FROM chatbot_users\n    `).first();\n\n    // Format users with proper field names\n    const formattedUsers = users.map(u => ({\n      id: u.id,\n      visitorId: u.visitor_id,\n      email: u.email,\n      name: u.name,\n      phone: u.phone,\n      company: u.company,\n      restaurantName: u.restaurant_name,\n      userType: u.user_type,\n      systemUsage: u.system_usage,\n      language: u.language,\n      source: u.source,\n      status: u.status,\n      totalConversations: u.total_conversations,\n      totalMessages: u.total_messages,\n      lastConversationAt: u.last_conversation_at,\n      customFields: u.custom_fields ? JSON.parse(u.custom_fields) : {},\n      tags: u.tags ? JSON.parse(u.tags) : [],\n      notes: u.notes,\n      createdAt: u.created_at,\n      updatedAt: u.updated_at\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      users: formattedUsers,\n      stats: {\n        total: stats?.total || 0,\n        leads: stats?.leads || 0,\n        customers: stats?.customers || 0,\n        qualified: stats?.qualified || 0\n      },\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/users - Register or update user from chatbot\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Email is required for user registration\n    if (!data.email && !data.userEmail) {\n      // Check if we're just updating by visitorId\n      if (data.visitorId) {\n        const existing = await env.DB.prepare(\n          \"SELECT * FROM chatbot_users WHERE visitor_id = ?\"\n        ).bind(data.visitorId).first();\n\n        if (existing) {\n          // Update existing user\n          const updates = [];\n          const values = [];\n\n          if (data.name) { updates.push('name = ?'); values.push(data.name); }\n          if (data.phone) { updates.push('phone = ?'); values.push(data.phone); }\n          if (data.restaurantName) { updates.push('restaurant_name = ?'); values.push(data.restaurantName); }\n          if (data.userType) { updates.push('user_type = ?'); values.push(data.userType); }\n          if (data.systemUsage) { updates.push('system_usage = ?'); values.push(data.systemUsage); }\n          if (data.language) { updates.push('language = ?'); values.push(data.language); }\n\n          if (updates.length > 0) {\n            updates.push('updated_at = ?');\n            values.push(now);\n            values.push(existing.id);\n\n            await env.DB.prepare(`\n              UPDATE chatbot_users SET ${updates.join(', ')} WHERE id = ?\n            `).bind(...values).run();\n          }\n\n          return new Response(JSON.stringify({\n            success: true,\n            user: { id: existing.id },\n            updated: true\n          }), {\n            headers: { \"Content-Type\": \"application/json\" }\n          });\n        }\n      }\n\n      return new Response(JSON.stringify({ success: false, error: \"Email is required for registration\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const email = (data.email || data.userEmail).toLowerCase().trim();\n\n    // Check if user exists\n    const existing = await env.DB.prepare(\n      \"SELECT * FROM chatbot_users WHERE email = ?\"\n    ).bind(email).first();\n\n    if (existing) {\n      // Update existing user\n      const updates = ['updated_at = ?'];\n      const values = [now];\n\n      if (data.name) { updates.push('name = ?'); values.push(data.name); }\n      if (data.phone || data.userPhone) { updates.push('phone = ?'); values.push(data.phone || data.userPhone); }\n      if (data.restaurantName) { updates.push('restaurant_name = ?'); values.push(data.restaurantName); }\n      if (data.userType) { updates.push('user_type = ?'); values.push(data.userType); }\n      if (data.systemUsage) { updates.push('system_usage = ?'); values.push(data.systemUsage); }\n      if (data.language) { updates.push('language = ?'); values.push(data.language); }\n      if (data.visitorId) { updates.push('visitor_id = ?'); values.push(data.visitorId); }\n\n      values.push(existing.id);\n\n      await env.DB.prepare(`\n        UPDATE chatbot_users SET ${updates.join(', ')} WHERE id = ?\n      `).bind(...values).run();\n\n      // Link conversations to this user\n      if (data.visitorId || data.conversationId) {\n        await env.DB.prepare(`\n          UPDATE chatbot_conversations \n          SET user_id = ?, user_name = ?, user_email = ?, user_phone = ?,\n              restaurant_name = ?, user_type = ?, is_registered = 1, updated_at = ?\n          WHERE (visitor_id = ? OR id = ?) AND user_id IS NULL\n        `).bind(\n          existing.id,\n          data.name || existing.name,\n          email,\n          data.phone || data.userPhone || existing.phone,\n          data.restaurantName || existing.restaurant_name,\n          data.userType || existing.user_type,\n          now,\n          data.visitorId || '',\n          data.conversationId || ''\n        ).run();\n      }\n\n      return new Response(JSON.stringify({\n        success: true,\n        user: { id: existing.id, email: existing.email },\n        updated: true\n      }), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Create new user\n    const userId = `user_${crypto.randomUUID().split('-')[0]}`;\n\n    await env.DB.prepare(`\n      INSERT INTO chatbot_users (\n        id, visitor_id, email, name, phone, restaurant_name, user_type,\n        system_usage, language, source, status, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'lead', ?, ?)\n    `).bind(\n      userId,\n      data.visitorId || null,\n      email,\n      data.name || null,\n      data.phone || data.userPhone || null,\n      data.restaurantName || null,\n      data.userType || null,\n      data.systemUsage || null,\n      data.language || 'en',\n      data.source || 'chatbot',\n      now,\n      now\n    ).run();\n\n    // Link conversations to this user\n    if (data.visitorId || data.conversationId) {\n      await env.DB.prepare(`\n        UPDATE chatbot_conversations \n        SET user_id = ?, user_name = ?, user_email = ?, user_phone = ?,\n            restaurant_name = ?, user_type = ?, is_registered = 1, updated_at = ?\n        WHERE (visitor_id = ? OR id = ?)\n      `).bind(\n        userId,\n        data.name,\n        email,\n        data.phone || data.userPhone,\n        data.restaurantName,\n        data.userType,\n        now,\n        data.visitorId || '',\n        data.conversationId || ''\n      ).run();\n    }\n\n    // Update daily analytics for lead capture\n    try {\n      const today = new Date().toISOString().split('T')[0];\n      await env.DB.prepare(`\n        INSERT INTO chatbot_analytics (id, date, leads_captured, created_at, updated_at)\n        VALUES (?, ?, 1, ?, ?)\n        ON CONFLICT(date) DO UPDATE SET \n          leads_captured = leads_captured + 1,\n          updated_at = ?\n      `).bind(`analytics_${today}`, today, now, now, now).run();\n    } catch (e) {\n      // Analytics update is not critical\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      user: { id: userId, email },\n      created: true\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Chatbot Widget Code API\n * GET /api/chatbot/widget - Get widget embed code\n * POST /api/chatbot/widget - Track widget deployment\n */\n\n/**\n * GET /api/chatbot/widget - Generate widget embed code\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const deploymentId = url.searchParams.get('deployment_id');\n  const format = url.searchParams.get('format') || 'js'; // js, html, react\n\n  try {\n    const baseUrl = new URL(request.url).origin;\n    \n    // Get settings for widget configuration\n    let settings = {};\n    if (env.DB) {\n      const { results } = await env.DB.prepare(\n        \"SELECT key, value, type FROM chatbot_settings WHERE category IN ('general', 'widget', 'features')\"\n      ).all();\n\n      results?.forEach(row => {\n        let value = row.value;\n        if (row.type === 'boolean') value = row.value === 'true';\n        else if (row.type === 'number') value = parseInt(row.value);\n        else if (row.type === 'json') {\n          try { value = JSON.parse(row.value); } catch (e) { }\n        }\n        settings[row.key] = value;\n      });\n    }\n\n    // Generate widget configuration\n    const widgetConfig = {\n      apiEndpoint: `${baseUrl}/api/chatbot`,\n      position: settings.widget_position || 'bottom-right',\n      primaryColor: settings.widget_color || '#e8f24c',\n      chatbotName: settings.chatbot_name || 'Fooodis Assistant',\n      welcomeMessage: settings.welcome_message || 'Hello! How can I help you today?',\n      languages: settings.supported_languages || ['en', 'sv'],\n      enableRating: settings.enable_rating !== false,\n      enableFileUpload: settings.enable_file_upload !== false,\n      deploymentId\n    };\n\n    // Generate embed codes based on format\n    let embedCode;\n    let embedCodeMinified;\n\n    if (format === 'react') {\n      embedCode = `// React Component\nimport React, { useEffect } from 'react';\n\nconst FoodisChatbot = () => {\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = '${baseUrl}/js/chatbot-widget.js';\n    script.async = true;\n    script.onload = () => {\n      if (window.FoodisChatbot) {\n        window.FoodisChatbot.init(${JSON.stringify(widgetConfig, null, 2)});\n      }\n    };\n    document.body.appendChild(script);\n    \n    return () => {\n      document.body.removeChild(script);\n    };\n  }, []);\n\n  return null;\n};\n\nexport default FoodisChatbot;`;\n\n    } else if (format === 'html') {\n      embedCode = `<!-- Fooodis Chatbot Widget -->\n<script>\n  window.FoodisChatbotConfig = ${JSON.stringify(widgetConfig, null, 2)};\n</script>\n<script src=\"${baseUrl}/js/chatbot-widget.js\" async></script>`;\n\n      embedCodeMinified = `<script>window.FoodisChatbotConfig=${JSON.stringify(widgetConfig)};</script><script src=\"${baseUrl}/js/chatbot-widget.js\" async></script>`;\n\n    } else {\n      // Default JavaScript\n      embedCode = `// Fooodis Chatbot Widget\n(function() {\n  var config = ${JSON.stringify(widgetConfig, null, 2)};\n  \n  var script = document.createElement('script');\n  script.src = '${baseUrl}/js/chatbot-widget.js';\n  script.async = true;\n  script.onload = function() {\n    if (window.FoodisChatbot) {\n      window.FoodisChatbot.init(config);\n    }\n  };\n  document.body.appendChild(script);\n})();`;\n\n      embedCodeMinified = `(function(){var c=${JSON.stringify(widgetConfig)};var s=document.createElement('script');s.src='${baseUrl}/js/chatbot-widget.js';s.async=!0;s.onload=function(){window.FoodisChatbot&&window.FoodisChatbot.init(c)};document.body.appendChild(s)})();`;\n    }\n\n    // Get deployments if admin request\n    let deployments = [];\n    if (env.DB) {\n      const { results } = await env.DB.prepare(\n        \"SELECT * FROM chatbot_deployments ORDER BY created_at DESC LIMIT 10\"\n      ).all();\n      deployments = results || [];\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      embedCode,\n      embedCodeMinified,\n      config: widgetConfig,\n      deployments\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot/widget - Register widget deployment\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Check for existing deployment\n    if (data.deployment_id) {\n      const existing = await env.DB.prepare(\n        \"SELECT * FROM chatbot_deployments WHERE id = ?\"\n      ).bind(data.deployment_id).first();\n\n      if (existing) {\n        // Update ping\n        await env.DB.prepare(`\n          UPDATE chatbot_deployments \n          SET last_ping = ?, total_loads = total_loads + 1, updated_at = ?\n          WHERE id = ?\n        `).bind(now, now, data.deployment_id).run();\n\n        return new Response(JSON.stringify({\n          success: true,\n          deployment: { id: existing.id },\n          action: 'updated'\n        }), {\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n    }\n\n    // Create new deployment\n    const id = data.deployment_id || `deploy_${crypto.randomUUID().split('-')[0]}`;\n\n    await env.DB.prepare(`\n      INSERT INTO chatbot_deployments (\n        id, name, domain, config, is_active, last_ping, total_loads, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, 1, ?, 1, ?, ?)\n    `).bind(\n      id,\n      data.name || data.domain || 'Unnamed Deployment',\n      data.domain || null,\n      data.config ? JSON.stringify(data.config) : null,\n      now,\n      now,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      deployment: { id },\n      action: 'created'\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Customer Authentication API\n * POST /api/customers/auth - Login\n * DELETE /api/customers/auth - Logout\n * GET /api/customers/auth - Validate token\n */\n\n/**\n * GET /api/customers/auth - Validate auth token\n */\nexport async function onRequestGet(context) {\n  const { request, env } = context;\n  \n  const authHeader = request.headers.get('Authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    return new Response(JSON.stringify({ success: false, error: \"No token provided\" }), {\n      status: 401,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  const token = authHeader.substring(7);\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Check KV for token\n    let tokenData = null;\n    if (env.KV) {\n      try {\n        const cached = await env.KV.get(`auth_${token}`);\n        if (cached) {\n          tokenData = JSON.parse(cached);\n        }\n      } catch (e) {\n        console.error('KV error:', e);\n      }\n    }\n\n    if (!tokenData) {\n      return new Response(JSON.stringify({ success: false, error: \"Invalid or expired token\" }), {\n        status: 401,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get customer info\n    const customer = await env.DB.prepare(\n      \"SELECT id, email, name, phone, company, status, total_tickets, last_login FROM support_customers WHERE id = ?\"\n    ).bind(tokenData.customer_id).first();\n\n    if (!customer || customer.status !== 'active') {\n      return new Response(JSON.stringify({ success: false, error: \"Account not found or inactive\" }), {\n        status: 401,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { customer }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/customers/auth - Login\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.email) {\n      return new Response(JSON.stringify({ success: false, error: \"Email is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const email = data.email.toLowerCase().trim();\n\n    // Find customer\n    const customer = await env.DB.prepare(\n      \"SELECT * FROM support_customers WHERE email = ?\"\n    ).bind(email).first();\n\n    if (!customer) {\n      // Auto-create customer for easy onboarding\n      const now = Date.now();\n      const customerId = `cust_${crypto.randomUUID().split('-')[0]}`;\n      \n      await env.DB.prepare(`\n        INSERT INTO support_customers (id, email, name, status, created_at, updated_at)\n        VALUES (?, ?, ?, 'active', ?, ?)\n      `).bind(customerId, email, data.name || email.split('@')[0], now, now).run();\n\n      const token = await generateToken(customerId, email);\n\n      // Store token in KV\n      if (env.KV) {\n        await env.KV.put(`auth_${token}`, JSON.stringify({\n          customer_id: customerId,\n          email,\n          created_at: now\n        }), { expirationTtl: 86400 * 7 });\n      }\n\n      return new Response(JSON.stringify({\n        success: true,\n        message: \"Account created and logged in\",\n        data: {\n          customer: {\n            id: customerId,\n            email,\n            name: data.name || email.split('@')[0]\n          },\n          token,\n          newAccount: true\n        }\n      }), {\n        status: 201,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Check if password required and validate\n    if (customer.password_hash && data.password) {\n      const passwordHash = await hashPassword(data.password);\n      if (passwordHash !== customer.password_hash) {\n        return new Response(JSON.stringify({ success: false, error: \"Invalid password\" }), {\n          status: 401,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n    }\n\n    // Check account status\n    if (customer.status !== 'active') {\n      return new Response(JSON.stringify({ success: false, error: \"Account is inactive\" }), {\n        status: 403,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n\n    // Generate token\n    const token = await generateToken(customer.id, email);\n\n    // Store token in KV\n    if (env.KV) {\n      await env.KV.put(`auth_${token}`, JSON.stringify({\n        customer_id: customer.id,\n        email,\n        created_at: now\n      }), { expirationTtl: 86400 * 7 });\n    }\n\n    // Update last login\n    await env.DB.prepare(\n      \"UPDATE support_customers SET last_login = ?, login_count = login_count + 1 WHERE id = ?\"\n    ).bind(now, customer.id).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: \"Login successful\",\n      data: {\n        customer: {\n          id: customer.id,\n          email: customer.email,\n          name: customer.name,\n          phone: customer.phone,\n          company: customer.company,\n          total_tickets: customer.total_tickets\n        },\n        token\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/customers/auth - Logout\n */\nexport async function onRequestDelete(context) {\n  const { request, env } = context;\n\n  const authHeader = request.headers.get('Authorization');\n  if (authHeader?.startsWith('Bearer ')) {\n    const token = authHeader.substring(7);\n    \n    // Remove token from KV\n    if (env.KV) {\n      try {\n        await env.KV.delete(`auth_${token}`);\n      } catch (e) {\n        console.error('KV error:', e);\n      }\n    }\n  }\n\n  return new Response(JSON.stringify({\n    success: true,\n    message: \"Logged out successfully\"\n  }), {\n    headers: { \"Content-Type\": \"application/json\" }\n  });\n}\n\n/**\n * Hash password\n */\nasync function hashPassword(password) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(password + 'fooodis_support_salt_2024');\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Generate auth token\n */\nasync function generateToken(customerId, email) {\n  const data = `${customerId}:${email}:${Date.now()}:${crypto.randomUUID()}`;\n  const encoder = new TextEncoder();\n  const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(data));\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n", "/**\n * Media Bulk Operations API\n * POST /api/media/bulk - Perform bulk operations on media files\n * \n * Operations:\n * - delete: Delete multiple media files\n * - move: Move multiple files to a folder\n * - update: Update metadata for multiple files\n */\n\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const { operation, ids, options } = data;\n\n    if (!operation) {\n      return new Response(JSON.stringify({ error: \"Operation is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (!ids || !Array.isArray(ids) || ids.length === 0) {\n      return new Response(JSON.stringify({ error: \"Media IDs array is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const results = {\n      operation,\n      total: ids.length,\n      success: 0,\n      failed: 0,\n      details: []\n    };\n\n    switch (operation) {\n      case 'delete':\n        for (const id of ids) {\n          try {\n            // Get media record to find R2 key\n            const media = await env.DB.prepare(\n              \"SELECT r2_key, thumbnail_key FROM media_library WHERE id = ?\"\n            ).bind(id).first();\n\n            if (media) {\n              // Delete from R2\n              if (env.MEDIA_BUCKET && media.r2_key) {\n                try {\n                  await env.MEDIA_BUCKET.delete(media.r2_key);\n                  if (media.thumbnail_key) {\n                    await env.MEDIA_BUCKET.delete(media.thumbnail_key);\n                  }\n                } catch (r2Error) {\n                  console.error('R2 delete error:', r2Error);\n                }\n              }\n\n              // Delete from D1\n              await env.DB.prepare(\n                \"DELETE FROM media_library WHERE id = ?\"\n              ).bind(id).run();\n\n              results.success++;\n              results.details.push({ id, status: 'deleted' });\n            } else {\n              results.failed++;\n              results.details.push({ id, status: 'not_found' });\n            }\n          } catch (err) {\n            results.failed++;\n            results.details.push({ id, status: 'error', error: err.message });\n          }\n        }\n        break;\n\n      case 'move':\n        const targetFolder = options?.folder;\n        if (!targetFolder) {\n          return new Response(JSON.stringify({ error: \"Target folder is required for move operation\" }), {\n            status: 400,\n            headers: { \"Content-Type\": \"application/json\" }\n          });\n        }\n\n        const now = Date.now();\n        for (const id of ids) {\n          try {\n            const result = await env.DB.prepare(\n              \"UPDATE media_library SET folder = ?, updated_at = ? WHERE id = ?\"\n            ).bind(targetFolder, now, id).run();\n\n            if (result.meta.changes > 0) {\n              results.success++;\n              results.details.push({ id, status: 'moved', folder: targetFolder });\n            } else {\n              results.failed++;\n              results.details.push({ id, status: 'not_found' });\n            }\n          } catch (err) {\n            results.failed++;\n            results.details.push({ id, status: 'error', error: err.message });\n          }\n        }\n        break;\n\n      case 'update':\n        const updates = options?.updates || {};\n        if (Object.keys(updates).length === 0) {\n          return new Response(JSON.stringify({ error: \"Updates object is required\" }), {\n            status: 400,\n            headers: { \"Content-Type\": \"application/json\" }\n          });\n        }\n\n        // Build update query\n        const allowedFields = ['alt_text', 'caption', 'folder', 'is_featured'];\n        const setClauses = [];\n        const values = [];\n\n        for (const [key, value] of Object.entries(updates)) {\n          if (allowedFields.includes(key)) {\n            setClauses.push(`${key} = ?`);\n            values.push(key === 'is_featured' ? (value ? 1 : 0) : value);\n          }\n        }\n\n        if (setClauses.length === 0) {\n          return new Response(JSON.stringify({ error: \"No valid fields to update\" }), {\n            status: 400,\n            headers: { \"Content-Type\": \"application/json\" }\n          });\n        }\n\n        setClauses.push('updated_at = ?');\n        values.push(Date.now());\n\n        for (const id of ids) {\n          try {\n            const result = await env.DB.prepare(\n              `UPDATE media_library SET ${setClauses.join(', ')} WHERE id = ?`\n            ).bind(...values, id).run();\n\n            if (result.meta.changes > 0) {\n              results.success++;\n              results.details.push({ id, status: 'updated' });\n            } else {\n              results.failed++;\n              results.details.push({ id, status: 'not_found' });\n            }\n          } catch (err) {\n            results.failed++;\n            results.details.push({ id, status: 'error', error: err.message });\n          }\n        }\n        break;\n\n      default:\n        return new Response(JSON.stringify({ error: `Unknown operation: ${operation}` }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n    }\n\n    return new Response(JSON.stringify({ success: true, results }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Media Folders API\n * GET /api/media/folders - List all media folders\n * POST /api/media/folders - Create a new folder\n * \n * Integrates with:\n * - Media Library section\n * - AI Content Automation (folder selection)\n * - Create New Blog Post (featured image organization)\n */\n\nexport async function onRequestGet(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // First, try to get folders from media_folders table\n    let definedFolders = [];\n    try {\n      const { results } = await env.DB.prepare(\n        \"SELECT * FROM media_folders ORDER BY is_system DESC, name ASC\"\n      ).all();\n      definedFolders = results || [];\n    } catch (e) {\n      // Table might not exist yet\n      console.log('media_folders table not available, using fallback');\n    }\n\n    // Get file counts from media_library\n    const { results: fileCounts } = await env.DB.prepare(`\n      SELECT folder, COUNT(*) as file_count, SUM(file_size) as total_size\n      FROM media_library \n      GROUP BY folder\n    `).all();\n\n    const fileCountMap = new Map();\n    fileCounts.forEach(row => {\n      fileCountMap.set(row.folder, {\n        file_count: row.file_count,\n        total_size: row.total_size || 0\n      });\n    });\n\n    // Merge defined folders with file counts\n    const folderMap = new Map();\n\n    // Add defined folders\n    definedFolders.forEach(folder => {\n      const counts = fileCountMap.get(folder.name) || { file_count: 0, total_size: 0 };\n      folderMap.set(folder.name, {\n        id: folder.id,\n        name: folder.name,\n        display_name: folder.display_name || folder.name,\n        description: folder.description,\n        file_count: counts.file_count,\n        total_size: counts.total_size,\n        color: folder.color,\n        icon: folder.icon,\n        is_system: folder.is_system === 1\n      });\n    });\n\n    // Add folders from file counts that aren't in defined folders\n    fileCounts.forEach(row => {\n      if (!folderMap.has(row.folder)) {\n        folderMap.set(row.folder, {\n          name: row.folder,\n          display_name: row.folder,\n          file_count: row.file_count,\n          total_size: row.total_size || 0,\n          is_system: false\n        });\n      }\n    });\n\n    // Also check R2 bucket if configured\n    if (env.MEDIA_BUCKET) {\n      try {\n        const listed = await env.MEDIA_BUCKET.list({ delimiter: '/' });\n        \n        if (listed.delimitedPrefixes) {\n          listed.delimitedPrefixes.forEach(prefix => {\n            const folderName = prefix.replace(/\\/$/, '');\n            if (!folderMap.has(folderName)) {\n              folderMap.set(folderName, {\n                name: folderName,\n                display_name: folderName,\n                file_count: 0,\n                total_size: 0,\n                source: 'r2',\n                is_system: false\n              });\n            }\n          });\n        }\n      } catch (r2Error) {\n        console.error('R2 listing error:', r2Error);\n      }\n    }\n\n    // Ensure default folders exist\n    const defaultFolders = [\n      { name: 'uploads', display_name: 'Uploads', is_system: true },\n      { name: 'blog-images', display_name: 'Blog Images', is_system: true },\n      { name: 'ai-generated', display_name: 'AI Generated', is_system: true },\n      { name: 'featured', display_name: 'Featured', is_system: true }\n    ];\n    \n    defaultFolders.forEach(df => {\n      if (!folderMap.has(df.name)) {\n        folderMap.set(df.name, {\n          name: df.name,\n          display_name: df.display_name,\n          file_count: 0,\n          total_size: 0,\n          is_system: df.is_system\n        });\n      }\n    });\n\n    const folders = Array.from(folderMap.values()).sort((a, b) => {\n      // System folders first, then alphabetically\n      if (a.is_system && !b.is_system) return -1;\n      if (!a.is_system && b.is_system) return 1;\n      return a.name.localeCompare(b.name);\n    });\n\n    return new Response(JSON.stringify(folders), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/media/folders - Create a new folder\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    \n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Folder name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Sanitize folder name\n    const folderName = data.name\n      .toLowerCase()\n      .replace(/[^a-z0-9-_]/g, '-')\n      .replace(/-+/g, '-')\n      .replace(/^-|-$/g, '');\n\n    const displayName = data.display_name || data.name;\n    const now = Date.now();\n    const id = `folder_${crypto.randomUUID().split('-')[0]}`;\n\n    // Try to insert into media_folders table\n    try {\n      await env.DB.prepare(`\n        INSERT INTO media_folders (id, name, display_name, description, color, icon, is_system, created_at, updated_at)\n        VALUES (?, ?, ?, ?, ?, ?, 0, ?, ?)\n      `).bind(\n        id,\n        folderName,\n        displayName,\n        data.description || '',\n        data.color || '#478ac9',\n        data.icon || 'folder',\n        now,\n        now\n      ).run();\n    } catch (dbError) {\n      // If table doesn't exist or duplicate, continue\n      if (dbError.message?.includes('UNIQUE')) {\n        return new Response(JSON.stringify({ error: \"Folder already exists\" }), {\n          status: 409,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n      console.log('Could not insert into media_folders:', dbError.message);\n    }\n\n    // Create placeholder file in R2 to establish the folder\n    if (env.MEDIA_BUCKET) {\n      try {\n        await env.MEDIA_BUCKET.put(`${folderName}/.folder`, '', {\n          customMetadata: { \n            created: new Date().toISOString(),\n            display_name: displayName\n          }\n        });\n      } catch (r2Error) {\n        console.error('R2 folder creation error:', r2Error);\n      }\n    }\n\n    // Dispatch event for cross-module sync\n    const folder = {\n      id,\n      name: folderName,\n      display_name: displayName,\n      description: data.description || '',\n      file_count: 0,\n      total_size: 0,\n      is_system: false\n    };\n\n    return new Response(JSON.stringify({ \n      success: true, \n      folder\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/media/folders - Delete a folder (move files to uploads)\n */\nexport async function onRequestDelete(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const url = new URL(request.url);\n    const folderName = url.searchParams.get('name');\n\n    if (!folderName) {\n      return new Response(JSON.stringify({ error: \"Folder name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Check if it's a system folder\n    try {\n      const folder = await env.DB.prepare(\n        \"SELECT is_system FROM media_folders WHERE name = ?\"\n      ).bind(folderName).first();\n\n      if (folder && folder.is_system === 1) {\n        return new Response(JSON.stringify({ error: \"Cannot delete system folder\" }), {\n          status: 403,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n    } catch (e) {\n      // Table might not exist\n    }\n\n    // Move all files in this folder to 'uploads'\n    await env.DB.prepare(\n      \"UPDATE media_library SET folder = 'uploads', updated_at = ? WHERE folder = ?\"\n    ).bind(Date.now(), folderName).run();\n\n    // Delete from media_folders table\n    try {\n      await env.DB.prepare(\n        \"DELETE FROM media_folders WHERE name = ? AND is_system = 0\"\n      ).bind(folderName).run();\n    } catch (e) {\n      // Table might not exist\n    }\n\n    // Try to delete placeholder from R2\n    if (env.MEDIA_BUCKET) {\n      try {\n        await env.MEDIA_BUCKET.delete(`${folderName}/.folder`);\n      } catch (r2Error) {\n        // Ignore\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, folder: folderName }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Profile Avatar API\n * POST /api/profile/avatar - Upload new avatar image\n * DELETE /api/profile/avatar - Remove avatar image\n * \n * Uploads avatar to R2 storage and updates profile\n */\n\nconst ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\nconst MAX_SIZE = 5 * 1024 * 1024; // 5MB\n\n/**\n * POST /api/profile/avatar - Upload avatar\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  if (!env.MEDIA_BUCKET) {\n    return new Response(JSON.stringify({ error: \"R2 bucket not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const contentType = request.headers.get('content-type') || '';\n    \n    if (!contentType.includes('multipart/form-data')) {\n      return new Response(JSON.stringify({ error: \"Content-Type must be multipart/form-data\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const formData = await request.formData();\n    const file = formData.get('avatar') || formData.get('file');\n\n    if (!file || !(file instanceof File)) {\n      return new Response(JSON.stringify({ error: \"No avatar file provided\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return new Response(JSON.stringify({ \n        error: \"Invalid file type. Allowed: JPEG, PNG, GIF, WebP\",\n        allowed: ALLOWED_TYPES\n      }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Validate file size\n    if (file.size > MAX_SIZE) {\n      return new Response(JSON.stringify({ \n        error: \"File too large. Maximum size is 5MB\",\n        maxSize: MAX_SIZE\n      }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get current profile to check for existing avatar\n    const currentProfile = await env.DB.prepare(\n      \"SELECT avatar_url FROM user_profiles WHERE user_id = 'admin'\"\n    ).first();\n\n    // Delete old avatar from R2 if exists\n    if (currentProfile?.avatar_url) {\n      try {\n        // Extract R2 key from URL\n        const oldKey = currentProfile.avatar_url.replace('/api/media/serve/', '');\n        if (oldKey.startsWith('avatars/')) {\n          await env.MEDIA_BUCKET.delete(decodeURIComponent(oldKey));\n        }\n      } catch (e) {\n        console.error('Error deleting old avatar:', e);\n      }\n    }\n\n    // Generate new filename\n    const timestamp = Date.now();\n    const ext = file.name.split('.').pop() || 'jpg';\n    const r2Key = `avatars/admin-${timestamp}.${ext}`;\n\n    // Upload to R2\n    const fileBuffer = await file.arrayBuffer();\n    await env.MEDIA_BUCKET.put(r2Key, fileBuffer, {\n      httpMetadata: {\n        contentType: file.type,\n      },\n      customMetadata: {\n        originalFilename: file.name,\n        uploadedAt: new Date().toISOString(),\n        userId: 'admin'\n      }\n    });\n\n    // Generate URL\n    const avatarUrl = `/api/media/serve/${encodeURIComponent(r2Key)}`;\n\n    // Update profile in D1\n    const now = Date.now();\n    await env.DB.prepare(\n      \"UPDATE user_profiles SET avatar_url = ?, updated_at = ? WHERE user_id = 'admin'\"\n    ).bind(avatarUrl, now).run();\n\n    // Also store in media_library for reference\n    await env.DB.prepare(`\n      INSERT INTO media_library (\n        id, filename, original_filename, mime_type, file_size, \n        r2_key, r2_url, folder, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, 'avatars', ?, ?)\n    `).bind(\n      `avatar_admin_${timestamp}`,\n      `admin-${timestamp}.${ext}`,\n      file.name,\n      file.type,\n      file.size,\n      r2Key,\n      avatarUrl,\n      now,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      avatar_url: avatarUrl,\n      message: \"Avatar uploaded successfully\"\n    }), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    console.error('Avatar upload error:', error);\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/profile/avatar - Remove avatar\n */\nexport async function onRequestDelete(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get current avatar\n    const profile = await env.DB.prepare(\n      \"SELECT avatar_url FROM user_profiles WHERE user_id = 'admin'\"\n    ).first();\n\n    if (profile?.avatar_url && env.MEDIA_BUCKET) {\n      try {\n        const r2Key = profile.avatar_url.replace('/api/media/serve/', '');\n        if (r2Key.startsWith('avatars/')) {\n          await env.MEDIA_BUCKET.delete(decodeURIComponent(r2Key));\n        }\n      } catch (e) {\n        console.error('Error deleting avatar from R2:', e);\n      }\n    }\n\n    // Clear avatar URL in profile\n    const now = Date.now();\n    await env.DB.prepare(\n      \"UPDATE user_profiles SET avatar_url = NULL, updated_at = ? WHERE user_id = 'admin'\"\n    ).bind(now).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      message: \"Avatar removed successfully\"\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Password Change API\n * POST /api/profile/password - Change password\n * \n * Note: In a production app, you would use proper authentication\n * This is a simplified version for the single-admin blog system\n */\n\n/**\n * POST /api/profile/password - Change password\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const { current_password, new_password, confirm_password } = data;\n\n    // Validation\n    if (!current_password || !new_password || !confirm_password) {\n      return new Response(JSON.stringify({ error: \"All password fields are required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (new_password !== confirm_password) {\n      return new Response(JSON.stringify({ error: \"New passwords do not match\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (new_password.length < 8) {\n      return new Response(JSON.stringify({ error: \"Password must be at least 8 characters\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get current password from DB\n    const profile = await env.DB.prepare(\n      \"SELECT password_hash FROM user_profiles WHERE user_id = 'admin'\"\n    ).first();\n\n    // Simple password verification (in production, use proper hashing like bcrypt)\n    // For this demo, we'll use a simple hash\n    const currentHash = await hashPassword(current_password);\n    \n    // If no password is set yet, allow any current password\n    if (profile?.password_hash && profile.password_hash !== currentHash) {\n      return new Response(JSON.stringify({ error: \"Current password is incorrect\" }), {\n        status: 401,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Hash new password\n    const newHash = await hashPassword(new_password);\n\n    // Update password\n    const now = Date.now();\n    await env.DB.prepare(\n      \"UPDATE user_profiles SET password_hash = ?, password_changed_at = ?, updated_at = ? WHERE user_id = 'admin'\"\n    ).bind(newHash, now, now).run();\n\n    // Log the password change\n    try {\n      await env.DB.prepare(`\n        INSERT INTO activity_log (id, user_id, action, details, created_at)\n        VALUES (?, 'admin', 'password_change', ?, ?)\n      `).bind(\n        crypto.randomUUID(),\n        JSON.stringify({ timestamp: new Date().toISOString() }),\n        now\n      ).run();\n    } catch (e) {\n      // Activity log table might not exist\n    }\n\n    return new Response(JSON.stringify({ \n      success: true, \n      message: \"Password updated successfully\"\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Simple password hashing using Web Crypto API\n * Note: In production, use a proper library like bcrypt\n */\nasync function hashPassword(password) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(password + 'fooodis_salt_2024');\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n", "/**\n * Check and Publish Due Posts API\n * POST /api/scheduled-posts/check - Check for due posts and publish them\n * GET /api/scheduled-posts/check - Get posts that are due for publishing\n * \n * This should be called periodically (e.g., via Cloudflare Cron Trigger or client polling)\n */\n\n/**\n * GET - Get posts that are due for publishing\n */\nexport async function onRequestGet(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n\n    // Get posts that are due (scheduled_datetime <= now and status is pending)\n    const { results } = await env.DB.prepare(`\n      SELECT * FROM scheduled_posts \n      WHERE scheduled_datetime <= ? AND status = 'pending'\n      ORDER BY priority DESC, scheduled_datetime ASC\n    `).bind(now).all();\n\n    const duePosts = results.map(post => ({\n      ...post,\n      tags: post.tags ? JSON.parse(post.tags) : [],\n      scheduled_date: new Date(post.scheduled_datetime).toISOString(),\n      is_overdue: post.scheduled_datetime < now\n    }));\n\n    return new Response(JSON.stringify({\n      due_count: duePosts.length,\n      posts: duePosts\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST - Check and publish all due posts\n */\nexport async function onRequestPost(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n    const results = {\n      checked: 0,\n      published: 0,\n      failed: 0,\n      details: []\n    };\n\n    // Get all due posts\n    const { results: duePosts } = await env.DB.prepare(`\n      SELECT * FROM scheduled_posts \n      WHERE scheduled_datetime <= ? AND status = 'pending'\n      ORDER BY priority DESC, scheduled_datetime ASC\n    `).bind(now).all();\n\n    results.checked = duePosts.length;\n\n    // Publish each due post\n    for (const scheduledPost of duePosts) {\n      try {\n        // Update status to publishing\n        await env.DB.prepare(\n          \"UPDATE scheduled_posts SET status = 'publishing', last_attempt = ? WHERE id = ?\"\n        ).bind(now, scheduledPost.id).run();\n\n        // Create the blog post\n        const blogPostId = crypto.randomUUID();\n        \n        await env.DB.prepare(`\n          INSERT INTO blog_posts (\n            id, title, content, excerpt, image_url, author, category, subcategory, tags,\n            published_date, status, featured, views, likes, comments_count, created_at, updated_at, slug\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'published', ?, 0, 0, 0, ?, ?, ?)\n        `).bind(\n          blogPostId,\n          scheduledPost.title,\n          scheduledPost.content,\n          scheduledPost.excerpt,\n          scheduledPost.image_url,\n          scheduledPost.author,\n          scheduledPost.category,\n          scheduledPost.subcategory,\n          scheduledPost.tags,\n          new Date().toISOString(),\n          scheduledPost.is_featured,\n          now,\n          now,\n          scheduledPost.slug\n        ).run();\n\n        // Update scheduled post as published\n        await env.DB.prepare(`\n          UPDATE scheduled_posts SET \n            status = 'published', \n            published_post_id = ?, \n            updated_at = ? \n          WHERE id = ?\n        `).bind(blogPostId, now, scheduledPost.id).run();\n\n        // Log the event\n        await env.DB.prepare(`\n          INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n          VALUES (?, ?, 'published', ?, ?)\n        `).bind(\n          crypto.randomUUID(),\n          scheduledPost.id,\n          JSON.stringify({ \n            blog_post_id: blogPostId,\n            published_at: new Date(now).toISOString(),\n            auto_published: true\n          }),\n          now\n        ).run();\n\n        // Update category count\n        if (scheduledPost.category && scheduledPost.category !== 'Uncategorized') {\n          await env.DB.prepare(\n            \"UPDATE categories SET post_count = post_count + 1 WHERE name = ?\"\n          ).bind(scheduledPost.category).run();\n        }\n\n        results.published++;\n        results.details.push({\n          id: scheduledPost.id,\n          title: scheduledPost.title,\n          status: 'published',\n          blog_post_id: blogPostId\n        });\n\n      } catch (publishError) {\n        // Handle publish error\n        const retryCount = (scheduledPost.retry_count || 0) + 1;\n        const newStatus = retryCount >= (scheduledPost.max_retries || 3) ? 'failed' : 'pending';\n\n        await env.DB.prepare(`\n          UPDATE scheduled_posts SET \n            status = ?, \n            retry_count = ?, \n            error_message = ?,\n            last_attempt = ?,\n            updated_at = ? \n          WHERE id = ?\n        `).bind(newStatus, retryCount, publishError.message, now, now, scheduledPost.id).run();\n\n        await env.DB.prepare(`\n          INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n          VALUES (?, ?, 'failed', ?, ?)\n        `).bind(\n          crypto.randomUUID(),\n          scheduledPost.id,\n          JSON.stringify({ error: publishError.message, retry_count: retryCount }),\n          now\n        ).run();\n\n        results.failed++;\n        results.details.push({\n          id: scheduledPost.id,\n          title: scheduledPost.title,\n          status: 'failed',\n          error: publishError.message\n        });\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      timestamp: new Date(now).toISOString(),\n      ...results\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Dashboard Statistics API\n * GET /api/stats/dashboard - Get comprehensive dashboard statistics\n * \n * Returns all data needed for the Blog Statistics dashboard section\n */\n\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const period = url.searchParams.get('period') || '30d';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n    let periodStart = 0;\n    let previousPeriodStart = 0;\n\n    switch (period) {\n      case '7d':\n        periodStart = now - (7 * 24 * 60 * 60 * 1000);\n        previousPeriodStart = periodStart - (7 * 24 * 60 * 60 * 1000);\n        break;\n      case '30d':\n        periodStart = now - (30 * 24 * 60 * 60 * 1000);\n        previousPeriodStart = periodStart - (30 * 24 * 60 * 60 * 1000);\n        break;\n      case '90d':\n        periodStart = now - (90 * 24 * 60 * 60 * 1000);\n        previousPeriodStart = periodStart - (90 * 24 * 60 * 60 * 1000);\n        break;\n      default:\n        periodStart = 0;\n        previousPeriodStart = 0;\n    }\n\n    // ========================================\n    // OVERVIEW STATS\n    // ========================================\n\n    // Total posts\n    const totalPosts = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM blog_posts WHERE status = 'published'\"\n    ).first();\n\n    // Posts in period\n    const postsInPeriod = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM blog_posts WHERE status = 'published' AND created_at >= ?\"\n    ).bind(periodStart).first();\n\n    // Total views\n    const totalViews = await env.DB.prepare(\n      \"SELECT SUM(views) as total FROM post_stats\"\n    ).first();\n\n    // Total comments\n    const totalComments = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM comments WHERE status = 'approved'\"\n    ).first();\n\n    // Comments in period\n    const commentsInPeriod = await env.DB.prepare(\n      \"SELECT COUNT(*) as total FROM comments WHERE status = 'approved' AND created_at >= ?\"\n    ).bind(periodStart).first();\n\n    // Total shares\n    const totalShares = await env.DB.prepare(\n      \"SELECT SUM(shares_total) as total FROM post_stats\"\n    ).first();\n\n    // Average read time\n    const avgReadTime = await env.DB.prepare(\n      \"SELECT AVG(avg_read_time) as avg FROM post_stats WHERE avg_read_time > 0\"\n    ).first();\n\n    // ========================================\n    // CATEGORY BREAKDOWN\n    // ========================================\n\n    const { results: categoryStats } = await env.DB.prepare(`\n      SELECT \n        c.name,\n        c.color,\n        c.post_count,\n        COALESCE(SUM(ps.views), 0) as total_views,\n        COALESCE(SUM(ps.shares_total), 0) as total_shares\n      FROM categories c\n      LEFT JOIN blog_posts p ON c.name = p.category AND p.status = 'published'\n      LEFT JOIN post_stats ps ON p.id = ps.post_id\n      WHERE c.is_active = 1\n      GROUP BY c.id\n      ORDER BY total_views DESC\n      LIMIT 10\n    `).all();\n\n    // ========================================\n    // TOP POSTS\n    // ========================================\n\n    const { results: topPosts } = await env.DB.prepare(`\n      SELECT \n        p.id, p.title, p.category, p.published_date, p.image_url,\n        COALESCE(ps.views, 0) as views,\n        COALESCE(ps.shares_total, 0) as shares,\n        (SELECT COUNT(*) FROM comments c WHERE c.post_id = p.id AND c.status = 'approved') as comments\n      FROM blog_posts p\n      LEFT JOIN post_stats ps ON p.id = ps.post_id\n      WHERE p.status = 'published'\n      ORDER BY ps.views DESC\n      LIMIT 5\n    `).all();\n\n    // ========================================\n    // RECENT POSTS PERFORMANCE\n    // ========================================\n\n    const { results: recentPosts } = await env.DB.prepare(`\n      SELECT \n        p.id, p.title, p.category, p.published_date,\n        COALESCE(ps.views, 0) as views,\n        COALESCE(ps.shares_total, 0) as shares\n      FROM blog_posts p\n      LEFT JOIN post_stats ps ON p.id = ps.post_id\n      WHERE p.status = 'published' AND p.created_at >= ?\n      ORDER BY p.created_at DESC\n      LIMIT 5\n    `).bind(periodStart).all();\n\n    // ========================================\n    // TRENDS DATA\n    // ========================================\n\n    // Calculate period change\n    let viewsChange = 0;\n    let commentsChange = 0;\n    let postsChange = 0;\n\n    if (previousPeriodStart > 0) {\n      // Views change (compare post_stats updates)\n      const currentPeriodViews = postsInPeriod?.total || 0;\n      \n      const previousPeriodPosts = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM blog_posts WHERE status = 'published' AND created_at >= ? AND created_at < ?\"\n      ).bind(previousPeriodStart, periodStart).first();\n      \n      const prevPosts = previousPeriodPosts?.total || 0;\n      if (prevPosts > 0) {\n        postsChange = ((currentPeriodViews - prevPosts) / prevPosts) * 100;\n      }\n\n      // Comments change\n      const prevComments = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM comments WHERE status = 'approved' AND created_at >= ? AND created_at < ?\"\n      ).bind(previousPeriodStart, periodStart).first();\n      \n      const currentComments = commentsInPeriod?.total || 0;\n      const previousComments = prevComments?.total || 0;\n      if (previousComments > 0) {\n        commentsChange = ((currentComments - previousComments) / previousComments) * 100;\n      }\n    }\n\n    // ========================================\n    // AUTOMATION STATS\n    // ========================================\n\n    let automationStats = {\n      totalPaths: 0,\n      activePaths: 0,\n      totalGenerated: 0,\n      scheduledPosts: 0\n    };\n\n    try {\n      const pathsCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total, SUM(CASE WHEN is_active = 1 THEN 1 ELSE 0 END) as active FROM automation_paths\"\n      ).first();\n\n      const scheduledCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM scheduled_posts WHERE status = 'pending'\"\n      ).first();\n\n      const generatedCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM ai_generation_logs WHERE status = 'completed'\"\n      ).first();\n\n      automationStats = {\n        totalPaths: pathsCount?.total || 0,\n        activePaths: pathsCount?.active || 0,\n        totalGenerated: generatedCount?.total || 0,\n        scheduledPosts: scheduledCount?.total || 0\n      };\n    } catch (e) {\n      // Tables might not exist\n    }\n\n    // ========================================\n    // MEDIA STATS\n    // ========================================\n\n    const mediaStats = await env.DB.prepare(`\n      SELECT COUNT(*) as total, SUM(file_size) as total_size\n      FROM media_library\n    `).first();\n\n    // ========================================\n    // BUILD RESPONSE\n    // ========================================\n\n    const dashboard = {\n      period,\n      generatedAt: new Date().toISOString(),\n      \n      overview: {\n        totalPosts: totalPosts?.total || 0,\n        postsInPeriod: postsInPeriod?.total || 0,\n        totalViews: totalViews?.total || 0,\n        totalComments: totalComments?.total || 0,\n        commentsInPeriod: commentsInPeriod?.total || 0,\n        totalShares: totalShares?.total || 0,\n        averageReadTime: Math.round((avgReadTime?.avg || 0) / 60)\n      },\n\n      trends: {\n        postsChange: Math.round(postsChange * 10) / 10,\n        viewsChange: Math.round(viewsChange * 10) / 10,\n        commentsChange: Math.round(commentsChange * 10) / 10\n      },\n\n      categories: categoryStats || [],\n      topPosts: topPosts || [],\n      recentPosts: recentPosts || [],\n\n      automation: automationStats,\n\n      media: {\n        totalFiles: mediaStats?.total || 0,\n        totalSize: mediaStats?.total_size || 0\n      }\n    };\n\n    // Cache in KV\n    if (env.KV) {\n      try {\n        await env.KV.put(`dashboard_stats_${period}`, JSON.stringify(dashboard), { expirationTtl: 300 });\n      } catch (e) {\n        // Ignore cache errors\n      }\n    }\n\n    return new Response(JSON.stringify(dashboard), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Subscribers Import/Export API\n * POST /api/subscribers/import - Import subscribers from CSV\n * GET /api/subscribers/import?export=true - Export subscribers to CSV\n */\n\n/**\n * GET - Export subscribers as CSV\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const status = url.searchParams.get('status'); // Filter by status\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT email, name, status, source, subscribed_at, country FROM email_subscribers\";\n    const params = [];\n\n    if (status) {\n      query += \" WHERE status = ?\";\n      params.push(status);\n    }\n\n    query += \" ORDER BY subscribed_at DESC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 ? await stmt.bind(...params).all() : await stmt.all();\n\n    // Generate CSV\n    const headers = ['email', 'name', 'status', 'source', 'subscribed_at', 'country'];\n    let csv = headers.join(',') + '\\n';\n\n    results.forEach(row => {\n      const values = headers.map(h => {\n        let val = row[h] || '';\n        if (h === 'subscribed_at' && val) {\n          val = new Date(val).toISOString();\n        }\n        // Escape commas and quotes\n        if (typeof val === 'string' && (val.includes(',') || val.includes('\"'))) {\n          val = '\"' + val.replace(/\"/g, '\"\"') + '\"';\n        }\n        return val;\n      });\n      csv += values.join(',') + '\\n';\n    });\n\n    return new Response(csv, {\n      headers: {\n        \"Content-Type\": \"text/csv\",\n        \"Content-Disposition\": `attachment; filename=\"subscribers_${new Date().toISOString().split('T')[0]}.csv\"`\n      }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST - Import subscribers from CSV\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const contentType = request.headers.get('content-type') || '';\n    let csvData;\n\n    if (contentType.includes('multipart/form-data')) {\n      const formData = await request.formData();\n      const file = formData.get('file');\n      if (!file) {\n        return new Response(JSON.stringify({ error: \"No file provided\" }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n      csvData = await file.text();\n    } else if (contentType.includes('text/csv') || contentType.includes('application/json')) {\n      const data = await request.json();\n      csvData = data.csv;\n    } else {\n      csvData = await request.text();\n    }\n\n    if (!csvData) {\n      return new Response(JSON.stringify({ error: \"No CSV data provided\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Parse CSV\n    const lines = csvData.split('\\n').filter(line => line.trim());\n    if (lines.length < 2) {\n      return new Response(JSON.stringify({ error: \"CSV must have header and at least one data row\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const headers = parseCSVLine(lines[0]).map(h => h.toLowerCase().trim());\n    const emailIndex = headers.indexOf('email');\n\n    if (emailIndex === -1) {\n      return new Response(JSON.stringify({ error: \"CSV must have an 'email' column\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const nameIndex = headers.indexOf('name');\n    const tagsIndex = headers.indexOf('tags');\n    const now = Date.now();\n\n    const results = {\n      total: 0,\n      imported: 0,\n      skipped: 0,\n      errors: []\n    };\n\n    // Process each line\n    for (let i = 1; i < lines.length; i++) {\n      results.total++;\n      const values = parseCSVLine(lines[i]);\n      const email = values[emailIndex]?.toLowerCase().trim();\n\n      if (!email) {\n        results.skipped++;\n        continue;\n      }\n\n      // Basic email validation\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(email)) {\n        results.errors.push({ line: i + 1, email, error: 'Invalid email format' });\n        results.skipped++;\n        continue;\n      }\n\n      try {\n        const id = `sub_${crypto.randomUUID().split('-')[0]}`;\n        const name = nameIndex !== -1 ? values[nameIndex]?.trim() || null : null;\n        const tags = tagsIndex !== -1 ? values[tagsIndex]?.trim() || null : null;\n\n        await env.DB.prepare(`\n          INSERT INTO email_subscribers (id, email, name, status, source, tags, subscribed_at, created_at, updated_at)\n          VALUES (?, ?, ?, 'active', 'import', ?, ?, ?, ?)\n          ON CONFLICT(email) DO UPDATE SET\n            name = COALESCE(excluded.name, email_subscribers.name),\n            tags = COALESCE(excluded.tags, email_subscribers.tags),\n            updated_at = excluded.updated_at\n        `).bind(id, email, name, tags ? JSON.stringify([tags]) : null, now, now, now).run();\n\n        results.imported++;\n      } catch (err) {\n        results.errors.push({ line: i + 1, email, error: err.message });\n        results.skipped++;\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      results\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Parse a CSV line handling quoted values\n */\nfunction parseCSVLine(line) {\n  const result = [];\n  let current = '';\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    \n    if (char === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        current += '\"';\n        i++;\n      } else {\n        inQuotes = !inQuotes;\n      }\n    } else if (char === ',' && !inQuotes) {\n      result.push(current);\n      current = '';\n    } else {\n      current += char;\n    }\n  }\n  \n  result.push(current);\n  return result;\n}\n", "/**\n * Email Popup Configuration API\n * GET /api/subscribers/popup-config - Get popup configuration\n * PUT /api/subscribers/popup-config - Update popup configuration\n */\n\n/**\n * GET - Get popup config\n */\nexport async function onRequestGet(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let config = await env.DB.prepare(\n      \"SELECT * FROM email_popup_config WHERE id = 'default'\"\n    ).first();\n\n    // If no config exists, create default\n    if (!config) {\n      const now = Date.now();\n      await env.DB.prepare(`\n        INSERT INTO email_popup_config (id, enabled, title, description, button_text, \n          placeholder_text, success_message, trigger_type, trigger_delay, \n          trigger_scroll_percent, show_once, show_every_days, updated_at)\n        VALUES ('default', 1, 'Subscribe to Our Newsletter', \n          'Get the latest food news and recipes delivered to your inbox!',\n          'Subscribe', 'Enter your email address', 'Thank you for subscribing!',\n          'time', 5, 50, 1, 7, ?)\n      `).bind(now).run();\n\n      config = await env.DB.prepare(\n        \"SELECT * FROM email_popup_config WHERE id = 'default'\"\n      ).first();\n    }\n\n    return new Response(JSON.stringify(config), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT - Update popup config\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Build update query\n    const updates = [];\n    const values = [];\n\n    const allowedFields = [\n      'enabled', 'title', 'description', 'button_text', 'placeholder_text',\n      'success_message', 'trigger_type', 'trigger_delay', 'trigger_scroll_percent',\n      'show_once', 'show_every_days', 'background_color', 'text_color',\n      'button_color', 'popup_image', 'custom_css'\n    ];\n\n    allowedFields.forEach(field => {\n      if (data[field] !== undefined) {\n        updates.push(`${field} = ?`);\n        // Convert boolean to integer for SQLite\n        if (field === 'enabled' || field === 'show_once') {\n          values.push(data[field] ? 1 : 0);\n        } else {\n          values.push(data[field]);\n        }\n      }\n    });\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n\n    await env.DB.prepare(`\n      UPDATE email_popup_config SET ${updates.join(', ')} WHERE id = 'default'\n    `).bind(...values).run();\n\n    // Fetch updated config\n    const config = await env.DB.prepare(\n      \"SELECT * FROM email_popup_config WHERE id = 'default'\"\n    ).first();\n\n    // Also store in KV for fast frontend access\n    if (env.KV) {\n      try {\n        await env.KV.put('email_popup_config', JSON.stringify(config));\n      } catch (e) {\n        console.error('KV cache error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, config }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Ticket Categories API\n * GET /api/tickets/categories - List ticket categories\n * POST /api/tickets/categories - Create new category (admin)\n */\n\n/**\n * GET - List categories\n */\nexport async function onRequestGet(context) {\n  const { env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const { results: categories } = await env.DB.prepare(`\n      SELECT * FROM ticket_categories \n      WHERE is_active = 1 \n      ORDER BY sort_order ASC, name ASC\n    `).all();\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { categories: categories || [] }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    // Table might not exist, return defaults\n    const defaultCategories = [\n      { id: 'general', name: 'General', color: '#478ac9', icon: 'question-circle' },\n      { id: 'technical', name: 'Technical', color: '#e74c3c', icon: 'bug' },\n      { id: 'billing', name: 'Billing', color: '#27ae60', icon: 'credit-card' },\n      { id: 'feature', name: 'Feature Request', color: '#9b59b6', icon: 'lightbulb' },\n      { id: 'feedback', name: 'Feedback', color: '#f39c12', icon: 'comment' }\n    ];\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { categories: defaultCategories }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST - Create category\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ success: false, error: \"Category name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const id = `cat_${data.name.toLowerCase().replace(/[^a-z0-9]/g, '_')}`;\n\n    await env.DB.prepare(`\n      INSERT INTO ticket_categories (id, name, description, color, icon, sort_order, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      id,\n      data.name,\n      data.description || '',\n      data.color || '#478ac9',\n      data.icon || 'tag',\n      data.sort_order || 99,\n      now,\n      now\n    ).run();\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { category: { id, name: data.name, color: data.color, icon: data.icon } }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    if (error.message?.includes('UNIQUE constraint')) {\n      return new Response(JSON.stringify({ success: false, error: \"Category already exists\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Category API\n * GET /api/categories/:id - Get a single category\n * PUT /api/categories/:id - Update a category\n * DELETE /api/categories/:id - Delete a category\n */\n\n/**\n * GET /api/categories/:id - Get a single category with subcategories\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const category = await env.DB.prepare(\n      \"SELECT * FROM categories WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!category) {\n      return new Response(JSON.stringify({ error: \"Category not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get subcategories\n    const { results: subcategories } = await env.DB.prepare(\n      \"SELECT * FROM subcategories WHERE parent_category_id = ? ORDER BY sort_order ASC\"\n    ).bind(id).all();\n\n    return new Response(JSON.stringify({\n      ...category,\n      subcategories\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/categories/:id - Update a category\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Build update query dynamically\n    const updates = [];\n    const values = [];\n\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n      // Update slug if name changes\n      if (!data.slug) {\n        updates.push('slug = ?');\n        values.push(data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, ''));\n      }\n    }\n    if (data.slug !== undefined) {\n      updates.push('slug = ?');\n      values.push(data.slug);\n    }\n    if (data.description !== undefined) {\n      updates.push('description = ?');\n      values.push(data.description);\n    }\n    if (data.color !== undefined) {\n      updates.push('color = ?');\n      values.push(data.color);\n    }\n    if (data.icon !== undefined) {\n      updates.push('icon = ?');\n      values.push(data.icon);\n    }\n    if (data.sort_order !== undefined) {\n      updates.push('sort_order = ?');\n      values.push(data.sort_order);\n    }\n    if (data.is_active !== undefined) {\n      updates.push('is_active = ?');\n      values.push(data.is_active ? 1 : 0);\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No valid fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE categories SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Fetch updated category\n    const category = await env.DB.prepare(\n      \"SELECT * FROM categories WHERE id = ?\"\n    ).bind(id).first();\n\n    // Clear KV cache if available\n    if (env.KV) {\n      try {\n        await env.KV.delete('categories_cache');\n      } catch (e) {\n        console.error('KV cache clear error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, category }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/categories/:id - Delete a category\n * Note: This will cascade delete subcategories and update related posts\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Check if category exists\n    const category = await env.DB.prepare(\n      \"SELECT * FROM categories WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!category) {\n      return new Response(JSON.stringify({ error: \"Category not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Update blog posts to remove category reference\n    await env.DB.prepare(\n      \"UPDATE blog_posts SET category = 'Uncategorized' WHERE category = ?\"\n    ).bind(category.name).run();\n\n    // Delete subcategories (cascade)\n    await env.DB.prepare(\n      \"DELETE FROM subcategories WHERE parent_category_id = ?\"\n    ).bind(id).run();\n\n    // Delete the category\n    await env.DB.prepare(\n      \"DELETE FROM categories WHERE id = ?\"\n    ).bind(id).run();\n\n    // Clear KV cache if available\n    if (env.KV) {\n      try {\n        await env.KV.delete('categories_cache');\n      } catch (e) {\n        console.error('KV cache clear error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Media API\n * GET /api/media/:id - Get media metadata\n * PUT /api/media/:id - Update media metadata\n * DELETE /api/media/:id - Delete media file from R2 and D1\n */\n\n/**\n * GET /api/media/:id - Get single media metadata\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const media = await env.DB.prepare(\n      \"SELECT * FROM media_library WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!media) {\n      return new Response(JSON.stringify({ error: \"Media not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify(media), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/media/:id - Update media metadata\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Only allow updating certain fields\n    const updates = [];\n    const values = [];\n\n    if (data.alt_text !== undefined) {\n      updates.push('alt_text = ?');\n      values.push(data.alt_text);\n    }\n    if (data.caption !== undefined) {\n      updates.push('caption = ?');\n      values.push(data.caption);\n    }\n    if (data.folder !== undefined) {\n      updates.push('folder = ?');\n      values.push(data.folder);\n    }\n    if (data.is_featured !== undefined) {\n      updates.push('is_featured = ?');\n      values.push(data.is_featured ? 1 : 0);\n    }\n    if (data.post_id !== undefined) {\n      updates.push('post_id = ?');\n      values.push(data.post_id);\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No valid fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE media_library SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Fetch updated record\n    const media = await env.DB.prepare(\n      \"SELECT * FROM media_library WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ success: true, media }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/media/:id - Delete media file from R2 and D1\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get media record to find R2 key\n    const media = await env.DB.prepare(\n      \"SELECT * FROM media_library WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!media) {\n      return new Response(JSON.stringify({ error: \"Media not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Delete from R2 if bucket is configured\n    if (env.MEDIA_BUCKET && media.r2_key) {\n      try {\n        await env.MEDIA_BUCKET.delete(media.r2_key);\n        // Also delete thumbnail if exists\n        if (media.thumbnail_key) {\n          await env.MEDIA_BUCKET.delete(media.thumbnail_key);\n        }\n      } catch (r2Error) {\n        console.error('R2 delete error:', r2Error);\n        // Continue with D1 deletion even if R2 fails\n      }\n    }\n\n    // Delete from D1\n    await env.DB.prepare(\n      \"DELETE FROM media_library WHERE id = ?\"\n    ).bind(id).run();\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Scheduled Post API\n * GET /api/scheduled-posts/:id - Get scheduled post details\n * PUT /api/scheduled-posts/:id - Update a scheduled post\n * DELETE /api/scheduled-posts/:id - Cancel/delete a scheduled post\n */\n\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const post = await env.DB.prepare(\n      \"SELECT * FROM scheduled_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!post) {\n      return new Response(JSON.stringify({ error: \"Scheduled post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get history\n    const { results: history } = await env.DB.prepare(\n      \"SELECT * FROM scheduled_post_history WHERE scheduled_post_id = ? ORDER BY created_at DESC\"\n    ).bind(id).all();\n\n    return new Response(JSON.stringify({\n      ...post,\n      tags: post.tags ? JSON.parse(post.tags) : [],\n      scheduled_date: new Date(post.scheduled_datetime).toISOString(),\n      is_featured: post.is_featured === 1,\n      history: history.map(h => ({\n        ...h,\n        event_data: h.event_data ? JSON.parse(h.event_data) : null\n      }))\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT - Update scheduled post (reschedule, edit content)\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Check if post exists and is not already published\n    const existing = await env.DB.prepare(\n      \"SELECT * FROM scheduled_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!existing) {\n      return new Response(JSON.stringify({ error: \"Scheduled post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (existing.status === 'published') {\n      return new Response(JSON.stringify({ error: \"Cannot update a published post\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Build update query\n    const updates = [];\n    const values = [];\n    const changes = {};\n\n    if (data.title !== undefined) {\n      updates.push('title = ?');\n      values.push(data.title);\n      changes.title = data.title;\n    }\n    if (data.content !== undefined) {\n      updates.push('content = ?');\n      values.push(data.content);\n    }\n    if (data.excerpt !== undefined) {\n      updates.push('excerpt = ?');\n      values.push(data.excerpt);\n    }\n    if (data.image_url !== undefined || data.imageUrl !== undefined) {\n      updates.push('image_url = ?');\n      values.push(data.image_url || data.imageUrl);\n    }\n    if (data.category !== undefined) {\n      updates.push('category = ?');\n      values.push(data.category);\n    }\n    if (data.subcategory !== undefined) {\n      updates.push('subcategory = ?');\n      values.push(data.subcategory);\n    }\n    if (data.tags !== undefined) {\n      updates.push('tags = ?');\n      values.push(JSON.stringify(data.tags || []));\n    }\n    if (data.scheduled_datetime !== undefined || data.scheduledDate !== undefined) {\n      const newDatetime = data.scheduled_datetime \n        ? (typeof data.scheduled_datetime === 'number' ? data.scheduled_datetime : new Date(data.scheduled_datetime).getTime())\n        : new Date(data.scheduledDate).getTime();\n      \n      if (newDatetime <= now) {\n        return new Response(JSON.stringify({ error: \"Cannot schedule in the past\" }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n      \n      updates.push('scheduled_datetime = ?');\n      values.push(newDatetime);\n      changes.rescheduled_to = new Date(newDatetime).toISOString();\n    }\n    if (data.is_featured !== undefined) {\n      updates.push('is_featured = ?');\n      values.push(data.is_featured ? 1 : 0);\n    }\n    if (data.status !== undefined && ['pending', 'cancelled'].includes(data.status)) {\n      updates.push('status = ?');\n      values.push(data.status);\n      changes.status = data.status;\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    if (updates.length === 1) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    await env.DB.prepare(`\n      UPDATE scheduled_posts SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Log the update\n    const eventType = changes.rescheduled_to ? 'rescheduled' : 'updated';\n    await env.DB.prepare(`\n      INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n      VALUES (?, ?, ?, ?, ?)\n    `).bind(\n      crypto.randomUUID(),\n      id,\n      eventType,\n      JSON.stringify(changes),\n      now\n    ).run();\n\n    // Fetch updated post\n    const updatedPost = await env.DB.prepare(\n      \"SELECT * FROM scheduled_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      post: {\n        ...updatedPost,\n        tags: updatedPost.tags ? JSON.parse(updatedPost.tags) : [],\n        scheduled_date: new Date(updatedPost.scheduled_datetime).toISOString(),\n        is_featured: updatedPost.is_featured === 1\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE - Cancel/delete a scheduled post\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Check if exists\n    const existing = await env.DB.prepare(\n      \"SELECT status FROM scheduled_posts WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!existing) {\n      return new Response(JSON.stringify({ error: \"Scheduled post not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // If already published, just mark as cancelled (keep for history)\n    if (existing.status === 'published') {\n      return new Response(JSON.stringify({ error: \"Cannot delete a published post\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n\n    // Log cancellation before delete\n    await env.DB.prepare(`\n      INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n      VALUES (?, ?, 'cancelled', ?, ?)\n    `).bind(\n      crypto.randomUUID(),\n      id,\n      JSON.stringify({ cancelled_at: new Date(now).toISOString() }),\n      now\n    ).run();\n\n    // Delete the post\n    await env.DB.prepare(\n      \"DELETE FROM scheduled_posts WHERE id = ?\"\n    ).bind(id).run();\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Subcategory API\n * GET /api/subcategories/:id - Get subcategory details\n * PUT /api/subcategories/:id - Update a subcategory  \n * DELETE /api/subcategories/:id - Delete a subcategory\n */\n\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const subcategory = await env.DB.prepare(\n      \"SELECT * FROM subcategories WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!subcategory) {\n      return new Response(JSON.stringify({ error: \"Subcategory not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify(subcategory), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    const updates = [];\n    const values = [];\n\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n      \n      // Auto-update slug\n      updates.push('slug = ?');\n      values.push(data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, ''));\n    }\n    if (data.parent_category_id !== undefined) {\n      updates.push('parent_category_id = ?');\n      values.push(data.parent_category_id);\n    }\n    if (data.description !== undefined) {\n      updates.push('description = ?');\n      values.push(data.description);\n    }\n    if (data.is_active !== undefined) {\n      updates.push('is_active = ?');\n      values.push(data.is_active ? 1 : 0);\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    if (updates.length === 1) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    await env.DB.prepare(`\n      UPDATE subcategories SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    const subcategory = await env.DB.prepare(\n      \"SELECT * FROM subcategories WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ success: true, subcategory }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get subcategory name for updating posts\n    const subcategory = await env.DB.prepare(\n      \"SELECT name FROM subcategories WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!subcategory) {\n      return new Response(JSON.stringify({ error: \"Subcategory not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Update blog posts that use this subcategory\n    await env.DB.prepare(\n      \"UPDATE blog_posts SET subcategory = NULL WHERE subcategory = ?\"\n    ).bind(subcategory.name).run();\n\n    // Delete the subcategory\n    const result = await env.DB.prepare(\n      \"DELETE FROM subcategories WHERE id = ?\"\n    ).bind(id).run();\n\n    if (result.meta.changes === 0) {\n      return new Response(JSON.stringify({ error: \"Subcategory not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Clear KV cache if available\n    if (env.KV) {\n      try {\n        await env.KV.delete('categories_cache');\n      } catch (e) {\n        console.error('KV delete error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Subscriber API\n * GET /api/subscribers/:id - Get subscriber details\n * PUT /api/subscribers/:id - Update subscriber\n * DELETE /api/subscribers/:id - Delete subscriber\n */\n\n/**\n * GET - Get subscriber details\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const subscriber = await env.DB.prepare(\n      \"SELECT * FROM email_subscribers WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!subscriber) {\n      return new Response(JSON.stringify({ error: \"Subscriber not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Parse JSON fields\n    subscriber.preferences = subscriber.preferences ? JSON.parse(subscriber.preferences) : {};\n    subscriber.tags = subscriber.tags ? JSON.parse(subscriber.tags) : [];\n    subscriber.custom_fields = subscriber.custom_fields ? JSON.parse(subscriber.custom_fields) : {};\n\n    // Get email activity\n    const { results: activity } = await env.DB.prepare(`\n      SELECT es.*, ec.name as campaign_name, ec.subject as campaign_subject\n      FROM email_sends es\n      LEFT JOIN email_campaigns ec ON es.campaign_id = ec.id\n      WHERE es.subscriber_id = ?\n      ORDER BY es.created_at DESC\n      LIMIT 10\n    `).bind(id).all();\n\n    return new Response(JSON.stringify({\n      subscriber,\n      activity: activity || []\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT - Update subscriber\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Build update query\n    const updates = [];\n    const values = [];\n\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n    }\n    if (data.status !== undefined) {\n      updates.push('status = ?');\n      values.push(data.status);\n      \n      // Track unsubscribe\n      if (data.status === 'unsubscribed') {\n        updates.push('unsubscribed_at = ?');\n        values.push(now);\n      }\n    }\n    if (data.preferences !== undefined) {\n      updates.push('preferences = ?');\n      values.push(JSON.stringify(data.preferences));\n    }\n    if (data.tags !== undefined) {\n      updates.push('tags = ?');\n      values.push(JSON.stringify(data.tags));\n    }\n    if (data.custom_fields !== undefined) {\n      updates.push('custom_fields = ?');\n      values.push(JSON.stringify(data.custom_fields));\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE email_subscribers SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Fetch updated subscriber\n    const subscriber = await env.DB.prepare(\n      \"SELECT * FROM email_subscribers WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ success: true, subscriber }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE - Delete subscriber\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Check if exists\n    const subscriber = await env.DB.prepare(\n      \"SELECT email FROM email_subscribers WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!subscriber) {\n      return new Response(JSON.stringify({ error: \"Subscriber not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Delete subscriber\n    await env.DB.prepare(\n      \"DELETE FROM email_subscribers WHERE id = ?\"\n    ).bind(id).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      id,\n      email: subscriber.email\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Tag API\n * GET /api/tags/:id - Get a single tag\n * PUT /api/tags/:id - Update a tag\n * DELETE /api/tags/:id - Delete a tag\n */\n\n/**\n * GET /api/tags/:id - Get a single tag\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const tag = await env.DB.prepare(\n      \"SELECT * FROM tags WHERE id = ?\"\n    ).bind(id).first();\n\n    if (!tag) {\n      return new Response(JSON.stringify({ error: \"Tag not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify(tag), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/tags/:id - Update a tag\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    const updates = [];\n    const values = [];\n\n    if (data.name !== undefined) {\n      updates.push('name = ?');\n      values.push(data.name);\n      if (!data.slug) {\n        updates.push('slug = ?');\n        values.push(data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, ''));\n      }\n    }\n    if (data.slug !== undefined) {\n      updates.push('slug = ?');\n      values.push(data.slug);\n    }\n    if (data.description !== undefined) {\n      updates.push('description = ?');\n      values.push(data.description);\n    }\n    if (data.color !== undefined) {\n      updates.push('color = ?');\n      values.push(data.color);\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No valid fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(id);\n\n    await env.DB.prepare(`\n      UPDATE tags SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    const tag = await env.DB.prepare(\n      \"SELECT * FROM tags WHERE id = ?\"\n    ).bind(id).first();\n\n    return new Response(JSON.stringify({ success: true, tag }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE /api/tags/:id - Delete a tag\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Delete tag associations first\n    await env.DB.prepare(\n      \"DELETE FROM post_tags WHERE tag_id = ?\"\n    ).bind(id).run();\n\n    // Delete the tag\n    const result = await env.DB.prepare(\n      \"DELETE FROM tags WHERE id = ?\"\n    ).bind(id).run();\n\n    if (result.meta.changes === 0) {\n      return new Response(JSON.stringify({ error: \"Tag not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ success: true, id }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Single Ticket API\n * GET /api/tickets/:id - Get ticket details with messages\n * PUT /api/tickets/:id - Update ticket (status, priority, assignee, etc.)\n * DELETE /api/tickets/:id - Delete ticket\n */\n\n/**\n * GET - Get ticket with messages\n */\nexport async function onRequestGet(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get ticket - support both ID and ticket_number\n    const ticket = await env.DB.prepare(`\n      SELECT * FROM support_tickets \n      WHERE id = ? OR ticket_number = ?\n    `).bind(id, id).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get messages\n    const { results: messages } = await env.DB.prepare(`\n      SELECT * FROM support_messages \n      WHERE ticket_id = ?\n      ORDER BY created_at ASC\n    `).bind(ticket.id).all();\n\n    // Get attachments\n    const { results: attachments } = await env.DB.prepare(`\n      SELECT * FROM ticket_attachments\n      WHERE ticket_id = ?\n      ORDER BY created_at ASC\n    `).bind(ticket.id).all();\n\n    // Parse JSON fields\n    ticket.tags = ticket.tags ? JSON.parse(ticket.tags) : [];\n    \n    messages.forEach(msg => {\n      msg.attachments = msg.attachments ? JSON.parse(msg.attachments) : [];\n    });\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        ticket,\n        messages,\n        attachments\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT - Update ticket\n */\nexport async function onRequestPut(context) {\n  const { request, env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Get existing ticket\n    const existing = await env.DB.prepare(\n      \"SELECT * FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(id, id).first();\n\n    if (!existing) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Build update query\n    const updates = [];\n    const values = [];\n\n    if (data.status !== undefined) {\n      updates.push('status = ?');\n      values.push(data.status);\n      \n      // Track status changes\n      if (data.status === 'resolved' && existing.status !== 'resolved') {\n        updates.push('resolved_at = ?');\n        values.push(now);\n      }\n      if (data.status === 'closed' && existing.status !== 'closed') {\n        updates.push('closed_at = ?');\n        values.push(now);\n      }\n      if (data.status === 'open' && existing.status === 'closed') {\n        updates.push('reopened_count = reopened_count + 1');\n      }\n    }\n\n    if (data.priority !== undefined) {\n      updates.push('priority = ?');\n      values.push(data.priority);\n    }\n\n    if (data.category !== undefined) {\n      updates.push('category = ?');\n      values.push(data.category);\n    }\n\n    if (data.assignee_id !== undefined) {\n      updates.push('assignee_id = ?');\n      values.push(data.assignee_id);\n    }\n\n    if (data.assignee_name !== undefined) {\n      updates.push('assignee_name = ?');\n      values.push(data.assignee_name);\n    }\n\n    if (data.tags !== undefined) {\n      updates.push('tags = ?');\n      values.push(JSON.stringify(data.tags));\n    }\n\n    if (data.internal_notes !== undefined) {\n      updates.push('internal_notes = ?');\n      values.push(data.internal_notes);\n    }\n\n    if (data.resolution !== undefined) {\n      updates.push('resolution = ?');\n      values.push(data.resolution);\n    }\n\n    if (data.satisfaction_rating !== undefined) {\n      updates.push('satisfaction_rating = ?');\n      values.push(data.satisfaction_rating);\n    }\n\n    if (data.satisfaction_feedback !== undefined) {\n      updates.push('satisfaction_feedback = ?');\n      values.push(data.satisfaction_feedback);\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ success: false, error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push(existing.id);\n\n    await env.DB.prepare(`\n      UPDATE support_tickets SET ${updates.join(', ')} WHERE id = ?\n    `).bind(...values).run();\n\n    // Fetch updated ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT * FROM support_tickets WHERE id = ?\"\n    ).bind(existing.id).first();\n\n    ticket.tags = ticket.tags ? JSON.parse(ticket.tags) : [];\n\n    // Invalidate KV cache\n    if (env.KV) {\n      try {\n        await env.KV.delete(`ticket_${existing.ticket_number}`);\n      } catch (e) {}\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: { ticket }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * DELETE - Delete ticket\n */\nexport async function onRequestDelete(context) {\n  const { env, params } = context;\n  const id = params.id;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get ticket\n    const ticket = await env.DB.prepare(\n      \"SELECT * FROM support_tickets WHERE id = ? OR ticket_number = ?\"\n    ).bind(id, id).first();\n\n    if (!ticket) {\n      return new Response(JSON.stringify({ success: false, error: \"Ticket not found\" }), {\n        status: 404,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Delete attachments from R2 if configured\n    if (env.MEDIA_BUCKET) {\n      const { results: attachments } = await env.DB.prepare(\n        \"SELECT r2_key FROM ticket_attachments WHERE ticket_id = ?\"\n      ).bind(ticket.id).all();\n\n      for (const att of attachments) {\n        try {\n          await env.MEDIA_BUCKET.delete(att.r2_key);\n        } catch (e) {\n          console.error('Error deleting attachment:', e);\n        }\n      }\n    }\n\n    // Delete ticket (cascades to messages and attachments)\n    await env.DB.prepare(\n      \"DELETE FROM support_tickets WHERE id = ?\"\n    ).bind(ticket.id).run();\n\n    // Invalidate KV cache\n    if (env.KV) {\n      try {\n        await env.KV.delete(`ticket_${ticket.ticket_number}`);\n      } catch (e) {}\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: `Ticket #${ticket.ticket_number} deleted`\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Categories API\n * GET /api/categories - List all categories\n * POST /api/categories - Create a new category\n * \n * Shared with: Create Post, Manage Posts, AI Automation\n */\n\n/**\n * GET /api/categories - List all categories with subcategories\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const includeSubcategories = url.searchParams.get('include_subcategories') !== 'false';\n  const activeOnly = url.searchParams.get('active_only') !== 'false';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get categories\n    let categoryQuery = \"SELECT * FROM categories\";\n    if (activeOnly) {\n      categoryQuery += \" WHERE is_active = 1\";\n    }\n    categoryQuery += \" ORDER BY sort_order ASC, name ASC\";\n    \n    const { results: categories } = await env.DB.prepare(categoryQuery).all();\n\n    // If including subcategories, fetch them too\n    if (includeSubcategories && categories.length > 0) {\n      let subQuery = \"SELECT * FROM subcategories\";\n      if (activeOnly) {\n        subQuery += \" WHERE is_active = 1\";\n      }\n      subQuery += \" ORDER BY sort_order ASC, name ASC\";\n      \n      const { results: subcategories } = await env.DB.prepare(subQuery).all();\n\n      // Group subcategories by parent category\n      const categoriesWithSubs = categories.map(cat => ({\n        ...cat,\n        subcategories: subcategories.filter(sub => sub.parent_category_id === cat.id)\n      }));\n\n      return new Response(JSON.stringify(categoriesWithSubs), {\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify(categories), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/categories - Create a new category\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Category name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = `cat_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n    const slug = data.slug || data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');\n\n    // Check if slug already exists\n    const existing = await env.DB.prepare(\n      \"SELECT id FROM categories WHERE slug = ?\"\n    ).bind(slug).first();\n\n    if (existing) {\n      return new Response(JSON.stringify({ error: \"A category with this slug already exists\" }), {\n        status: 409,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get max sort_order\n    const maxOrder = await env.DB.prepare(\n      \"SELECT MAX(sort_order) as max_order FROM categories\"\n    ).first();\n\n    const category = {\n      id,\n      name: data.name,\n      slug,\n      description: data.description || '',\n      color: data.color || '#478ac9',\n      icon: data.icon || null,\n      post_count: 0,\n      sort_order: (maxOrder?.max_order || 0) + 1,\n      is_active: data.is_active !== false ? 1 : 0,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO categories (\n        id, name, slug, description, color, icon, post_count,\n        sort_order, is_active, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      category.id, category.name, category.slug, category.description,\n      category.color, category.icon, category.post_count, category.sort_order,\n      category.is_active, category.created_at, category.updated_at\n    ).run();\n\n    // Cache in KV if available\n    if (env.KV) {\n      try {\n        await env.KV.delete('categories_cache');\n      } catch (e) {\n        console.error('KV cache clear error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, category }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * AI Chatbot Main API\n * POST /api/chatbot - Send a message to the chatbot and get response\n * GET /api/chatbot - Get chatbot status and configuration\n * \n * This is the main endpoint for the chatbot widget on the frontend\n */\n\n/**\n * GET /api/chatbot - Get chatbot status and public configuration\n */\nexport async function onRequestGet(context) {\n  const { env } = context;\n\n  try {\n    let settings = {};\n    let assistants = [];\n\n    if (env.DB) {\n      // Get settings\n      const { results: settingsRows } = await env.DB.prepare(\n        \"SELECT key, value, type FROM chatbot_settings\"\n      ).all();\n\n      settingsRows?.forEach(row => {\n        let value = row.value;\n        if (row.type === 'boolean') value = row.value === 'true';\n        else if (row.type === 'number') value = parseInt(row.value);\n        else if (row.type === 'json') {\n          try { value = JSON.parse(row.value); } catch (e) { }\n        }\n        settings[row.key] = value;\n      });\n\n      // Get active assistants\n      const { results: assistantRows } = await env.DB.prepare(\n        \"SELECT id, name, description, type FROM ai_assistants WHERE is_active = 1\"\n      ).all();\n      assistants = assistantRows || [];\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      enabled: settings.enabled !== false,\n      config: {\n        chatbotName: settings.chatbot_name || 'Fooodis Assistant',\n        welcomeMessage: settings.welcome_message || 'Hello! How can I help you today?',\n        position: settings.widget_position || 'bottom-right',\n        color: settings.widget_color || '#e8f24c',\n        languages: settings.supported_languages || ['en', 'sv'],\n        enableRating: settings.enable_rating !== false,\n        enableLeadCapture: settings.enable_lead_capture !== false\n      },\n      assistants\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: true, enabled: true, config: {} }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/chatbot - Send message and get AI response\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  try {\n    const data = await request.json();\n    const { message, conversationId, visitorId, assistantId, language } = data;\n\n    if (!message) {\n      return new Response(JSON.stringify({ success: false, error: \"Message is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    let convId = conversationId;\n    let threadId = data.threadId;\n\n    // Get or create conversation\n    if (env.DB) {\n      if (!convId) {\n        // Create new conversation\n        convId = `conv_${crypto.randomUUID().split('-')[0]}`;\n        await env.DB.prepare(`\n          INSERT INTO chatbot_conversations (\n            id, visitor_id, assistant_id, language, status, \n            first_message_at, last_message_at, message_count, created_at, updated_at\n          ) VALUES (?, ?, ?, ?, 'active', ?, ?, 1, ?, ?)\n        `).bind(\n          convId, visitorId || null, assistantId || null, \n          language || 'en', now, now, now, now\n        ).run();\n      } else {\n        // Update existing conversation\n        await env.DB.prepare(`\n          UPDATE chatbot_conversations \n          SET message_count = message_count + 1, last_message_at = ?, updated_at = ?\n          WHERE id = ?\n        `).bind(now, now, convId).run();\n      }\n\n      // Store user message\n      await env.DB.prepare(`\n        INSERT INTO chatbot_messages (id, conversation_id, role, content, created_at)\n        VALUES (?, ?, 'user', ?, ?)\n      `).bind(`msg_${crypto.randomUUID().split('-')[0]}`, convId, message, now).run();\n    }\n\n    // Get OpenAI API key\n    let apiKey = null;\n    if (env.KV) {\n      apiKey = await env.KV.get('OPENAI_API_KEY');\n    }\n    if (!apiKey && env.OPENAI_API_KEY) {\n      apiKey = env.OPENAI_API_KEY;\n    }\n\n    // Get assistant configuration\n    let assistant = null;\n    let systemPrompt = 'You are a helpful assistant for Fooodis, a food delivery and restaurant management platform. Help users with their questions about food, restaurants, and the platform.';\n    \n    if (env.DB && assistantId) {\n      assistant = await env.DB.prepare(\n        \"SELECT * FROM ai_assistants WHERE id = ? OR openai_assistant_id = ?\"\n      ).bind(assistantId, assistantId).first();\n      \n      if (assistant?.instructions) {\n        systemPrompt = assistant.instructions;\n      }\n    }\n\n    // Call OpenAI API\n    let aiResponse = \"I'm here to help! However, I'm currently unable to process your request. Please try again later.\";\n    let tokensUsed = 0;\n    const startTime = Date.now();\n\n    if (apiKey) {\n      try {\n        // If we have an OpenAI assistant ID, use the Assistants API\n        if (assistant?.openai_assistant_id) {\n          const response = await callOpenAIAssistant(apiKey, assistant.openai_assistant_id, message, threadId);\n          aiResponse = response.message;\n          threadId = response.threadId;\n          tokensUsed = response.tokens || 0;\n        } else {\n          // Use Chat Completions API\n          const response = await callOpenAIChatCompletion(apiKey, systemPrompt, message, assistant?.model || 'gpt-4');\n          aiResponse = response.message;\n          tokensUsed = response.tokens || 0;\n        }\n      } catch (error) {\n        console.error('OpenAI API error:', error);\n        aiResponse = getErrorResponse(language);\n      }\n    }\n\n    const responseTime = Date.now() - startTime;\n\n    // Store AI response in database\n    if (env.DB) {\n      await env.DB.prepare(`\n        INSERT INTO chatbot_messages (\n          id, conversation_id, role, content, assistant_id, assistant_name, \n          tokens_used, response_time_ms, created_at\n        ) VALUES (?, ?, 'assistant', ?, ?, ?, ?, ?, ?)\n      `).bind(\n        `msg_${crypto.randomUUID().split('-')[0]}`,\n        convId,\n        aiResponse,\n        assistantId || null,\n        assistant?.name || 'Fooodis Assistant',\n        tokensUsed,\n        responseTime,\n        Date.now()\n      ).run();\n\n      // Update conversation with thread_id\n      if (threadId) {\n        await env.DB.prepare(\n          \"UPDATE chatbot_conversations SET thread_id = ? WHERE id = ?\"\n        ).bind(threadId, convId).run();\n      }\n\n      // Update daily analytics\n      await updateDailyAnalytics(env.DB, tokensUsed);\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      conversationId: convId,\n      threadId,\n      message: aiResponse,\n      tokensUsed,\n      responseTimeMs: responseTime\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Call OpenAI Chat Completion API\n */\nasync function callOpenAIChatCompletion(apiKey, systemPrompt, userMessage, model) {\n  const response = await fetch('https://api.openai.com/v1/chat/completions', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${apiKey}`\n    },\n    body: JSON.stringify({\n      model: model || 'gpt-4',\n      messages: [\n        { role: 'system', content: systemPrompt },\n        { role: 'user', content: userMessage }\n      ],\n      max_tokens: 1000,\n      temperature: 0.7\n    })\n  });\n\n  if (!response.ok) {\n    throw new Error(`OpenAI API error: ${response.status}`);\n  }\n\n  const data = await response.json();\n  return {\n    message: data.choices[0]?.message?.content || 'No response generated.',\n    tokens: data.usage?.total_tokens || 0\n  };\n}\n\n/**\n * Call OpenAI Assistants API\n */\nasync function callOpenAIAssistant(apiKey, assistantId, userMessage, existingThreadId) {\n  const headers = {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${apiKey}`,\n    'OpenAI-Beta': 'assistants=v2'\n  };\n\n  // Create or reuse thread\n  let threadId = existingThreadId;\n  if (!threadId) {\n    const threadResponse = await fetch('https://api.openai.com/v1/threads', {\n      method: 'POST',\n      headers\n    });\n    const threadData = await threadResponse.json();\n    threadId = threadData.id;\n  }\n\n  // Add message to thread\n  await fetch(`https://api.openai.com/v1/threads/${threadId}/messages`, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify({ role: 'user', content: userMessage })\n  });\n\n  // Run assistant\n  const runResponse = await fetch(`https://api.openai.com/v1/threads/${threadId}/runs`, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify({ assistant_id: assistantId })\n  });\n  const runData = await runResponse.json();\n\n  // Poll for completion\n  let run = runData;\n  let attempts = 0;\n  while (run.status !== 'completed' && run.status !== 'failed' && attempts < 30) {\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const statusResponse = await fetch(`https://api.openai.com/v1/threads/${threadId}/runs/${run.id}`, { headers });\n    run = await statusResponse.json();\n    attempts++;\n  }\n\n  if (run.status !== 'completed') {\n    throw new Error('Assistant run did not complete');\n  }\n\n  // Get messages\n  const messagesResponse = await fetch(`https://api.openai.com/v1/threads/${threadId}/messages?limit=1`, { headers });\n  const messagesData = await messagesResponse.json();\n  const assistantMessage = messagesData.data[0]?.content[0]?.text?.value || 'No response generated.';\n\n  return {\n    message: assistantMessage,\n    threadId,\n    tokens: run.usage?.total_tokens || 0\n  };\n}\n\n/**\n * Update daily analytics\n */\nasync function updateDailyAnalytics(db, tokensUsed) {\n  const today = new Date().toISOString().split('T')[0];\n  \n  try {\n    await db.prepare(`\n      INSERT INTO chatbot_analytics (id, date, total_messages, total_tokens_used, created_at, updated_at)\n      VALUES (?, ?, 1, ?, ?, ?)\n      ON CONFLICT(date) DO UPDATE SET \n        total_messages = total_messages + 1,\n        total_tokens_used = total_tokens_used + ?,\n        updated_at = ?\n    `).bind(\n      `analytics_${today}`, today, tokensUsed, Date.now(), Date.now(),\n      tokensUsed, Date.now()\n    ).run();\n  } catch (e) {\n    console.error('Analytics update error:', e);\n  }\n}\n\n/**\n * Get localized error response\n */\nfunction getErrorResponse(language) {\n  const errors = {\n    en: \"I apologize, but I'm having trouble processing your request right now. Please try again in a moment.\",\n    sv: \"Jag ber om urs\u00E4kt, men jag har problem med att behandla din f\u00F6rfr\u00E5gan just nu. V\u00E4nligen f\u00F6rs\u00F6k igen om en stund.\"\n  };\n  return errors[language] || errors.en;\n}\n", "/**\n * Support Customers API\n * GET /api/customers - List customers (admin only)\n * POST /api/customers - Register a new customer\n */\n\n/**\n * GET /api/customers - List customers\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status');\n  const search = url.searchParams.get('search');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT id, email, name, phone, company, status, email_verified, last_login, total_tickets, created_at FROM support_customers\";\n    const conditions = [];\n    const params = [];\n\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n\n    if (search) {\n      conditions.push(\"(email LIKE ? OR name LIKE ? OR company LIKE ?)\");\n      params.push(`%${search}%`, `%${search}%`, `%${search}%`);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n\n    query += \" ORDER BY created_at DESC LIMIT ? OFFSET ?\";\n    params.push(limit, offset);\n\n    const { results: customers } = await env.DB.prepare(query).bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM support_customers\";\n    if (conditions.length > 0) {\n      countQuery += \" WHERE \" + conditions.join(\" AND \");\n    }\n    const countParams = params.slice(0, -2);\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = countParams.length > 0 \n      ? await countStmt.bind(...countParams).first()\n      : await countStmt.first();\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        customers,\n        pagination: {\n          total: countResult?.total || 0,\n          limit,\n          offset\n        }\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/customers - Register new customer\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    // Validation\n    if (!data.email) {\n      return new Response(JSON.stringify({ success: false, error: \"Email is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const email = data.email.toLowerCase().trim();\n    \n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return new Response(JSON.stringify({ success: false, error: \"Invalid email format\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Check if customer exists\n    const existing = await env.DB.prepare(\n      \"SELECT id, email, name FROM support_customers WHERE email = ?\"\n    ).bind(email).first();\n\n    if (existing) {\n      return new Response(JSON.stringify({ \n        success: true,\n        message: \"Customer already exists\",\n        existing: true,\n        data: {\n          customer: {\n            id: existing.id,\n            email: existing.email,\n            name: existing.name\n          }\n        }\n      }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Validate password if provided\n    if (data.password && data.password.length < 6) {\n      return new Response(JSON.stringify({ success: false, error: \"Password must be at least 6 characters\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const customerId = `cust_${crypto.randomUUID().split('-')[0]}`;\n    \n    // Hash password if provided\n    let passwordHash = null;\n    if (data.password) {\n      passwordHash = await hashPassword(data.password);\n    }\n\n    // Generate verification token\n    const verificationToken = crypto.randomUUID();\n\n    const customer = {\n      id: customerId,\n      email,\n      name: data.name || email.split('@')[0],\n      phone: data.phone || null,\n      company: data.company || null,\n      password_hash: passwordHash,\n      status: 'active',\n      email_verified: 0,\n      verification_token: verificationToken,\n      preferences: data.preferences ? JSON.stringify(data.preferences) : null,\n      metadata: data.metadata ? JSON.stringify(data.metadata) : null,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO support_customers (\n        id, email, name, phone, company, password_hash, status,\n        email_verified, verification_token, preferences, metadata,\n        created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      customer.id, customer.email, customer.name, customer.phone,\n      customer.company, customer.password_hash, customer.status,\n      customer.email_verified, customer.verification_token,\n      customer.preferences, customer.metadata, customer.created_at,\n      customer.updated_at\n    ).run();\n\n    // Generate token for immediate login\n    const authToken = await generateToken(customerId, email);\n\n    // Store token in KV for validation\n    if (env.KV) {\n      try {\n        await env.KV.put(`auth_${authToken}`, JSON.stringify({\n          customer_id: customerId,\n          email,\n          created_at: now\n        }), { expirationTtl: 86400 * 7 }); // 7 days\n      } catch (e) {\n        console.error('KV error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: \"Registration successful\",\n      data: {\n        customer: {\n          id: customerId,\n          email: customer.email,\n          name: customer.name\n        },\n        token: authToken\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    // Handle duplicate email\n    if (error.message?.includes('UNIQUE constraint')) {\n      return new Response(JSON.stringify({ success: false, error: \"Email already registered\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Hash password\n */\nasync function hashPassword(password) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(password + 'fooodis_support_salt_2024');\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Generate auth token\n */\nasync function generateToken(customerId, email) {\n  const data = `${customerId}:${email}:${Date.now()}:${crypto.randomUUID()}`;\n  const encoder = new TextEncoder();\n  const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(data));\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n", "/**\n * Media Library API\n * GET /api/media - List all media files\n * POST /api/media - Upload a new media file to R2\n */\n\nconst ALLOWED_MIME_TYPES = [\n  'image/jpeg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n  'image/svg+xml',\n  'video/mp4',\n  'video/webm',\n  'application/pdf'\n];\n\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n\n/**\n * GET /api/media - List all media files from D1\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const folder = url.searchParams.get('folder') || null;\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM media_library\";\n    let params = [];\n    \n    if (folder) {\n      query += \" WHERE folder = ?\";\n      params.push(folder);\n    }\n    \n    query += \" ORDER BY created_at DESC LIMIT ? OFFSET ?\";\n    params.push(limit, offset);\n\n    const stmt = env.DB.prepare(query);\n    const { results } = await stmt.bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM media_library\";\n    if (folder) {\n      countQuery += \" WHERE folder = ?\";\n    }\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = folder \n      ? await countStmt.bind(folder).first()\n      : await countStmt.first();\n\n    return new Response(JSON.stringify({\n      media: results,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset,\n        hasMore: (offset + results.length) < (countResult?.total || 0)\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/media - Upload a new media file to R2\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  if (!env.MEDIA_BUCKET) {\n    return new Response(JSON.stringify({ error: \"R2 bucket not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const contentType = request.headers.get('content-type') || '';\n    \n    // Handle multipart form data\n    if (contentType.includes('multipart/form-data')) {\n      const formData = await request.formData();\n      const file = formData.get('file');\n      const folder = formData.get('folder') || 'uploads';\n      const altText = formData.get('alt_text') || '';\n      const caption = formData.get('caption') || '';\n      const postId = formData.get('post_id') || null;\n\n      if (!file || !(file instanceof File)) {\n        return new Response(JSON.stringify({ error: \"No file provided\" }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n\n      // Validate file type\n      if (!ALLOWED_MIME_TYPES.includes(file.type)) {\n        return new Response(JSON.stringify({ \n          error: \"File type not allowed\",\n          allowed: ALLOWED_MIME_TYPES \n        }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n\n      // Validate file size\n      if (file.size > MAX_FILE_SIZE) {\n        return new Response(JSON.stringify({ \n          error: \"File too large\",\n          maxSize: MAX_FILE_SIZE \n        }), {\n          status: 400,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n\n      // Generate unique filename\n      const id = crypto.randomUUID();\n      const ext = file.name.split('.').pop() || 'bin';\n      const timestamp = Date.now();\n      const r2Key = `${folder}/${timestamp}-${id}.${ext}`;\n\n      // Upload to R2\n      const fileBuffer = await file.arrayBuffer();\n      await env.MEDIA_BUCKET.put(r2Key, fileBuffer, {\n        httpMetadata: {\n          contentType: file.type,\n        },\n        customMetadata: {\n          originalFilename: file.name,\n          uploadedAt: new Date().toISOString()\n        }\n      });\n\n      // Get R2 public URL (you'll need to configure public access for your bucket)\n      // For now, we'll construct a relative URL that your app can serve\n      const r2Url = `/api/media/serve/${encodeURIComponent(r2Key)}`;\n\n      // Get image dimensions if it's an image\n      let width = null;\n      let height = null;\n      // Note: For actual dimension detection, you'd need a library like sharp\n      // For now, we'll leave these null and let the frontend handle it\n\n      // Store metadata in D1\n      const now = Date.now();\n      await env.DB.prepare(`\n        INSERT INTO media_library (\n          id, filename, original_filename, mime_type, file_size,\n          width, height, r2_key, r2_url, alt_text, caption, folder,\n          post_id, created_at, updated_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `).bind(\n        id,\n        `${timestamp}-${id}.${ext}`,\n        file.name,\n        file.type,\n        file.size,\n        width,\n        height,\n        r2Key,\n        r2Url,\n        altText,\n        caption,\n        folder,\n        postId,\n        now,\n        now\n      ).run();\n\n      return new Response(JSON.stringify({\n        success: true,\n        media: {\n          id,\n          filename: `${timestamp}-${id}.${ext}`,\n          original_filename: file.name,\n          mime_type: file.type,\n          file_size: file.size,\n          r2_key: r2Key,\n          r2_url: r2Url,\n          url: r2Url,  // Alias for convenience\n          alt_text: altText,\n          caption,\n          folder\n        }\n      }), {\n        status: 201,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n\n    } else {\n      return new Response(JSON.stringify({ error: \"Content-Type must be multipart/form-data\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n  } catch (error) {\n    console.error('Media upload error:', error);\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Profile Management API\n * GET /api/profile - Get current user profile\n * PUT /api/profile - Update profile information\n * \n * For a single-admin blog system without full authentication\n */\n\n/**\n * GET /api/profile - Get profile data\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Get the admin profile (user_id = 'admin' for single-user system)\n    let profile = await env.DB.prepare(\n      \"SELECT * FROM user_profiles WHERE user_id = 'admin'\"\n    ).first();\n\n    // If no profile exists, create default\n    if (!profile) {\n      const now = Date.now();\n      const defaultProfile = {\n        user_id: 'admin',\n        display_name: 'Admin User',\n        email: 'admin@fooodis.com',\n        role: 'Administrator',\n        bio: '',\n        avatar_url: null,\n        social_links: JSON.stringify({}),\n        preferences: JSON.stringify({\n          theme: 'dark',\n          notifications: true,\n          language: 'en'\n        }),\n        created_at: now,\n        updated_at: now\n      };\n\n      await env.DB.prepare(`\n        INSERT INTO user_profiles (\n          user_id, display_name, email, role, bio, avatar_url, \n          social_links, preferences, created_at, updated_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `).bind(\n        defaultProfile.user_id,\n        defaultProfile.display_name,\n        defaultProfile.email,\n        defaultProfile.role,\n        defaultProfile.bio,\n        defaultProfile.avatar_url,\n        defaultProfile.social_links,\n        defaultProfile.preferences,\n        defaultProfile.created_at,\n        defaultProfile.updated_at\n      ).run();\n\n      profile = defaultProfile;\n    }\n\n    // Parse JSON fields\n    const formattedProfile = {\n      ...profile,\n      social_links: profile.social_links ? JSON.parse(profile.social_links) : {},\n      preferences: profile.preferences ? JSON.parse(profile.preferences) : {}\n    };\n\n    return new Response(JSON.stringify(formattedProfile), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/profile - Update profile information\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n\n    // Build update query\n    const updates = [];\n    const values = [];\n\n    if (data.display_name !== undefined) {\n      updates.push('display_name = ?');\n      values.push(data.display_name);\n    }\n    if (data.email !== undefined) {\n      updates.push('email = ?');\n      values.push(data.email);\n    }\n    if (data.role !== undefined) {\n      updates.push('role = ?');\n      values.push(data.role);\n    }\n    if (data.bio !== undefined) {\n      updates.push('bio = ?');\n      values.push(data.bio);\n    }\n    if (data.avatar_url !== undefined) {\n      updates.push('avatar_url = ?');\n      values.push(data.avatar_url);\n    }\n    if (data.social_links !== undefined) {\n      updates.push('social_links = ?');\n      values.push(JSON.stringify(data.social_links));\n    }\n    if (data.preferences !== undefined) {\n      updates.push('preferences = ?');\n      values.push(JSON.stringify(data.preferences));\n    }\n\n    if (updates.length === 0) {\n      return new Response(JSON.stringify({ error: \"No fields to update\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    updates.push('updated_at = ?');\n    values.push(now);\n    values.push('admin'); // user_id\n\n    await env.DB.prepare(`\n      UPDATE user_profiles SET ${updates.join(', ')} WHERE user_id = ?\n    `).bind(...values).run();\n\n    // Fetch updated profile\n    const profile = await env.DB.prepare(\n      \"SELECT * FROM user_profiles WHERE user_id = 'admin'\"\n    ).first();\n\n    // Also update author name in blog_posts if display_name changed\n    if (data.display_name) {\n      await env.DB.prepare(\n        \"UPDATE blog_posts SET author = ? WHERE author = 'Admin' OR author = 'Admin User'\"\n      ).bind(data.display_name).run();\n    }\n\n    return new Response(JSON.stringify({ \n      success: true, \n      profile: {\n        ...profile,\n        social_links: profile.social_links ? JSON.parse(profile.social_links) : {},\n        preferences: profile.preferences ? JSON.parse(profile.preferences) : {}\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Scheduled Posts API\n * GET /api/scheduled-posts - List scheduled posts with filtering\n * POST /api/scheduled-posts - Create a new scheduled post\n * \n * Integrates with:\n * - AI Content Automation (source = 'ai_automation')\n * - Create New Blog Post (source = 'manual')\n * - Manage Blog Posts (view scheduled status)\n */\n\n/**\n * GET /api/scheduled-posts\n * Query params: status, source, from_date, to_date, automation_path_id, limit, offset\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status');\n  const source = url.searchParams.get('source');\n  const fromDate = url.searchParams.get('from_date');\n  const toDate = url.searchParams.get('to_date');\n  const automationPathId = url.searchParams.get('automation_path_id');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n  const includePublished = url.searchParams.get('include_published') === 'true';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM scheduled_posts\";\n    let countQuery = \"SELECT COUNT(*) as total FROM scheduled_posts\";\n    const conditions = [];\n    const params = [];\n\n    // Default: only show pending posts unless explicitly including published\n    if (!includePublished) {\n      conditions.push(\"status IN ('pending', 'publishing', 'failed')\");\n    }\n\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n    if (source) {\n      conditions.push(\"source = ?\");\n      params.push(source);\n    }\n    if (automationPathId) {\n      conditions.push(\"automation_path_id = ?\");\n      params.push(automationPathId);\n    }\n    if (fromDate) {\n      conditions.push(\"scheduled_datetime >= ?\");\n      params.push(new Date(fromDate).getTime());\n    }\n    if (toDate) {\n      conditions.push(\"scheduled_datetime <= ?\");\n      params.push(new Date(toDate).getTime());\n    }\n\n    if (conditions.length > 0) {\n      const whereClause = \" WHERE \" + conditions.join(\" AND \");\n      query += whereClause;\n      countQuery += whereClause;\n    }\n\n    query += \" ORDER BY scheduled_datetime ASC\";\n    query += ` LIMIT ${limit} OFFSET ${offset}`;\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = params.length > 0\n      ? await countStmt.bind(...params).first()\n      : await countStmt.first();\n\n    // Parse JSON fields and format dates\n    const posts = results.map(post => ({\n      ...post,\n      tags: post.tags ? JSON.parse(post.tags) : [],\n      scheduled_date: new Date(post.scheduled_datetime).toISOString(),\n      is_featured: post.is_featured === 1\n    }));\n\n    // Group by date for calendar view\n    const groupedByDate = {};\n    posts.forEach(post => {\n      const dateKey = new Date(post.scheduled_datetime).toISOString().split('T')[0];\n      if (!groupedByDate[dateKey]) {\n        groupedByDate[dateKey] = [];\n      }\n      groupedByDate[dateKey].push(post);\n    });\n\n    return new Response(JSON.stringify({\n      posts,\n      grouped: groupedByDate,\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset,\n        hasMore: (offset + posts.length) < (countResult?.total || 0)\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/scheduled-posts - Create a new scheduled post\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    // Validate required fields\n    if (!data.title) {\n      return new Response(JSON.stringify({ error: \"Title is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (!data.scheduled_datetime && !data.scheduledDate) {\n      return new Response(JSON.stringify({ error: \"Scheduled date/time is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = crypto.randomUUID();\n    const now = Date.now();\n\n    // Parse scheduled datetime\n    let scheduledDatetime;\n    if (data.scheduled_datetime) {\n      scheduledDatetime = typeof data.scheduled_datetime === 'number' \n        ? data.scheduled_datetime \n        : new Date(data.scheduled_datetime).getTime();\n    } else if (data.scheduledDate) {\n      scheduledDatetime = new Date(data.scheduledDate).getTime();\n    }\n\n    // Validate not in the past\n    if (scheduledDatetime <= now) {\n      return new Response(JSON.stringify({ error: \"Cannot schedule in the past\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const post = {\n      id,\n      title: data.title,\n      content: data.content || '',\n      excerpt: data.excerpt || '',\n      image_url: data.image_url || data.imageUrl || '',\n      category: data.category || 'Uncategorized',\n      subcategory: data.subcategory || null,\n      tags: JSON.stringify(data.tags || []),\n      author: data.author || 'Admin',\n      slug: data.slug || data.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, ''),\n      scheduled_datetime: scheduledDatetime,\n      timezone: data.timezone || 'UTC',\n      source: data.source || 'manual',\n      automation_path_id: data.automation_path_id || data.automationPathId || null,\n      automation_path_name: data.automation_path_name || data.automationPathName || null,\n      generation_log_id: data.generation_log_id || data.generationLogId || null,\n      status: 'pending',\n      is_featured: data.is_featured || data.featured ? 1 : 0,\n      priority: data.priority || 0,\n      notify_on_publish: data.notify_on_publish ? 1 : 0,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO scheduled_posts (\n        id, title, content, excerpt, image_url, category, subcategory, tags, author, slug,\n        scheduled_datetime, timezone, source, automation_path_id, automation_path_name,\n        generation_log_id, status, is_featured, priority, notify_on_publish, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      post.id, post.title, post.content, post.excerpt, post.image_url, post.category,\n      post.subcategory, post.tags, post.author, post.slug, post.scheduled_datetime,\n      post.timezone, post.source, post.automation_path_id, post.automation_path_name,\n      post.generation_log_id, post.status, post.is_featured, post.priority,\n      post.notify_on_publish, post.created_at, post.updated_at\n    ).run();\n\n    // Log the creation event\n    await env.DB.prepare(`\n      INSERT INTO scheduled_post_history (id, scheduled_post_id, event_type, event_data, created_at)\n      VALUES (?, ?, 'created', ?, ?)\n    `).bind(\n      crypto.randomUUID(),\n      post.id,\n      JSON.stringify({ source: post.source, scheduled_for: new Date(scheduledDatetime).toISOString() }),\n      now\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      post: {\n        ...post,\n        tags: JSON.parse(post.tags),\n        scheduled_date: new Date(scheduledDatetime).toISOString(),\n        is_featured: post.is_featured === 1\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Blog Settings API\n * GET /api/settings - Get all settings\n * PUT /api/settings - Update multiple settings\n * \n * Uses KV for fast access with D1 as persistent backup\n * Shared with: Create Post, Blog Frontend, Dashboard\n */\n\nconst KV_SETTINGS_KEY = 'blog_settings';\nconst KV_CACHE_TTL = 3600; // 1 hour in seconds\n\n/**\n * GET /api/settings - Get all blog settings\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const key = url.searchParams.get('key'); // Optional: get specific setting\n\n  // Try KV first for fast access\n  if (env.KV) {\n    try {\n      const cached = await env.KV.get(KV_SETTINGS_KEY, 'json');\n      if (cached) {\n        if (key) {\n          const setting = cached.find(s => s.key === key);\n          return new Response(JSON.stringify(setting || { error: \"Setting not found\" }), {\n            status: setting ? 200 : 404,\n            headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"HIT\" }\n          });\n        }\n        return new Response(JSON.stringify(cached), {\n          headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"HIT\" }\n        });\n      }\n    } catch (e) {\n      console.error('KV read error:', e);\n    }\n  }\n\n  // Fallback to D1\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM blog_settings\";\n    if (key) {\n      query += \" WHERE key = ?\";\n    }\n    query += \" ORDER BY key ASC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = key ? await stmt.bind(key).all() : await stmt.all();\n\n    // Parse values based on type\n    const settings = results.map(setting => ({\n      ...setting,\n      value: parseSettingValue(setting.value, setting.type)\n    }));\n\n    // Cache in KV if available\n    if (env.KV && !key) {\n      try {\n        await env.KV.put(KV_SETTINGS_KEY, JSON.stringify(settings), {\n          expirationTtl: KV_CACHE_TTL\n        });\n      } catch (e) {\n        console.error('KV write error:', e);\n      }\n    }\n\n    if (key) {\n      const setting = settings[0];\n      return new Response(JSON.stringify(setting || { error: \"Setting not found\" }), {\n        status: setting ? 200 : 404,\n        headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"MISS\" }\n      });\n    }\n\n    return new Response(JSON.stringify(settings), {\n      headers: { \"Content-Type\": \"application/json\", \"X-Cache\": \"MISS\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * PUT /api/settings - Update settings\n * Body can be: { key: \"setting_key\", value: \"new_value\" }\n * Or: { settings: [{ key: \"key1\", value: \"val1\" }, ...] }\n */\nexport async function onRequestPut(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const now = Date.now();\n    const updates = [];\n\n    // Handle single setting update\n    if (data.key && data.value !== undefined) {\n      updates.push({ key: data.key, value: data.value, type: data.type });\n    }\n    // Handle bulk settings update\n    else if (data.settings && Array.isArray(data.settings)) {\n      updates.push(...data.settings);\n    } else {\n      return new Response(JSON.stringify({ error: \"Invalid request format\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    for (const setting of updates) {\n      if (!setting.key) continue;\n\n      // Determine the type if not provided\n      let type = setting.type;\n      if (!type) {\n        if (typeof setting.value === 'boolean') type = 'boolean';\n        else if (typeof setting.value === 'number') type = 'number';\n        else if (typeof setting.value === 'object') type = 'json';\n        else type = 'string';\n      }\n\n      // Convert value to string for storage\n      const valueStr = type === 'json' \n        ? JSON.stringify(setting.value)\n        : String(setting.value);\n\n      // Upsert setting\n      await env.DB.prepare(`\n        INSERT INTO blog_settings (key, value, type, updated_at)\n        VALUES (?, ?, ?, ?)\n        ON CONFLICT(key) DO UPDATE SET\n          value = excluded.value,\n          type = excluded.type,\n          updated_at = excluded.updated_at\n      `).bind(setting.key, valueStr, type, now).run();\n    }\n\n    // Clear KV cache\n    if (env.KV) {\n      try {\n        await env.KV.delete(KV_SETTINGS_KEY);\n      } catch (e) {\n        console.error('KV delete error:', e);\n      }\n    }\n\n    // Fetch and return updated settings\n    const { results } = await env.DB.prepare(\n      \"SELECT * FROM blog_settings ORDER BY key ASC\"\n    ).all();\n\n    const settings = results.map(s => ({\n      ...s,\n      value: parseSettingValue(s.value, s.type)\n    }));\n\n    // Re-cache in KV\n    if (env.KV) {\n      try {\n        await env.KV.put(KV_SETTINGS_KEY, JSON.stringify(settings), {\n          expirationTtl: KV_CACHE_TTL\n        });\n      } catch (e) {\n        console.error('KV write error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, settings }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/settings - Same as PUT for convenience\n */\nexport async function onRequestPost(context) {\n  return onRequestPut(context);\n}\n\n/**\n * Parse setting value based on type\n */\nfunction parseSettingValue(value, type) {\n  switch (type) {\n    case 'boolean':\n      return value === 'true' || value === '1' || value === true;\n    case 'number':\n      return Number(value);\n    case 'json':\n      try {\n        return JSON.parse(value);\n      } catch {\n        return value;\n      }\n    default:\n      return value;\n  }\n}\n", "/**\n * Blog Statistics API\n * GET /api/stats - Get aggregate blog statistics\n * POST /api/stats - Record a page view or event\n * \n * Integrates with:\n * - Blog Statistics dashboard\n * - Individual post views\n * - AI Automation metrics\n * - All dashboard sections\n */\n\n/**\n * GET /api/stats - Get aggregate statistics\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const period = url.searchParams.get('period') || '30d'; // 7d, 30d, 90d, all\n  const type = url.searchParams.get('type') || 'overview'; // overview, posts, categories, trends\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const now = Date.now();\n    let startTime = 0;\n\n    // Calculate period start time\n    switch (period) {\n      case '7d':\n        startTime = now - (7 * 24 * 60 * 60 * 1000);\n        break;\n      case '30d':\n        startTime = now - (30 * 24 * 60 * 60 * 1000);\n        break;\n      case '90d':\n        startTime = now - (90 * 24 * 60 * 60 * 1000);\n        break;\n      default:\n        startTime = 0;\n    }\n\n    let stats = {};\n\n    if (type === 'overview' || type === 'all') {\n      // Get total posts count\n      const postsCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM blog_posts WHERE status = 'published'\"\n      ).first();\n\n      // Get total views from post_stats\n      const viewsTotal = await env.DB.prepare(\n        \"SELECT SUM(views) as total, SUM(unique_views) as unique_total FROM post_stats\"\n      ).first();\n\n      // Get total comments\n      const commentsCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM comments WHERE status = 'approved'\"\n      ).first();\n\n      // Get total shares\n      const sharesTotal = await env.DB.prepare(\n        \"SELECT SUM(shares_total) as total FROM post_stats\"\n      ).first();\n\n      // Get categories count\n      const categoriesCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM categories WHERE is_active = 1\"\n      ).first();\n\n      // Get tags count\n      const tagsCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM tags\"\n      ).first();\n\n      // Get scheduled posts count\n      const scheduledCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM scheduled_posts WHERE status = 'pending'\"\n      ).first();\n\n      // Get media count\n      const mediaCount = await env.DB.prepare(\n        \"SELECT COUNT(*) as total FROM media_library\"\n      ).first();\n\n      // Calculate average read time\n      const avgReadTime = await env.DB.prepare(\n        \"SELECT AVG(avg_read_time) as average FROM post_stats WHERE avg_read_time > 0\"\n      ).first();\n\n      stats.overview = {\n        totalPosts: postsCount?.total || 0,\n        totalViews: viewsTotal?.total || 0,\n        uniqueViews: viewsTotal?.unique_total || 0,\n        totalComments: commentsCount?.total || 0,\n        totalShares: sharesTotal?.total || 0,\n        totalCategories: categoriesCount?.total || 0,\n        totalTags: tagsCount?.total || 0,\n        scheduledPosts: scheduledCount?.total || 0,\n        mediaFiles: mediaCount?.total || 0,\n        averageReadTime: Math.round((avgReadTime?.average || 0) / 60) // Convert to minutes\n      };\n    }\n\n    if (type === 'posts' || type === 'all') {\n      // Get top performing posts\n      const { results: topPosts } = await env.DB.prepare(`\n        SELECT p.id, p.title, p.category, p.published_date, \n               ps.views, ps.unique_views, ps.shares_total\n        FROM blog_posts p\n        LEFT JOIN post_stats ps ON p.id = ps.post_id\n        WHERE p.status = 'published'\n        ORDER BY ps.views DESC\n        LIMIT 10\n      `).all();\n\n      // Get recent posts performance\n      const { results: recentPosts } = await env.DB.prepare(`\n        SELECT p.id, p.title, p.category, p.published_date,\n               ps.views, ps.unique_views, ps.shares_total\n        FROM blog_posts p\n        LEFT JOIN post_stats ps ON p.id = ps.post_id\n        WHERE p.status = 'published'\n        ORDER BY p.created_at DESC\n        LIMIT 10\n      `).all();\n\n      stats.posts = {\n        topPosts: topPosts || [],\n        recentPosts: recentPosts || []\n      };\n    }\n\n    if (type === 'categories' || type === 'all') {\n      // Get category statistics\n      const { results: categoryStats } = await env.DB.prepare(`\n        SELECT c.name, c.post_count, c.color,\n               SUM(ps.views) as total_views,\n               SUM(ps.shares_total) as total_shares\n        FROM categories c\n        LEFT JOIN blog_posts p ON c.name = p.category\n        LEFT JOIN post_stats ps ON p.id = ps.post_id\n        WHERE c.is_active = 1\n        GROUP BY c.id, c.name\n        ORDER BY total_views DESC\n      `).all();\n\n      stats.categories = categoryStats || [];\n    }\n\n    if (type === 'trends' || type === 'all') {\n      // Get daily views for the period (from page_views if exists)\n      let dailyViews = [];\n      try {\n        const { results } = await env.DB.prepare(`\n          SELECT DATE(created_at / 1000, 'unixepoch') as date,\n                 COUNT(*) as views,\n                 COUNT(DISTINCT visitor_id) as unique_views\n          FROM page_views\n          WHERE created_at >= ?\n          GROUP BY date\n          ORDER BY date ASC\n        `).bind(startTime).all();\n        dailyViews = results || [];\n      } catch (e) {\n        // Table might not exist\n        dailyViews = [];\n      }\n\n      // Calculate trends (compare current vs previous period)\n      const previousStart = startTime - (now - startTime);\n      \n      let currentViews = 0, previousViews = 0;\n      try {\n        const current = await env.DB.prepare(\n          \"SELECT SUM(views) as total FROM page_views WHERE created_at >= ?\"\n        ).bind(startTime).first();\n        currentViews = current?.total || 0;\n\n        const previous = await env.DB.prepare(\n          \"SELECT SUM(views) as total FROM page_views WHERE created_at >= ? AND created_at < ?\"\n        ).bind(previousStart, startTime).first();\n        previousViews = previous?.total || 0;\n      } catch (e) {\n        // Use post_stats as fallback\n      }\n\n      const viewsChange = previousViews > 0 \n        ? ((currentViews - previousViews) / previousViews) * 100 \n        : 0;\n\n      stats.trends = {\n        dailyViews,\n        viewsChange: Math.round(viewsChange * 10) / 10,\n        period\n      };\n    }\n\n    // Cache result in KV if available\n    if (env.KV) {\n      try {\n        await env.KV.put(`stats_${type}_${period}`, JSON.stringify(stats), { expirationTtl: 300 });\n      } catch (e) {\n        console.error('KV cache error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify(stats), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/stats - Record a page view or event\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n    const { type, post_id, event_data } = data;\n\n    const now = Date.now();\n    \n    // Get visitor identifier (from header or generate)\n    const visitorId = request.headers.get('X-Visitor-ID') || \n                      request.headers.get('CF-Connecting-IP') ||\n                      crypto.randomUUID();\n\n    switch (type) {\n      case 'page_view':\n        // Record page view\n        try {\n          await env.DB.prepare(`\n            INSERT INTO page_views (id, post_id, visitor_id, page_url, referrer, user_agent, created_at)\n            VALUES (?, ?, ?, ?, ?, ?, ?)\n          `).bind(\n            crypto.randomUUID(),\n            post_id || null,\n            visitorId,\n            data.page_url || '',\n            data.referrer || '',\n            request.headers.get('User-Agent') || '',\n            now\n          ).run();\n        } catch (e) {\n          // Table might not exist, just update post_stats\n        }\n\n        // Update post_stats if post_id is provided\n        if (post_id) {\n          await env.DB.prepare(`\n            INSERT INTO post_stats (id, post_id, views, unique_views, updated_at)\n            VALUES (?, ?, 1, 1, ?)\n            ON CONFLICT(post_id) DO UPDATE SET \n              views = views + 1,\n              updated_at = ?\n          `).bind(\n            `stats_${post_id}`,\n            post_id,\n            now,\n            now\n          ).run();\n        }\n        break;\n\n      case 'share':\n        // Record share event\n        const platform = data.platform || 'other';\n        const shareColumn = `shares_${platform}`;\n        \n        if (post_id) {\n          // Update share count\n          await env.DB.prepare(`\n            UPDATE post_stats SET \n              ${shareColumn} = ${shareColumn} + 1,\n              shares_total = shares_total + 1,\n              updated_at = ?\n            WHERE post_id = ?\n          `).bind(now, post_id).run();\n        }\n        break;\n\n      case 'read_time':\n        // Update average read time\n        if (post_id && data.read_time) {\n          await env.DB.prepare(`\n            UPDATE post_stats SET \n              avg_read_time = (avg_read_time + ?) / 2,\n              updated_at = ?\n            WHERE post_id = ?\n          `).bind(data.read_time, now, post_id).run();\n        }\n        break;\n\n      case 'event':\n        // Record generic event\n        try {\n          await env.DB.prepare(`\n            INSERT INTO analytics_events (id, event_type, event_data, visitor_id, created_at)\n            VALUES (?, ?, ?, ?, ?)\n          `).bind(\n            crypto.randomUUID(),\n            data.event_type || 'unknown',\n            JSON.stringify(event_data || {}),\n            visitorId,\n            now\n          ).run();\n        } catch (e) {\n          // Table might not exist\n        }\n        break;\n    }\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Subcategories API\n * GET /api/subcategories - List all subcategories (optionally filter by parent)\n * POST /api/subcategories - Create a new subcategory\n */\n\n/**\n * GET /api/subcategories - List subcategories\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const parentId = url.searchParams.get('parent_id');\n  const parentName = url.searchParams.get('parent_name');\n  const activeOnly = url.searchParams.get('active_only') !== 'false';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT s.*, c.name as parent_name FROM subcategories s LEFT JOIN categories c ON s.parent_category_id = c.id\";\n    const conditions = [];\n    const params = [];\n\n    if (parentId) {\n      conditions.push(\"s.parent_category_id = ?\");\n      params.push(parentId);\n    }\n    if (parentName) {\n      conditions.push(\"c.name = ?\");\n      params.push(parentName);\n    }\n    if (activeOnly) {\n      conditions.push(\"s.is_active = 1\");\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n    query += \" ORDER BY s.sort_order ASC, s.name ASC\";\n\n    const stmt = env.DB.prepare(query);\n    const { results } = params.length > 0 \n      ? await stmt.bind(...params).all()\n      : await stmt.all();\n\n    return new Response(JSON.stringify(results), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/subcategories - Create a new subcategory\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Subcategory name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (!data.parent_category_id && !data.parent_name) {\n      return new Response(JSON.stringify({ error: \"Parent category is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // If parent_name is provided instead of parent_category_id, look it up\n    let parentCategoryId = data.parent_category_id;\n    if (!parentCategoryId && data.parent_name) {\n      const parent = await env.DB.prepare(\n        \"SELECT id FROM categories WHERE name = ?\"\n      ).bind(data.parent_name).first();\n\n      if (!parent) {\n        return new Response(JSON.stringify({ error: \"Parent category not found\" }), {\n          status: 404,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n      parentCategoryId = parent.id;\n    }\n\n    const id = `subcat_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n    const slug = data.slug || data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');\n\n    // Check if slug already exists under the same parent\n    const existing = await env.DB.prepare(\n      \"SELECT id FROM subcategories WHERE slug = ? AND parent_category_id = ?\"\n    ).bind(slug, parentCategoryId).first();\n\n    if (existing) {\n      return new Response(JSON.stringify({ error: \"A subcategory with this slug already exists under this parent\" }), {\n        status: 409,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Get max sort_order for this parent\n    const maxOrder = await env.DB.prepare(\n      \"SELECT MAX(sort_order) as max_order FROM subcategories WHERE parent_category_id = ?\"\n    ).bind(parentCategoryId).first();\n\n    const subcategory = {\n      id,\n      name: data.name,\n      slug,\n      parent_category_id: parentCategoryId,\n      description: data.description || '',\n      post_count: 0,\n      sort_order: (maxOrder?.max_order || 0) + 1,\n      is_active: data.is_active !== false ? 1 : 0,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO subcategories (\n        id, name, slug, parent_category_id, description,\n        post_count, sort_order, is_active, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      subcategory.id, subcategory.name, subcategory.slug, subcategory.parent_category_id,\n      subcategory.description, subcategory.post_count, subcategory.sort_order,\n      subcategory.is_active, subcategory.created_at, subcategory.updated_at\n    ).run();\n\n    return new Response(JSON.stringify({ success: true, subcategory }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Email Subscribers API\n * GET /api/subscribers - List all subscribers with filtering/pagination\n * POST /api/subscribers - Add a new subscriber (from popup or manual)\n * \n * Integrates with:\n * - Email Subscribers dashboard section\n * - Email popup on blog frontend\n * - Email Marketing campaigns\n */\n\n/**\n * GET /api/subscribers - List subscribers\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  const status = url.searchParams.get('status'); // active, unsubscribed, bounced\n  const source = url.searchParams.get('source'); // popup, import, manual, api\n  const search = url.searchParams.get('search');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n  const sortBy = url.searchParams.get('sort') || 'subscribed_at';\n  const sortOrder = url.searchParams.get('order') || 'DESC';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Build query\n    let query = \"SELECT * FROM email_subscribers\";\n    const conditions = [];\n    const params = [];\n\n    if (status) {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n\n    if (source) {\n      conditions.push(\"source = ?\");\n      params.push(source);\n    }\n\n    if (search) {\n      conditions.push(\"(email LIKE ? OR name LIKE ?)\");\n      params.push(`%${search}%`, `%${search}%`);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n\n    // Validate sort column\n    const allowedSorts = ['email', 'name', 'status', 'source', 'subscribed_at', 'created_at'];\n    const safeSort = allowedSorts.includes(sortBy) ? sortBy : 'subscribed_at';\n    const safeOrder = sortOrder.toUpperCase() === 'ASC' ? 'ASC' : 'DESC';\n    \n    query += ` ORDER BY ${safeSort} ${safeOrder} LIMIT ? OFFSET ?`;\n    params.push(limit, offset);\n\n    const { results } = await env.DB.prepare(query).bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM email_subscribers\";\n    if (conditions.length > 0) {\n      countQuery += \" WHERE \" + conditions.join(\" AND \");\n    }\n    \n    const countParams = params.slice(0, -2); // Remove limit and offset\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = countParams.length > 0 \n      ? await countStmt.bind(...countParams).first()\n      : await countStmt.first();\n\n    // Get stats\n    const statsResult = await env.DB.prepare(`\n      SELECT \n        COUNT(*) as total,\n        SUM(CASE WHEN status = 'active' THEN 1 ELSE 0 END) as active,\n        SUM(CASE WHEN status = 'unsubscribed' THEN 1 ELSE 0 END) as unsubscribed,\n        SUM(CASE WHEN status = 'bounced' THEN 1 ELSE 0 END) as bounced\n      FROM email_subscribers\n    `).first();\n\n    return new Response(JSON.stringify({\n      subscribers: results || [],\n      pagination: {\n        total: countResult?.total || 0,\n        limit,\n        offset,\n        hasMore: (offset + results.length) < (countResult?.total || 0)\n      },\n      stats: {\n        total: statsResult?.total || 0,\n        active: statsResult?.active || 0,\n        unsubscribed: statsResult?.unsubscribed || 0,\n        bounced: statsResult?.bounced || 0\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/subscribers - Add new subscriber\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    // Validate email\n    if (!data.email) {\n      return new Response(JSON.stringify({ error: \"Email is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const email = data.email.toLowerCase().trim();\n    \n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return new Response(JSON.stringify({ error: \"Invalid email format\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    // Check if already subscribed\n    const existing = await env.DB.prepare(\n      \"SELECT id, status FROM email_subscribers WHERE email = ?\"\n    ).bind(email).first();\n\n    if (existing) {\n      if (existing.status === 'active') {\n        return new Response(JSON.stringify({ \n          success: true, \n          message: \"Already subscribed\",\n          existing: true,\n          subscriber_id: existing.id\n        }), {\n          status: 200,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      } else {\n        // Reactivate unsubscribed user\n        const now = Date.now();\n        await env.DB.prepare(`\n          UPDATE email_subscribers \n          SET status = 'active', subscribed_at = ?, updated_at = ?\n          WHERE id = ?\n        `).bind(now, now, existing.id).run();\n\n        return new Response(JSON.stringify({ \n          success: true, \n          message: \"Subscription reactivated\",\n          reactivated: true,\n          subscriber_id: existing.id\n        }), {\n          status: 200,\n          headers: { \"Content-Type\": \"application/json\" }\n        });\n      }\n    }\n\n    // Create new subscriber\n    const id = `sub_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n    \n    // Get IP from headers\n    const ip = request.headers.get('CF-Connecting-IP') || \n               request.headers.get('X-Forwarded-For')?.split(',')[0] || \n               null;\n\n    const subscriber = {\n      id,\n      email,\n      name: data.name || null,\n      status: 'active',\n      source: data.source || 'popup',\n      ip_address: ip,\n      country: request.cf?.country || null,\n      subscribed_at: now,\n      preferences: data.preferences ? JSON.stringify(data.preferences) : null,\n      tags: data.tags ? JSON.stringify(data.tags) : null,\n      custom_fields: data.custom_fields ? JSON.stringify(data.custom_fields) : null,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO email_subscribers (\n        id, email, name, status, source, ip_address, country,\n        subscribed_at, preferences, tags, custom_fields, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      subscriber.id, subscriber.email, subscriber.name, subscriber.status,\n      subscriber.source, subscriber.ip_address, subscriber.country,\n      subscriber.subscribed_at, subscriber.preferences, subscriber.tags,\n      subscriber.custom_fields, subscriber.created_at, subscriber.updated_at\n    ).run();\n\n    return new Response(JSON.stringify({ \n      success: true, \n      message: \"Successfully subscribed\",\n      subscriber: {\n        id: subscriber.id,\n        email: subscriber.email,\n        name: subscriber.name\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    // Handle duplicate email error\n    if (error.message?.includes('UNIQUE constraint')) {\n      return new Response(JSON.stringify({ \n        success: true, \n        message: \"Already subscribed\",\n        existing: true\n      }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Tags API\n * GET /api/tags - List all tags\n * POST /api/tags - Create a new tag\n * \n * Shared with: Create Post, Manage Posts, Blog Frontend\n */\n\n/**\n * GET /api/tags - List all tags\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  const sortBy = url.searchParams.get('sort') || 'name'; // 'name', 'count', 'recent'\n  const limit = parseInt(url.searchParams.get('limit')) || 100;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    let query = \"SELECT * FROM tags\";\n    \n    switch (sortBy) {\n      case 'count':\n        query += \" ORDER BY post_count DESC, name ASC\";\n        break;\n      case 'recent':\n        query += \" ORDER BY created_at DESC\";\n        break;\n      default:\n        query += \" ORDER BY name ASC\";\n    }\n    \n    query += ` LIMIT ${limit}`;\n\n    const { results } = await env.DB.prepare(query).all();\n\n    return new Response(JSON.stringify(results), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/tags - Create a new tag (or return existing)\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.name) {\n      return new Response(JSON.stringify({ error: \"Tag name is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const slug = data.slug || data.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');\n\n    // Check if tag already exists\n    const existing = await env.DB.prepare(\n      \"SELECT * FROM tags WHERE slug = ? OR name = ?\"\n    ).bind(slug, data.name).first();\n\n    if (existing) {\n      // Return existing tag instead of error (idempotent operation)\n      return new Response(JSON.stringify({ \n        success: true, \n        tag: existing,\n        existing: true \n      }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const id = `tag_${crypto.randomUUID().split('-')[0]}`;\n    const now = Date.now();\n\n    const tag = {\n      id,\n      name: data.name,\n      slug,\n      description: data.description || '',\n      color: data.color || '#e8f24c',\n      post_count: 0,\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO tags (\n        id, name, slug, description, color, post_count, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      tag.id, tag.name, tag.slug, tag.description,\n      tag.color, tag.post_count, tag.created_at, tag.updated_at\n    ).run();\n\n    return new Response(JSON.stringify({ success: true, tag }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Handle bulk tag operations\n * POST /api/tags/bulk - Create multiple tags at once\n */\nexport async function onRequestPatch(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    if (!data.tags || !Array.isArray(data.tags)) {\n      return new Response(JSON.stringify({ error: \"Tags array is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const results = [];\n    const now = Date.now();\n\n    for (const tagName of data.tags) {\n      if (!tagName || typeof tagName !== 'string') continue;\n\n      const name = tagName.trim();\n      if (!name) continue;\n\n      const slug = name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');\n\n      // Check if exists\n      const existing = await env.DB.prepare(\n        \"SELECT * FROM tags WHERE slug = ?\"\n      ).bind(slug).first();\n\n      if (existing) {\n        results.push({ ...existing, existing: true });\n      } else {\n        const id = `tag_${crypto.randomUUID().split('-')[0]}`;\n        const tag = {\n          id,\n          name,\n          slug,\n          description: '',\n          color: '#e8f24c',\n          post_count: 0,\n          created_at: now,\n          updated_at: now\n        };\n\n        await env.DB.prepare(`\n          INSERT INTO tags (id, name, slug, description, color, post_count, created_at, updated_at)\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n        `).bind(tag.id, tag.name, tag.slug, tag.description, tag.color, tag.post_count, tag.created_at, tag.updated_at).run();\n\n        results.push(tag);\n      }\n    }\n\n    return new Response(JSON.stringify({ success: true, tags: results }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n", "/**\n * Support Tickets API\n * GET /api/tickets - List tickets (with filtering for admin/customer)\n * POST /api/tickets - Create a new ticket\n * \n * Supports both admin dashboard and customer support portal\n */\n\n/**\n * GET /api/tickets - List tickets\n */\nexport async function onRequestGet(context) {\n  const { env, request } = context;\n  const url = new URL(request.url);\n  \n  // Query parameters\n  const customer = url.searchParams.get('customer'); // Filter by customer email\n  const customerId = url.searchParams.get('customer_id');\n  const status = url.searchParams.get('status');\n  const priority = url.searchParams.get('priority');\n  const category = url.searchParams.get('category');\n  const assignee = url.searchParams.get('assignee');\n  const search = url.searchParams.get('search');\n  const limit = parseInt(url.searchParams.get('limit')) || 50;\n  const offset = parseInt(url.searchParams.get('offset')) || 0;\n  const sortBy = url.searchParams.get('sort') || 'created_at';\n  const sortOrder = url.searchParams.get('order') || 'DESC';\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    // Build query\n    let query = \"SELECT * FROM support_tickets\";\n    const conditions = [];\n    const params = [];\n\n    // Filter by customer email (for customer portal)\n    if (customer) {\n      conditions.push(\"customer_email = ?\");\n      params.push(customer.toLowerCase());\n    }\n\n    // Filter by customer ID\n    if (customerId) {\n      conditions.push(\"customer_id = ?\");\n      params.push(customerId);\n    }\n\n    // Filter by status\n    if (status && status !== 'all') {\n      conditions.push(\"status = ?\");\n      params.push(status);\n    }\n\n    // Filter by priority\n    if (priority && priority !== 'all') {\n      conditions.push(\"priority = ?\");\n      params.push(priority);\n    }\n\n    // Filter by category\n    if (category && category !== 'all') {\n      conditions.push(\"category = ?\");\n      params.push(category);\n    }\n\n    // Filter by assignee\n    if (assignee) {\n      conditions.push(\"assignee_id = ?\");\n      params.push(assignee);\n    }\n\n    // Search\n    if (search) {\n      conditions.push(\"(subject LIKE ? OR description LIKE ? OR customer_name LIKE ? OR ticket_number LIKE ?)\");\n      const searchTerm = `%${search}%`;\n      params.push(searchTerm, searchTerm, searchTerm, searchTerm);\n    }\n\n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n\n    // Validate sort column\n    const allowedSorts = ['created_at', 'updated_at', 'priority', 'status', 'ticket_number'];\n    const safeSort = allowedSorts.includes(sortBy) ? sortBy : 'created_at';\n    const safeOrder = sortOrder.toUpperCase() === 'ASC' ? 'ASC' : 'DESC';\n\n    query += ` ORDER BY ${safeSort} ${safeOrder} LIMIT ? OFFSET ?`;\n    params.push(limit, offset);\n\n    const { results: tickets } = await env.DB.prepare(query).bind(...params).all();\n\n    // Get total count\n    let countQuery = \"SELECT COUNT(*) as total FROM support_tickets\";\n    if (conditions.length > 0) {\n      countQuery += \" WHERE \" + conditions.join(\" AND \");\n    }\n    const countParams = params.slice(0, -2);\n    const countStmt = env.DB.prepare(countQuery);\n    const countResult = countParams.length > 0 \n      ? await countStmt.bind(...countParams).first()\n      : await countStmt.first();\n\n    // Get stats\n    const stats = await getTicketStats(env.DB, customer);\n\n    // Parse tags for each ticket\n    const formattedTickets = tickets.map(t => ({\n      ...t,\n      tags: t.tags ? JSON.parse(t.tags) : []\n    }));\n\n    return new Response(JSON.stringify({\n      success: true,\n      data: {\n        tickets: formattedTickets,\n        pagination: {\n          total: countResult?.total || 0,\n          limit,\n          offset,\n          hasMore: (offset + tickets.length) < (countResult?.total || 0)\n        },\n        stats\n      }\n    }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * POST /api/tickets - Create new ticket\n */\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n\n  if (!env.DB) {\n    return new Response(JSON.stringify({ success: false, error: \"Database not configured\" }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n\n  try {\n    const data = await request.json();\n\n    // Validation\n    if (!data.subject || !data.description) {\n      return new Response(JSON.stringify({ success: false, error: \"Subject and description are required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    if (!data.email && !data.customer_email) {\n      return new Response(JSON.stringify({ success: false, error: \"Email is required\" }), {\n        status: 400,\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n    }\n\n    const now = Date.now();\n    const ticketNumber = await generateTicketNumber(env.DB);\n    const ticketId = `tkt_${crypto.randomUUID().split('-')[0]}`;\n\n    // Get or create customer\n    const email = (data.email || data.customer_email).toLowerCase().trim();\n    const customerName = data.customer || data.name || email.split('@')[0];\n    let customerId = data.userId || data.customer_id || null;\n\n    // Try to find existing customer\n    if (!customerId) {\n      const existingCustomer = await env.DB.prepare(\n        \"SELECT id FROM support_customers WHERE email = ?\"\n      ).bind(email).first();\n\n      if (existingCustomer) {\n        customerId = existingCustomer.id;\n      }\n    }\n\n    // Create ticket\n    const ticket = {\n      id: ticketId,\n      ticket_number: ticketNumber,\n      customer_id: customerId,\n      customer_name: customerName,\n      customer_email: email,\n      subject: data.subject,\n      description: data.description,\n      category: data.category || 'general',\n      priority: data.priority || 'medium',\n      status: 'open',\n      tags: data.tags ? JSON.stringify(data.tags) : null,\n      source: data.source || 'web',\n      created_at: now,\n      updated_at: now\n    };\n\n    await env.DB.prepare(`\n      INSERT INTO support_tickets (\n        id, ticket_number, customer_id, customer_name, customer_email,\n        subject, description, category, priority, status, tags, source,\n        created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).bind(\n      ticket.id, ticket.ticket_number, ticket.customer_id, ticket.customer_name,\n      ticket.customer_email, ticket.subject, ticket.description, ticket.category,\n      ticket.priority, ticket.status, ticket.tags, ticket.source,\n      ticket.created_at, ticket.updated_at\n    ).run();\n\n    // Add initial message\n    await env.DB.prepare(`\n      INSERT INTO support_messages (\n        id, ticket_id, author_type, author_id, author_name, author_email, content, created_at\n      ) VALUES (?, ?, 'customer', ?, ?, ?, ?, ?)\n    `).bind(\n      `msg_${crypto.randomUUID().split('-')[0]}`,\n      ticketId,\n      customerId,\n      customerName,\n      email,\n      data.description,\n      now\n    ).run();\n\n    // Update message count\n    await env.DB.prepare(\n      \"UPDATE support_tickets SET message_count = 1 WHERE id = ?\"\n    ).bind(ticketId).run();\n\n    // Update customer total tickets if exists\n    if (customerId) {\n      await env.DB.prepare(\n        \"UPDATE support_customers SET total_tickets = total_tickets + 1 WHERE id = ?\"\n      ).bind(customerId).run();\n    }\n\n    // Cache in KV for quick access\n    if (env.KV) {\n      try {\n        await env.KV.put(`ticket_${ticketNumber}`, JSON.stringify(ticket), { expirationTtl: 86400 });\n      } catch (e) {\n        console.error('KV cache error:', e);\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      message: `Ticket #${ticketNumber} created successfully`,\n      data: {\n        id: ticketId,\n        ticket_number: ticketNumber,\n        ...ticket\n      }\n    }), {\n      status: 201,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n\n  } catch (error) {\n    return new Response(JSON.stringify({ success: false, error: error.message }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}\n\n/**\n * Generate unique ticket number\n */\nasync function generateTicketNumber(db) {\n  const today = new Date();\n  const prefix = `TKT-${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}`;\n  \n  // Get count of tickets today\n  const count = await db.prepare(\n    \"SELECT COUNT(*) as count FROM support_tickets WHERE ticket_number LIKE ?\"\n  ).bind(`${prefix}%`).first();\n\n  const num = (count?.count || 0) + 1;\n  return `${prefix}-${String(num).padStart(4, '0')}`;\n}\n\n/**\n * Get ticket stats\n */\nasync function getTicketStats(db, customerEmail = null) {\n  let query = `\n    SELECT \n      COUNT(*) as total,\n      SUM(CASE WHEN status = 'open' THEN 1 ELSE 0 END) as open,\n      SUM(CASE WHEN status = 'in-progress' THEN 1 ELSE 0 END) as in_progress,\n      SUM(CASE WHEN status = 'resolved' THEN 1 ELSE 0 END) as resolved,\n      SUM(CASE WHEN status = 'closed' THEN 1 ELSE 0 END) as closed,\n      SUM(CASE WHEN priority = 'high' THEN 1 ELSE 0 END) as high_priority,\n      SUM(CASE WHEN priority = 'urgent' THEN 1 ELSE 0 END) as urgent\n    FROM support_tickets\n  `;\n\n  if (customerEmail) {\n    query += \" WHERE customer_email = ?\";\n    return await db.prepare(query).bind(customerEmail).first();\n  }\n\n  return await db.prepare(query).first();\n}\n", "import { onRequestPatch as __api_automation_paths__id__run_js_onRequestPatch } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/[id]/run.js\"\nimport { onRequestPost as __api_automation_paths__id__run_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/[id]/run.js\"\nimport { onRequestDelete as __api_automation_assistants__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/assistants/[id].js\"\nimport { onRequestGet as __api_automation_assistants__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/assistants/[id].js\"\nimport { onRequestPut as __api_automation_assistants__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/assistants/[id].js\"\nimport { onRequestDelete as __api_automation_paths__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/[id].js\"\nimport { onRequestPut as __api_automation_paths__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/[id].js\"\nimport { onRequestDelete as __api_blog_posts__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/[id].js\"\nimport { onRequestGet as __api_blog_posts__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/[id].js\"\nimport { onRequestPatch as __api_blog_posts__id__js_onRequestPatch } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/[id].js\"\nimport { onRequestPut as __api_blog_posts__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/[id].js\"\nimport { onRequestGet as __api_stats_posts__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/stats/posts/[id].js\"\nimport { onRequestPut as __api_stats_posts__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/stats/posts/[id].js\"\nimport { onRequestGet as __api_media_serve___path___js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/serve/[[path]].js\"\nimport { onRequestOptions as __api_media_serve___path___js_onRequestOptions } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/serve/[[path]].js\"\nimport { onRequestPost as __api_scheduled_posts__id__publish_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/[id]/publish.js\"\nimport { onRequestGet as __api_tickets__id__attachments_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id]/attachments.js\"\nimport { onRequestPost as __api_tickets__id__attachments_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id]/attachments.js\"\nimport { onRequestGet as __api_tickets__id__messages_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id]/messages.js\"\nimport { onRequestPost as __api_tickets__id__messages_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id]/messages.js\"\nimport { onRequestGet as __api_automation_assistants_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/assistants/index.js\"\nimport { onRequestPost as __api_automation_assistants_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/assistants/index.js\"\nimport { onRequestGet as __api_automation_config_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/config/index.js\"\nimport { onRequestPost as __api_automation_config_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/config/index.js\"\nimport { onRequestPut as __api_automation_config_index_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/config/index.js\"\nimport { onRequestGet as __api_automation_logs_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/logs/index.js\"\nimport { onRequestPost as __api_automation_logs_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/logs/index.js\"\nimport { onRequestGet as __api_automation_paths_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/index.js\"\nimport { onRequestPost as __api_automation_paths_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/paths/index.js\"\nimport { onRequestGet as __api_automation_prompts_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/prompts/index.js\"\nimport { onRequestPost as __api_automation_prompts_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/prompts/index.js\"\nimport { onRequestGet as __api_automation_stats_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/automation/stats/index.js\"\nimport { onRequestDelete as __api_blog_posts_index_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/index.js\"\nimport { onRequestGet as __api_blog_posts_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/index.js\"\nimport { onRequestPost as __api_blog_posts_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/blog/posts/index.js\"\nimport { onRequestGet as __api_chatbot_analytics_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/analytics.js\"\nimport { onRequestPost as __api_chatbot_analytics_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/analytics.js\"\nimport { onRequestDelete as __api_chatbot_conversations_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/conversations.js\"\nimport { onRequestGet as __api_chatbot_conversations_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/conversations.js\"\nimport { onRequestPost as __api_chatbot_conversations_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/conversations.js\"\nimport { onRequestGet as __api_chatbot_messages_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/messages.js\"\nimport { onRequestPost as __api_chatbot_messages_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/messages.js\"\nimport { onRequestPost as __api_chatbot_rate_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/rate.js\"\nimport { onRequestDelete as __api_chatbot_scenarios_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/scenarios.js\"\nimport { onRequestGet as __api_chatbot_scenarios_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/scenarios.js\"\nimport { onRequestPost as __api_chatbot_scenarios_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/scenarios.js\"\nimport { onRequestPut as __api_chatbot_scenarios_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/scenarios.js\"\nimport { onRequestGet as __api_chatbot_settings_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/settings.js\"\nimport { onRequestPost as __api_chatbot_settings_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/settings.js\"\nimport { onRequestPut as __api_chatbot_settings_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/settings.js\"\nimport { onRequestGet as __api_chatbot_users_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/users.js\"\nimport { onRequestPost as __api_chatbot_users_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/users.js\"\nimport { onRequestGet as __api_chatbot_widget_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/widget.js\"\nimport { onRequestPost as __api_chatbot_widget_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/widget.js\"\nimport { onRequestDelete as __api_customers_auth_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/customers/auth.js\"\nimport { onRequestGet as __api_customers_auth_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/customers/auth.js\"\nimport { onRequestPost as __api_customers_auth_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/customers/auth.js\"\nimport { onRequestPost as __api_media_bulk_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/bulk.js\"\nimport { onRequestDelete as __api_media_folders_index_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/folders/index.js\"\nimport { onRequestGet as __api_media_folders_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/folders/index.js\"\nimport { onRequestPost as __api_media_folders_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/folders/index.js\"\nimport { onRequestDelete as __api_profile_avatar_js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/profile/avatar.js\"\nimport { onRequestPost as __api_profile_avatar_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/profile/avatar.js\"\nimport { onRequestPost as __api_profile_password_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/profile/password.js\"\nimport { onRequestGet as __api_scheduled_posts_check_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/check.js\"\nimport { onRequestPost as __api_scheduled_posts_check_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/check.js\"\nimport { onRequestGet as __api_stats_dashboard_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/stats/dashboard.js\"\nimport { onRequestGet as __api_subscribers_import_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/import.js\"\nimport { onRequestPost as __api_subscribers_import_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/import.js\"\nimport { onRequestGet as __api_subscribers_popup_config_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/popup-config.js\"\nimport { onRequestPut as __api_subscribers_popup_config_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/popup-config.js\"\nimport { onRequestGet as __api_tickets_categories_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/categories.js\"\nimport { onRequestPost as __api_tickets_categories_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/categories.js\"\nimport { onRequestDelete as __api_categories__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/categories/[id].js\"\nimport { onRequestGet as __api_categories__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/categories/[id].js\"\nimport { onRequestPut as __api_categories__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/categories/[id].js\"\nimport { onRequestDelete as __api_media__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/[id].js\"\nimport { onRequestGet as __api_media__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/[id].js\"\nimport { onRequestPut as __api_media__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/[id].js\"\nimport { onRequestDelete as __api_scheduled_posts__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/[id].js\"\nimport { onRequestGet as __api_scheduled_posts__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/[id].js\"\nimport { onRequestPut as __api_scheduled_posts__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/[id].js\"\nimport { onRequestDelete as __api_subcategories__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subcategories/[id].js\"\nimport { onRequestGet as __api_subcategories__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subcategories/[id].js\"\nimport { onRequestPut as __api_subcategories__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subcategories/[id].js\"\nimport { onRequestDelete as __api_subscribers__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/[id].js\"\nimport { onRequestGet as __api_subscribers__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/[id].js\"\nimport { onRequestPut as __api_subscribers__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/[id].js\"\nimport { onRequestDelete as __api_tags__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/[id].js\"\nimport { onRequestGet as __api_tags__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/[id].js\"\nimport { onRequestPut as __api_tags__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/[id].js\"\nimport { onRequestDelete as __api_tickets__id__js_onRequestDelete } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id].js\"\nimport { onRequestGet as __api_tickets__id__js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id].js\"\nimport { onRequestPut as __api_tickets__id__js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/[id].js\"\nimport { onRequestGet as __api_categories_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/categories/index.js\"\nimport { onRequestPost as __api_categories_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/categories/index.js\"\nimport { onRequestGet as __api_chatbot_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/index.js\"\nimport { onRequestPost as __api_chatbot_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/chatbot/index.js\"\nimport { onRequestGet as __api_customers_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/customers/index.js\"\nimport { onRequestPost as __api_customers_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/customers/index.js\"\nimport { onRequestGet as __api_media_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/index.js\"\nimport { onRequestPost as __api_media_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/media/index.js\"\nimport { onRequestGet as __api_profile_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/profile/index.js\"\nimport { onRequestPut as __api_profile_index_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/profile/index.js\"\nimport { onRequestGet as __api_scheduled_posts_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/index.js\"\nimport { onRequestPost as __api_scheduled_posts_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/scheduled-posts/index.js\"\nimport { onRequestGet as __api_settings_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/settings/index.js\"\nimport { onRequestPost as __api_settings_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/settings/index.js\"\nimport { onRequestPut as __api_settings_index_js_onRequestPut } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/settings/index.js\"\nimport { onRequestGet as __api_stats_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/stats/index.js\"\nimport { onRequestPost as __api_stats_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/stats/index.js\"\nimport { onRequestGet as __api_subcategories_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subcategories/index.js\"\nimport { onRequestPost as __api_subcategories_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subcategories/index.js\"\nimport { onRequestGet as __api_subscribers_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/index.js\"\nimport { onRequestPost as __api_subscribers_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/subscribers/index.js\"\nimport { onRequestGet as __api_tags_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/index.js\"\nimport { onRequestPatch as __api_tags_index_js_onRequestPatch } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/index.js\"\nimport { onRequestPost as __api_tags_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tags/index.js\"\nimport { onRequestGet as __api_tickets_index_js_onRequestGet } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/index.js\"\nimport { onRequestPost as __api_tickets_index_js_onRequestPost } from \"/Users/houman/CascadeProjects/Fooodis/2/functions/api/tickets/index.js\"\n\nexport const routes = [\n    {\n      routePath: \"/api/automation/paths/:id/run\",\n      mountPath: \"/api/automation/paths/:id\",\n      method: \"PATCH\",\n      middlewares: [],\n      modules: [__api_automation_paths__id__run_js_onRequestPatch],\n    },\n  {\n      routePath: \"/api/automation/paths/:id/run\",\n      mountPath: \"/api/automation/paths/:id\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_paths__id__run_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/assistants/:id\",\n      mountPath: \"/api/automation/assistants\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_automation_assistants__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/automation/assistants/:id\",\n      mountPath: \"/api/automation/assistants\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_assistants__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/assistants/:id\",\n      mountPath: \"/api/automation/assistants\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_automation_assistants__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/automation/paths/:id\",\n      mountPath: \"/api/automation/paths\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_automation_paths__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/automation/paths/:id\",\n      mountPath: \"/api/automation/paths\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_automation_paths__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/blog/posts/:id\",\n      mountPath: \"/api/blog/posts\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_blog_posts__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/blog/posts/:id\",\n      mountPath: \"/api/blog/posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_blog_posts__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/blog/posts/:id\",\n      mountPath: \"/api/blog/posts\",\n      method: \"PATCH\",\n      middlewares: [],\n      modules: [__api_blog_posts__id__js_onRequestPatch],\n    },\n  {\n      routePath: \"/api/blog/posts/:id\",\n      mountPath: \"/api/blog/posts\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_blog_posts__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/stats/posts/:id\",\n      mountPath: \"/api/stats/posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_stats_posts__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/stats/posts/:id\",\n      mountPath: \"/api/stats/posts\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_stats_posts__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/media/serve/:path*\",\n      mountPath: \"/api/media/serve\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_media_serve___path___js_onRequestGet],\n    },\n  {\n      routePath: \"/api/media/serve/:path*\",\n      mountPath: \"/api/media/serve\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_media_serve___path___js_onRequestOptions],\n    },\n  {\n      routePath: \"/api/scheduled-posts/:id/publish\",\n      mountPath: \"/api/scheduled-posts/:id\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_scheduled_posts__id__publish_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/tickets/:id/attachments\",\n      mountPath: \"/api/tickets/:id\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tickets__id__attachments_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tickets/:id/attachments\",\n      mountPath: \"/api/tickets/:id\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_tickets__id__attachments_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/tickets/:id/messages\",\n      mountPath: \"/api/tickets/:id\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tickets__id__messages_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tickets/:id/messages\",\n      mountPath: \"/api/tickets/:id\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_tickets__id__messages_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/assistants\",\n      mountPath: \"/api/automation/assistants\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_assistants_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/assistants\",\n      mountPath: \"/api/automation/assistants\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_assistants_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/config\",\n      mountPath: \"/api/automation/config\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_config_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/config\",\n      mountPath: \"/api/automation/config\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_config_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/config\",\n      mountPath: \"/api/automation/config\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_automation_config_index_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/automation/logs\",\n      mountPath: \"/api/automation/logs\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_logs_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/logs\",\n      mountPath: \"/api/automation/logs\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_logs_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/paths\",\n      mountPath: \"/api/automation/paths\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_paths_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/paths\",\n      mountPath: \"/api/automation/paths\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_paths_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/prompts\",\n      mountPath: \"/api/automation/prompts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_prompts_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/automation/prompts\",\n      mountPath: \"/api/automation/prompts\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_automation_prompts_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/automation/stats\",\n      mountPath: \"/api/automation/stats\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_automation_stats_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/blog/posts\",\n      mountPath: \"/api/blog/posts\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_blog_posts_index_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/blog/posts\",\n      mountPath: \"/api/blog/posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_blog_posts_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/blog/posts\",\n      mountPath: \"/api/blog/posts\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_blog_posts_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/analytics\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_analytics_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/analytics\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_analytics_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/conversations\",\n      mountPath: \"/api/chatbot\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_chatbot_conversations_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/chatbot/conversations\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_conversations_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/conversations\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_conversations_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/messages\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_messages_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/messages\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_messages_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/rate\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_rate_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/scenarios\",\n      mountPath: \"/api/chatbot\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_chatbot_scenarios_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/chatbot/scenarios\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_scenarios_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/scenarios\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_scenarios_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/scenarios\",\n      mountPath: \"/api/chatbot\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_chatbot_scenarios_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/chatbot/settings\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_settings_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/settings\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_settings_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/settings\",\n      mountPath: \"/api/chatbot\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_chatbot_settings_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/chatbot/users\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_users_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/users\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_users_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot/widget\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_widget_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot/widget\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_widget_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/customers/auth\",\n      mountPath: \"/api/customers\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_customers_auth_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/customers/auth\",\n      mountPath: \"/api/customers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_customers_auth_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/customers/auth\",\n      mountPath: \"/api/customers\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_customers_auth_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/media/bulk\",\n      mountPath: \"/api/media\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_media_bulk_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/media/folders\",\n      mountPath: \"/api/media/folders\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_media_folders_index_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/media/folders\",\n      mountPath: \"/api/media/folders\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_media_folders_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/media/folders\",\n      mountPath: \"/api/media/folders\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_media_folders_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/profile/avatar\",\n      mountPath: \"/api/profile\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_profile_avatar_js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/profile/avatar\",\n      mountPath: \"/api/profile\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_profile_avatar_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/profile/password\",\n      mountPath: \"/api/profile\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_profile_password_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/scheduled-posts/check\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_scheduled_posts_check_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/scheduled-posts/check\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_scheduled_posts_check_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/stats/dashboard\",\n      mountPath: \"/api/stats\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_stats_dashboard_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribers/import\",\n      mountPath: \"/api/subscribers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribers_import_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribers/import\",\n      mountPath: \"/api/subscribers\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_subscribers_import_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/subscribers/popup-config\",\n      mountPath: \"/api/subscribers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribers_popup_config_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribers/popup-config\",\n      mountPath: \"/api/subscribers\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_subscribers_popup_config_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/tickets/categories\",\n      mountPath: \"/api/tickets\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tickets_categories_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tickets/categories\",\n      mountPath: \"/api/tickets\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_tickets_categories_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/categories/:id\",\n      mountPath: \"/api/categories\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_categories__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/categories/:id\",\n      mountPath: \"/api/categories\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_categories__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/categories/:id\",\n      mountPath: \"/api/categories\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_categories__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/media/:id\",\n      mountPath: \"/api/media\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_media__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/media/:id\",\n      mountPath: \"/api/media\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_media__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/media/:id\",\n      mountPath: \"/api/media\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_media__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/scheduled-posts/:id\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_scheduled_posts__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/scheduled-posts/:id\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_scheduled_posts__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/scheduled-posts/:id\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_scheduled_posts__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/subcategories/:id\",\n      mountPath: \"/api/subcategories\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_subcategories__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/subcategories/:id\",\n      mountPath: \"/api/subcategories\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subcategories__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subcategories/:id\",\n      mountPath: \"/api/subcategories\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_subcategories__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/subscribers/:id\",\n      mountPath: \"/api/subscribers\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_subscribers__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/subscribers/:id\",\n      mountPath: \"/api/subscribers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribers__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribers/:id\",\n      mountPath: \"/api/subscribers\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_subscribers__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/tags/:id\",\n      mountPath: \"/api/tags\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_tags__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/tags/:id\",\n      mountPath: \"/api/tags\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tags__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tags/:id\",\n      mountPath: \"/api/tags\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_tags__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/tickets/:id\",\n      mountPath: \"/api/tickets\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_tickets__id__js_onRequestDelete],\n    },\n  {\n      routePath: \"/api/tickets/:id\",\n      mountPath: \"/api/tickets\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tickets__id__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tickets/:id\",\n      mountPath: \"/api/tickets\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_tickets__id__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/categories\",\n      mountPath: \"/api/categories\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_categories_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/categories\",\n      mountPath: \"/api/categories\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_categories_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/chatbot\",\n      mountPath: \"/api/chatbot\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_chatbot_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/chatbot\",\n      mountPath: \"/api/chatbot\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chatbot_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/customers\",\n      mountPath: \"/api/customers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_customers_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/customers\",\n      mountPath: \"/api/customers\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_customers_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/media\",\n      mountPath: \"/api/media\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_media_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/media\",\n      mountPath: \"/api/media\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_media_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/profile\",\n      mountPath: \"/api/profile\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_profile_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/profile\",\n      mountPath: \"/api/profile\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_profile_index_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/scheduled-posts\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_scheduled_posts_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/scheduled-posts\",\n      mountPath: \"/api/scheduled-posts\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_scheduled_posts_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/settings\",\n      mountPath: \"/api/settings\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_settings_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/settings\",\n      mountPath: \"/api/settings\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_settings_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/settings\",\n      mountPath: \"/api/settings\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_settings_index_js_onRequestPut],\n    },\n  {\n      routePath: \"/api/stats\",\n      mountPath: \"/api/stats\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_stats_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/stats\",\n      mountPath: \"/api/stats\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_stats_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/subcategories\",\n      mountPath: \"/api/subcategories\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subcategories_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subcategories\",\n      mountPath: \"/api/subcategories\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_subcategories_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/subscribers\",\n      mountPath: \"/api/subscribers\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribers_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribers\",\n      mountPath: \"/api/subscribers\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_subscribers_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/tags\",\n      mountPath: \"/api/tags\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tags_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tags\",\n      mountPath: \"/api/tags\",\n      method: \"PATCH\",\n      middlewares: [],\n      modules: [__api_tags_index_js_onRequestPatch],\n    },\n  {\n      routePath: \"/api/tags\",\n      mountPath: \"/api/tags\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_tags_index_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/tickets\",\n      mountPath: \"/api/tickets\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_tickets_index_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/tickets\",\n      mountPath: \"/api/tickets\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_tickets_index_js_onRequestPost],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-6wWAM9/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-6wWAM9/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-6wWAM9/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/pages-CGgU9v/functionsWorker-0.7521307360487104.mjs\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/pages-CGgU9v/functionsWorker-0.7521307360487104.mjs\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-jfwYHF/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/usr/local/Cellar/node@20/20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-jfwYHF/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/houman/CascadeProjects/Fooodis/2/.wrangler/tmp/bundle-jfwYHF/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["urls", "checkURL", "__name", "onRequestPut", "onRequestDelete", "onRequestGet", "onRequestPatch", "onRequestPost", "convId", "existing", "now", "token", "ALLOWED_TYPES", "MAX_SIZE", "hashPassword", "generateToken", "KV_CACHE_TTL", "value", "_a", "result", "char", "prefix", "i", "drainBody", "middleware_ensure_req_body_drained_default", "reduceError", "jsonError", "middleware_miniflare3_json_error_default", "__INTERNAL_WRANGLER_MIDDLEWARE__", "middleware_ensure_req_body_drained_default", "middleware_miniflare3_json_error_default", "middleware_insertion_facade_default", "__facade_middleware__", "__facade_register__", "__facade_invokeChain__", "__facade_invoke__", "__facade_middleware__", "__Facade_ScheduledController__", "___Facade_ScheduledController__", "wrapExportedHandler", "__INTERNAL_WRANGLER_MIDDLEWARE__", "__facade_register__", "__facade_invoke__", "wrapWorkerEntrypoint", "WRAPPED_ENTRY", "middleware_insertion_facade_default", "middleware_loader_entry_default"]
}
