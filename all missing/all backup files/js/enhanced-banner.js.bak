/**
 * Enhanced Banner with Shining Effects and Customizable Elements
 * This script extends the existing advertising banner functionality
 * with premium visual effects, customizable buttons, and optional countdown timer.
 */

/**
 * Gets the current banner settings from form inputs
 */
function getBannerSettings() {
    const form = document.querySelector('#banner-customization-form');
    if (!form) return {
        backgroundColor: '#e8f24c',
        textColor: '#1e2127',
        title: 'Banner Title',
        message: 'Banner message goes here',
        showButton: true,
        buttonText: 'Button',
        buttonColor: '#e8f24c',
        buttonTextColor: '#1e2127',
        buttonRounded: true,
        buttonShine: true,
        showCountdown: true,
        countdownDate: ''
    };
    
    return {
        backgroundColor: form.querySelector('#banner-bg-color')?.value || '#e8f24c',
        textColor: form.querySelector('#banner-text-color')?.value || '#1e2127',
        title: form.querySelector('#banner-title')?.value || 'Banner Title',
        message: form.querySelector('#banner-message')?.value || 'Banner message goes here',
        showButton: form.querySelector('#show-button')?.checked || true,
        buttonText: form.querySelector('#button-text')?.value || 'Button',
        buttonColor: form.querySelector('#button-color')?.value || '#e8f24c',
        buttonTextColor: form.querySelector('#button-text-color')?.value || '#1e2127',
        buttonRounded: form.querySelector('#button-rounded')?.checked || true,
        buttonShine: form.querySelector('#button-shine')?.checked || true,
        showCountdown: form.querySelector('#show-countdown')?.checked || true,
        countdownDate: form.querySelector('#countdown-date')?.value || ''
    };
}

/**
 * Updates the mini preview with current settings
 */
function updateMiniPreview() {
    const miniPreview = document.querySelector('.banner-mini-preview');
    if (!miniPreview) return;
    
    const settings = getBannerSettings();
    
    // Update mini preview styles
    miniPreview.style.backgroundColor = settings.backgroundColor;
    miniPreview.style.color = settings.textColor;
    
    // Update mini preview content
    const previewTitle = miniPreview.querySelector('.mini-preview-title');
    if (previewTitle) {
        previewTitle.textContent = settings.title || 'Banner Title';
        previewTitle.style.color = settings.textColor;
    }
    
    const previewSubtitle = miniPreview.querySelector('.mini-preview-subtitle');
    if (previewSubtitle) {
        previewSubtitle.textContent = settings.message || 'Banner message goes here';
        previewSubtitle.style.color = settings.textColor;
    }
    
    // Update button if shown
    const previewButton = miniPreview.querySelector('.mini-preview-button');
    if (previewButton) {
        previewButton.style.display = settings.showButton ? 'block' : 'none';
        previewButton.textContent = settings.buttonText || 'Button';
        previewButton.style.backgroundColor = settings.buttonColor;
        previewButton.style.color = settings.buttonTextColor;
        previewButton.style.borderRadius = settings.buttonRounded ? '30px' : '4px';
        
        if (settings.buttonShine) {
            previewButton.classList.add('with-shine');
        } else {
            previewButton.classList.remove('with-shine');
        }
    }
    
    // Update countdown if shown
    const previewCountdown = miniPreview.querySelector('.mini-preview-countdown');
    if (previewCountdown) {
        previewCountdown.style.display = settings.showCountdown ? 'flex' : 'none';
        
        // Update countdown boxes with sample values
        const countdownBoxes = previewCountdown.querySelectorAll('.mini-preview-countdown-box');
        if (countdownBoxes.length === 4) {
            countdownBoxes[0].textContent = '03'; // days
            countdownBoxes[1].textContent = '12'; // hours
            countdownBoxes[2].textContent = '45'; // minutes
            countdownBoxes[3].textContent = '30'; // seconds
        }
    }
    
    // Add a subtle animation to the preview
    miniPreview.classList.add('preview-updated');
    setTimeout(() => {
        miniPreview.classList.remove('preview-updated');
    }, 500);
}

/**
 * Shows a notification message
 * @param {string} message - The notification message
 * @param {string} type - The notification type (success, error, info, warning)
 */
function showNotification(message, type = 'success') {
    // Remove existing notification if any
    const existingNotification = document.querySelector('.banner-notification');
    if (existingNotification) {
        document.body.removeChild(existingNotification);
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `banner-notification ${type}`;
    
    // Set icon based on type
    let icon = 'check-circle';
    if (type === 'error') icon = 'exclamation-circle';
    if (type === 'info') icon = 'info-circle';
    if (type === 'warning') icon = 'exclamation-triangle';
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas fa-${icon}"></i>
        </div>
        <div class="notification-content">
            <p>${message}</p>
        </div>
        <button class="notification-close">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    // Add to document
    document.body.appendChild(notification);
    
    // Add animation
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    // Add close button functionality
    const closeBtn = notification.querySelector('.notification-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            notification.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        });
    }
    
    // Auto-dismiss after 4 seconds
    setTimeout(() => {
        if (document.body.contains(notification)) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }
    }, 4000);
}

// Banner configuration object with default values
window.bannerConfig = window.bannerConfig || {
    // Banner frame
    borderRadius: 8, // px
    shineColor1: '#e8f24c',
    shineColor2: '#ffd700',
    shineAnimation: true,
    
    // Button
    buttonBackground: 'linear-gradient(45deg, #e8f24c, #ffd700)',
    buttonTextColor: '#1e2127',
    buttonBorderRadius: 30, // px
    buttonPadding: '12px 25px',
    buttonBorder: 'none',
    buttonShine: true,
    
    // Countdown
    showCountdown: true,
    countdownBorderRadius: 5, // px
    
    // Colors
    accentColor: '#e8f24c'
};

// Initialize when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    initEnhancedBanner();
});

// Initialize enhanced banner functionality
function initEnhancedBanner() {
    console.log('Initializing enhanced banner with customizable elements...');
    
    try {
        // Check if we're on the blog page
        if (document.querySelector('.blog-content-section')) {
            // We're on the blog page, inject the enhanced banner
            injectEnhancedBanner();
            
            // Set up the countdown timer if enabled
            if (window.bannerConfig && window.bannerConfig.showCountdown) {
                initCountdownTimer();
            }
        }
        
        // Check if we're on the dashboard page
        const dashboardBody = document.querySelector('.dashboard-body');
        if (dashboardBody) {
            // Only try to add dashboard elements if we're on the dashboard page
            try {
                // Add enhanced banner option to the dashboard
                addEnhancedBannerOption();
            } catch (error) {
                console.warn('Could not add enhanced banner option:', error);
            }
        }
    } catch (error) {
        console.error('Error initializing enhanced banner:', error);
    }
}

// Inject the enhanced banner into the blog page
function injectEnhancedBanner() {
    // Implementation details...
    console.log('Enhanced banner injected');
}

// Initialize countdown timer
function initCountdownTimer() {
    // Implementation details...
    console.log('Countdown timer initialized');
}

// Initialize typewriter effect
function initTypewriterEffect() {
    // Implementation details...
    console.log('Typewriter effect initialized');
}

// Add enhanced banner option to the dashboard
function addEnhancedBannerOption() {
    console.log('Adding enhanced banner option to dashboard...');
    
    // Find the ad layout selection container
    const layoutContainer = document.querySelector('.ad-layouts');
    if (!layoutContainer) {
        console.error('Could not find layout selection container');
        return;
    }
    
    // Create the enhanced banner option
    const enhancedOption = document.createElement('div');
    enhancedOption.className = 'layout-option';
    enhancedOption.innerHTML = `
        <input type="radio" id="layout-premium" name="adLayout" value="layout-premium">
        <label for="layout-premium" class="layout-label">
            <div class="layout-preview layout-premium">
                <div class="preview-shine"></div>
                <div class="preview-text">
                    <div class="preview-title">Premium</div>
                    <div class="preview-subtitle">Enhanced</div>
                </div>
                <div class="preview-button">Action</div>
            </div>
            <span class="layout-name">Premium Enhanced</span>
        </label>
    `;
    
    // Add the enhanced option to the layout container
    layoutContainer.appendChild(enhancedOption);
    
    // Add customization controls when premium layout is selected
    const premiumRadio = enhancedOption.querySelector('#layout-premium');
    if (premiumRadio) {
        premiumRadio.addEventListener('change', function() {
            if (this.checked) {
                // Add banner customization controls
                addBannerCustomizationControls();
            } else {
                // Remove banner customization panel if it exists
                const customizationPanel = document.querySelector('.banner-customization-panel');
                if (customizationPanel) {
                    customizationPanel.remove();
                }
            }
        });
    }
}

// Function to add banner customization controls to the dashboard
function addBannerCustomizationControls() {
    console.log('Adding banner customization controls...');
    
    // Check if panel already exists
    let customizationPanel = document.querySelector('.banner-customization-panel');
    if (customizationPanel) {
        return; // Panel already exists
    }
    
    // Create the customization panel
    customizationPanel = document.createElement('div');
    customizationPanel.className = 'banner-customization-panel';
    
    // Add the panel to the ad management section
    const adManagementSection = document.querySelector('#ad-management-section');
    if (adManagementSection) {
        adManagementSection.appendChild(customizationPanel);
        
        // Initialize the panel with basic controls
        initBannerCustomizationPanel(customizationPanel);
    } else {
        console.error('Could not find ad management section');
    }
}

// Function to initialize the banner customization panel
function initBannerCustomizationPanel(panel) {
    if (!panel) return;
    
    console.log('Initializing banner customization panel...');
    
    // Create panel header
    const panelHeader = document.createElement('div');
    panelHeader.className = 'panel-header';
    panelHeader.innerHTML = '<h3><i class="fas fa-paint-brush"></i> Banner Customization</h3>';
    panel.appendChild(panelHeader);
    
    // Create form container
    const formContainer = document.createElement('div');
    formContainer.className = 'customization-form';
    
    // Add enhanced controls with sections
    formContainer.innerHTML = `
        <div class="customization-section">
            <h4 class="section-title"><i class="fas fa-sliders-h"></i> Banner Appearance</h4>
            
            <div class="form-group">
                <label for="banner-border-radius">Border Radius</label>
                <div class="range-control">
                    <input type="range" id="banner-border-radius" min="0" max="20" value="${window.bannerConfig.borderRadius || 8}">
                    <span class="value-display">${window.bannerConfig.borderRadius || 8}px</span>
                </div>
            </div>
            
            <div class="form-group color-group">
                <label for="shine-color-1">Primary Shine Color</label>
                <div class="color-control">
                    <input type="color" id="shine-color-1" value="${window.bannerConfig.shineColor1 || '#e8f24c'}">
                    <span class="color-value">${window.bannerConfig.shineColor1 || '#e8f24c'}</span>
                </div>
            </div>
            
            <div class="form-group color-group">
                <label for="shine-color-2">Secondary Shine Color</label>
                <div class="color-control">
                    <input type="color" id="shine-color-2" value="${window.bannerConfig.shineColor2 || '#ffd700'}">
                    <span class="color-value">${window.bannerConfig.shineColor2 || '#ffd700'}</span>
                </div>
            </div>
            
            <div class="form-group toggle-group">
                <label for="shine-animation">Shine Animation</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="shine-animation" ${window.bannerConfig.shineAnimation ? 'checked' : ''}>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <div class="customization-section">
            <h4 class="section-title"><i class="fas fa-mouse-pointer"></i> Button Styling</h4>
            
            <div class="form-group color-group">
                <label for="button-text-color">Button Text Color</label>
                <div class="color-control">
                    <input type="color" id="button-text-color" value="${window.bannerConfig.buttonTextColor || '#1e2127'}">
                    <span class="color-value">${window.bannerConfig.buttonTextColor || '#1e2127'}</span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="button-border-radius">Button Border Radius</label>
                <div class="range-control">
                    <input type="range" id="button-border-radius" min="0" max="30" value="${window.bannerConfig.buttonBorderRadius || 30}">
                    <span class="value-display">${window.bannerConfig.buttonBorderRadius || 30}px</span>
                </div>
            </div>
            
            <div class="form-group toggle-group">
                <label for="button-shine">Button Shine Effect</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="button-shine" ${window.bannerConfig.buttonShine ? 'checked' : ''}>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <div class="customization-section">
            <h4 class="section-title"><i class="fas fa-clock"></i> Countdown Timer</h4>
            
            <div class="form-group toggle-group">
                <label for="show-countdown">Show Countdown</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="show-countdown" ${window.bannerConfig.showCountdown ? 'checked' : ''}>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="form-group">
                <label for="countdown-border-radius">Countdown Box Radius</label>
                <div class="range-control">
                    <input type="range" id="countdown-border-radius" min="0" max="15" value="${window.bannerConfig.countdownBorderRadius || 5}">
                    <span class="value-display">${window.bannerConfig.countdownBorderRadius || 5}px</span>
                </div>
            </div>
        </div>
        
        <div class="form-group color-group">
            <label for="accent-color">Global Accent Color</label>
            <div class="color-control">
                <input type="color" id="accent-color" value="${window.bannerConfig.accentColor || '#e8f24c'}">
                <span class="color-value">${window.bannerConfig.accentColor || '#e8f24c'}</span>
            </div>
        </div>
        
        <div class="banner-preview-container">
            <div class="preview-section">
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" id="preview-banner" class="btn btn-info"><i class="fas fa-eye"></i> Full Preview</button>
            <button type="button" id="apply-banner-customization" class="btn btn-primary"><i class="fas fa-check"></i> Apply Changes</button>
            <button type="button" id="reset-banner-customization" class="btn btn-secondary"><i class="fas fa-undo"></i> Reset</button>
        </div>
    `;
    
    panel.appendChild(formContainer);
    
    // Add event listeners for controls
    setupBannerControlEventListeners(panel);
    
    // Create mini preview with title
    const previewTitle = document.createElement('div');
    previewTitle.className = 'preview-title';
    previewTitle.innerHTML = '<i class="fas fa-eye"></i> Live Preview';
    panel.querySelector('.preview-section').appendChild(previewTitle);
    
    // Create mini preview
    const miniPreview = document.createElement('div');
    miniPreview.className = 'banner-mini-preview';
    miniPreview.innerHTML = `
        <div class="mini-preview-content">
            <div class="mini-preview-text">
                <div class="mini-preview-title">Banner Title</div>
                <div class="mini-preview-subtitle">Banner message goes here</div>
                <div class="mini-preview-countdown">
                    <div class="mini-preview-countdown-box">03</div>
                    <div class="mini-preview-countdown-box">12</div>
                    <div class="mini-preview-countdown-box">45</div>
                    <div class="mini-preview-countdown-box">30</div>
                </div>
            </div>
            <div class="mini-preview-button">Button</div>
        </div>
    `;
    panel.querySelector('.preview-section').appendChild(miniPreview);
    
    // Initialize the mini preview
    updateMiniPreview();
}

// Function to set up event listeners for banner controls
function setupBannerControlEventListeners(panel) {
    if (!panel) return;
    
    // Handle range input changes
    const rangeInputs = panel.querySelectorAll('input[type="range"]');
    rangeInputs.forEach(input => {
        input.addEventListener('input', function() {
            const valueDisplay = this.nextElementSibling;
            if (valueDisplay && valueDisplay.classList.contains('value-display')) {
                valueDisplay.textContent = this.value + 'px';
            }
            // Update mini preview in real-time
            updateMiniPreview();
        });
    });
    
    // Handle color input changes
    const colorInputs = panel.querySelectorAll('input[type="color"]');
    colorInputs.forEach(input => {
        input.addEventListener('input', function() {
            // Update color value display
            const colorValue = this.parentElement.querySelector('.color-value');
            if (colorValue) {
                colorValue.textContent = this.value;
                colorValue.style.backgroundColor = this.value;
                colorValue.style.color = getContrastColor(this.value);
            }
            // Update mini preview in real-time
            updateMiniPreview();
        });
    });
    
    // Handle toggle switches
    const toggleInputs = panel.querySelectorAll('.toggle-switch input[type="checkbox"]');
    toggleInputs.forEach(input => {
        input.addEventListener('change', function() {
            // Update mini preview in real-time
            updateMiniPreview();
        });
    });
    
    // Handle preview button
    const previewButton = panel.querySelector('#preview-banner');
    if (previewButton) {
        previewButton.addEventListener('click', function() {
            showFullPreview();
        });
    }

/**
 * Shows a full-size preview of the banner with current settings
 */
function showFullPreview() {
    // Create modal if it doesn't exist
    let modal = document.querySelector('.banner-preview-modal');
    
    if (!modal) {
        modal = document.createElement('div');
        modal.className = 'banner-preview-modal';
        modal.innerHTML = `
            <div class="preview-modal-content">
                <div class="preview-modal-header">
                    <h3><i class="fas fa-eye"></i> Banner Preview</h3>
                    <button class="preview-close-btn"><i class="fas fa-times"></i></button>
                </div>
                <div class="preview-modal-body">
                    <div class="preview-container" id="full-banner-preview"></div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Add event listener to close button
        const closeBtn = modal.querySelector('.preview-close-btn');
        closeBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });
        
        // Close modal when clicking outside content
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
            }
        });
    }
    
    // Get current banner settings
    const settings = getBannerSettings();
    
    // Create full-size preview
    const previewContainer = modal.querySelector('#full-banner-preview');
    previewContainer.innerHTML = '';
    
    // Create banner element
    const banner = document.createElement('div');
    banner.className = 'enhanced-banner';
    banner.style.backgroundColor = settings.backgroundColor;
    banner.style.color = settings.textColor;
    banner.style.padding = '20px';
    banner.style.borderRadius = '8px';
    banner.style.display = 'flex';
    banner.style.justifyContent = 'space-between';
    banner.style.alignItems = 'center';
    banner.style.flexWrap = 'wrap';
    
    // Create banner content
    const contentDiv = document.createElement('div');
    contentDiv.className = 'banner-content';
    contentDiv.style.flex = '1';
    contentDiv.style.minWidth = '250px';
    
    // Add title
    const title = document.createElement('h3');
    title.textContent = settings.title || 'Special Offer!';
    title.style.margin = '0 0 10px 0';
    title.style.fontSize = '24px';
    title.style.fontWeight = 'bold';
    title.style.color = settings.textColor;
    contentDiv.appendChild(title);
    
    // Add message
    const message = document.createElement('p');
    message.textContent = settings.message || 'Limited time offer for our valued customers.';
    message.style.margin = '0';
    message.style.fontSize = '16px';
    message.style.color = settings.textColor;
    contentDiv.appendChild(message);
    
    // Add countdown if enabled
    if (settings.showCountdown) {
        const countdownDiv = document.createElement('div');
        countdownDiv.className = 'banner-countdown';
        countdownDiv.style.display = 'flex';
        countdownDiv.style.gap = '10px';
        countdownDiv.style.marginTop = '15px';
        
        const units = ['days', 'hours', 'mins', 'secs'];
        units.forEach(unit => {
            const unitDiv = document.createElement('div');
            unitDiv.className = 'countdown-unit';
            unitDiv.style.textAlign = 'center';
            unitDiv.style.minWidth = '50px';
            
            const valueSpan = document.createElement('div');
            valueSpan.className = `countdown-${unit}`;
            valueSpan.textContent = unit === 'days' ? '3' : 
                                   unit === 'hours' ? '12' : 
                                   unit === 'mins' ? '45' : '30';
            valueSpan.style.backgroundColor = 'rgba(0,0,0,0.2)';
            valueSpan.style.color = settings.textColor;
            valueSpan.style.padding = '8px 12px';
            valueSpan.style.borderRadius = '4px';
            valueSpan.style.fontSize = '18px';
            valueSpan.style.fontWeight = 'bold';
            
            const labelSpan = document.createElement('div');
            labelSpan.textContent = unit;
            labelSpan.style.fontSize = '12px';
            labelSpan.style.marginTop = '5px';
            labelSpan.style.color = settings.textColor;
            
            unitDiv.appendChild(valueSpan);
            unitDiv.appendChild(labelSpan);
            countdownDiv.appendChild(unitDiv);
        });
        
        contentDiv.appendChild(countdownDiv);
    }
    
    banner.appendChild(contentDiv);
    
    // Create button
    if (settings.showButton) {
        const buttonDiv = document.createElement('div');
        buttonDiv.className = 'banner-button';
        buttonDiv.style.marginLeft = '20px';
        buttonDiv.style.marginTop = '20px';
        
        const button = document.createElement('button');
        button.textContent = settings.buttonText || 'Learn More';
        button.style.backgroundColor = settings.buttonColor;
        button.style.color = settings.buttonTextColor;
        button.style.border = 'none';
        button.style.borderRadius = settings.buttonRounded ? '30px' : '4px';
        button.style.padding = '12px 24px';
        button.style.fontSize = '16px';
        button.style.fontWeight = 'bold';
        button.style.cursor = 'pointer';
        button.style.transition = 'all 0.3s ease';
        
        // Add shine effect if enabled
        if (settings.buttonShine) {
            button.style.position = 'relative';
            button.style.overflow = 'hidden';
            
            const shine = document.createElement('span');
            shine.style.position = 'absolute';
            shine.style.top = '-50%';
            shine.style.left = '-50%';
            shine.style.width = '200%';
            shine.style.height = '200%';
            shine.style.background = 'linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent)';
            shine.style.transform = 'rotate(45deg)';
            shine.style.animation = 'shineEffect 2s infinite';
            
            button.appendChild(shine);
        }
        
        buttonDiv.appendChild(button);
        banner.appendChild(buttonDiv);
    }
    
    // Add to preview container
    previewContainer.appendChild(banner);
    
    // Show modal
    modal.classList.add('show');
}

// This function has been moved to the top of the file
    
    // Handle apply button
    const applyButton = panel.querySelector('#apply-banner-customization');
    if (applyButton) {
        applyButton.addEventListener('click', function() {
            // Update banner configuration with all controls
            window.bannerConfig.borderRadius = parseInt(panel.querySelector('#banner-border-radius').value);
            window.bannerConfig.shineColor1 = panel.querySelector('#shine-color-1').value;
            window.bannerConfig.shineColor2 = panel.querySelector('#shine-color-2').value;
            window.bannerConfig.shineAnimation = panel.querySelector('#shine-animation').checked;
            window.bannerConfig.buttonTextColor = panel.querySelector('#button-text-color').value;
            window.bannerConfig.buttonBorderRadius = parseInt(panel.querySelector('#button-border-radius').value);
            window.bannerConfig.buttonShine = panel.querySelector('#button-shine').checked;
            window.bannerConfig.showCountdown = panel.querySelector('#show-countdown').checked;
            window.bannerConfig.countdownBorderRadius = parseInt(panel.querySelector('#countdown-border-radius').value);
            window.bannerConfig.accentColor = panel.querySelector('#accent-color').value;
            
            // Save configuration
            localStorage.setItem('fooodis-banner-config', JSON.stringify(window.bannerConfig));
            
            // Show success message with Fooodis styling
            showNotification('Banner customization applied successfully!', 'success');
        });
    }
    
    // Handle reset button
    const resetButton = panel.querySelector('#reset-banner-customization');
    if (resetButton) {
        resetButton.addEventListener('click', function() {
            if (confirm('Are you sure you want to reset all banner settings to default values?')) {
                // Reset to default values
                window.bannerConfig = {
                    borderRadius: 8,
                    shineColor1: '#e8f24c',
                    shineColor2: '#ffd700',
                    shineAnimation: true,
                    buttonBackground: 'linear-gradient(45deg, #e8f24c, #ffd700)',
                    buttonTextColor: '#1e2127',
                    buttonBorderRadius: 30,
                    buttonPadding: '12px 25px',
                    buttonBorder: 'none',
                    buttonShine: true,
                    showCountdown: true,
                    countdownBorderRadius: 5,
                    accentColor: '#e8f24c'
                };
                
                // Update all UI elements
                updateUIFromConfig(panel);
                
                // Update mini preview
                updateMiniPreview();
                
                // Save default configuration
                localStorage.setItem('fooodis-banner-config', JSON.stringify(window.bannerConfig));
                
                // Show success message with Fooodis styling
                showNotification('Banner settings reset to default values!', 'info');
            }
        });
    }
}

/**
 * Updates the mini preview with current settings
 */
function updateMiniPreview() {
    const miniPreview = document.querySelector('.banner-mini-preview');
    if (!miniPreview) return;
    
    const settings = getBannerSettings();
    
    // Update mini preview styles
    miniPreview.style.backgroundColor = settings.backgroundColor;
    miniPreview.style.color = settings.textColor;
    
    // Update mini preview content
    const previewTitle = miniPreview.querySelector('.mini-preview-title');
    if (previewTitle) {
        previewTitle.textContent = settings.title || 'Banner Title';
        previewTitle.style.color = settings.textColor;
    }
    
    const previewSubtitle = miniPreview.querySelector('.mini-preview-subtitle');
    if (previewSubtitle) {
        previewSubtitle.textContent = settings.message || 'Banner message goes here';
        previewSubtitle.style.color = settings.textColor;
    }
    
    // Update button if shown
    const previewButton = miniPreview.querySelector('.mini-preview-button');
    if (previewButton) {
        previewButton.style.display = settings.showButton ? 'block' : 'none';
        previewButton.textContent = settings.buttonText || 'Button';
        previewButton.style.backgroundColor = settings.buttonColor;
        previewButton.style.color = settings.buttonTextColor;
        previewButton.style.borderRadius = settings.buttonRounded ? '30px' : '4px';
        
        if (settings.buttonShine) {
            previewButton.classList.add('with-shine');
        } else {
            previewButton.classList.remove('with-shine');
        }
    }
    
    // Update countdown if shown
    const previewCountdown = miniPreview.querySelector('.mini-preview-countdown');
    if (previewCountdown) {
        previewCountdown.style.display = settings.showCountdown ? 'flex' : 'none';
        
        // Update countdown boxes with sample values
        const countdownBoxes = previewCountdown.querySelectorAll('.mini-preview-countdown-box');
        if (countdownBoxes.length === 4) {
            countdownBoxes[0].textContent = '03'; // days
            countdownBoxes[1].textContent = '12'; // hours
            countdownBoxes[2].textContent = '45'; // minutes
            countdownBoxes[3].textContent = '30'; // seconds
        }
    }
    
    // Add a subtle animation to the preview
    miniPreview.classList.add('preview-updated');
    setTimeout(() => {
        miniPreview.classList.remove('preview-updated');
    }, 500);
}

/**
 * Shows a notification message
 * @param {string} message - The notification message
 * @param {string} type - The notification type (success, error, info, warning)
 */
function showNotification(message, type = 'success') {
    // Remove existing notification if any
    const existingNotification = document.querySelector('.banner-notification');
    if (existingNotification) {
        document.body.removeChild(existingNotification);
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `banner-notification ${type}`;
    
    // Set icon based on type
    let icon = 'check-circle';
    if (type === 'error') icon = 'exclamation-circle';
    if (type === 'info') icon = 'info-circle';
    if (type === 'warning') icon = 'exclamation-triangle';
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas fa-${icon}"></i>
        </div>
        <div class="notification-content">
            <p>${message}</p>
        </div>
        <button class="notification-close">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    // Add to document
    document.body.appendChild(notification);
    
    // Add animation
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    // Add close button functionality
    const closeBtn = notification.querySelector('.notification-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            notification.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        });
    }
    
    // Auto-dismiss after 4 seconds
    setTimeout(() => {
        if (document.body.contains(notification)) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }
    }, 4000);
}

// Helper function to get contrasting text color (black or white) based on background
function getContrastColor(hexColor) {
    // Remove the # if present
    hexColor = hexColor.replace('#', '');
    
    // Convert to RGB
    const r = parseInt(hexColor.substr(0, 2), 16);
    const g = parseInt(hexColor.substr(2, 2), 16);
    const b = parseInt(hexColor.substr(4, 2), 16);
    
    // Calculate luminance - human eye favors green color
    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
    
    // Return black for bright colors, white for dark colors
    return luminance > 0.5 ? '#000000' : '#ffffff';
}

// Function to update all UI elements from the config
function updateUIFromConfig(panel) {
    if (!panel) return;
    
    // Update range inputs
    panel.querySelector('#banner-border-radius').value = window.bannerConfig.borderRadius;
    panel.querySelector('#banner-border-radius').nextElementSibling.textContent = window.bannerConfig.borderRadius + 'px';
    
    panel.querySelector('#button-border-radius').value = window.bannerConfig.buttonBorderRadius;
    panel.querySelector('#button-border-radius').nextElementSibling.textContent = window.bannerConfig.buttonBorderRadius + 'px';
    
    panel.querySelector('#countdown-border-radius').value = window.bannerConfig.countdownBorderRadius;
    panel.querySelector('#countdown-border-radius').nextElementSibling.textContent = window.bannerConfig.countdownBorderRadius + 'px';
    
    // Update color inputs
    panel.querySelector('#shine-color-1').value = window.bannerConfig.shineColor1;
    panel.querySelector('#shine-color-1').parentElement.querySelector('.color-value').textContent = window.bannerConfig.shineColor1;
    panel.querySelector('#shine-color-1').parentElement.querySelector('.color-value').style.backgroundColor = window.bannerConfig.shineColor1;
    panel.querySelector('#shine-color-1').parentElement.querySelector('.color-value').style.color = getContrastColor(window.bannerConfig.shineColor1);
    
    panel.querySelector('#shine-color-2').value = window.bannerConfig.shineColor2;
    panel.querySelector('#shine-color-2').parentElement.querySelector('.color-value').textContent = window.bannerConfig.shineColor2;
    panel.querySelector('#shine-color-2').parentElement.querySelector('.color-value').style.backgroundColor = window.bannerConfig.shineColor2;
    panel.querySelector('#shine-color-2').parentElement.querySelector('.color-value').style.color = getContrastColor(window.bannerConfig.shineColor2);
    
    panel.querySelector('#button-text-color').value = window.bannerConfig.buttonTextColor;
    panel.querySelector('#button-text-color').parentElement.querySelector('.color-value').textContent = window.bannerConfig.buttonTextColor;
    panel.querySelector('#button-text-color').parentElement.querySelector('.color-value').style.backgroundColor = window.bannerConfig.buttonTextColor;
    panel.querySelector('#button-text-color').parentElement.querySelector('.color-value').style.color = getContrastColor(window.bannerConfig.buttonTextColor);
    
    panel.querySelector('#accent-color').value = window.bannerConfig.accentColor;
    panel.querySelector('#accent-color').parentElement.querySelector('.color-value').textContent = window.bannerConfig.accentColor;
    panel.querySelector('#accent-color').parentElement.querySelector('.color-value').style.backgroundColor = window.bannerConfig.accentColor;
    panel.querySelector('#accent-color').parentElement.querySelector('.color-value').style.color = getContrastColor(window.bannerConfig.accentColor);
    
    // Update toggle switches
    panel.querySelector('#shine-animation').checked = window.bannerConfig.shineAnimation;
    panel.querySelector('#button-shine').checked = window.bannerConfig.buttonShine;
    panel.querySelector('#show-countdown').checked = window.bannerConfig.showCountdown;
}

// Function to load saved banner configuration
function loadBannerConfiguration() {
    const savedConfig = localStorage.getItem('fooodis-banner-config');
    if (savedConfig) {
        try {
            const parsedConfig = JSON.parse(savedConfig);
            Object.assign(window.bannerConfig, parsedConfig);
            console.log('Loaded banner configuration from localStorage');
        } catch (e) {
            console.error('Error parsing banner configuration:', e);
        }
    }
}

// Load banner configuration on initialization
loadBannerConfiguration();

// Export functions for use in other scripts
window.injectEnhancedBanner = injectEnhancedBanner;
window.initCountdownTimer = initCountdownTimer;
window.bannerConfig = bannerConfig;
